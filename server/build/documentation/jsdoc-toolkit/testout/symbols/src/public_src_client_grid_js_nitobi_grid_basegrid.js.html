<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="NAME">nitobi.lang.defineNs</span><span class="PUNC">(</span><span class="STRN">"nitobi.grid"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>  2</span> 
<span class='line'>  3</span> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>  5</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>  6</span> 	 * &lt;i>There is no constructor for this class.&lt;/i>
<span class='line'>  7</span> 	 * @class &lt;code>nitobi.grid&lt;/code> is the namespace for classes that make up 
<span class='line'>  8</span> 	 * the Nitobi Grid component.  You're probably looking for documentation about one of
<span class='line'>  9</span> 	 * the classes below.  {@link nitobi.grid.Grid} is the class of object you will get if you
<span class='line'> 10</span> 	 * use {@link nitobi#getComponent} or &lt;code>$('&lt;COMPONENT_ID&gt;').jsObject&lt;/code>.
<span class='line'> 11</span> 	 * &lt;p>
<span class='line'> 12</span> 	 * The most commonly used classes are {@link nitobi.grid.Grid}, {@link nitobi.grid.Cell},
<span class='line'> 13</span> 	 * and {@link nitobi.grid.Column}
<span class='line'> 14</span> 	 * &lt;/p>
<span class='line'> 15</span> 	 * @constructor
<span class='line'> 16</span> 	 */</span><span class="WHIT">
<span class='line'> 17</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.grid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 19</span> 
<span class='line'> 20</span> </span><span class="COMM">/**
<span class='line'> 21</span>  * Static property used to create a non-paging Grid.
<span class='line'> 22</span>  */</span><span class="WHIT">
<span class='line'> 23</span> </span><span class="NAME">nitobi.grid.PAGINGMODE_NONE</span><span class="PUNC">=</span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 24</span> </span><span class="COMM">/**
<span class='line'> 25</span>  * Static property used to create a standard paging Grid.
<span class='line'> 26</span>  */</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="NAME">nitobi.grid.PAGINGMODE_STANDARD</span><span class="PUNC">=</span><span class="STRN">"standard"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="COMM">/**
<span class='line'> 29</span>  * Static property used to create a live scrolling Grid.
<span class='line'> 30</span>  */</span><span class="WHIT">
<span class='line'> 31</span> </span><span class="NAME">nitobi.grid.PAGINGMODE_LIVESCROLLING</span><span class="PUNC">=</span><span class="STRN">"livescrolling"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 32</span> 
<span class='line'> 33</span> </span><span class="COMM">/*
<span class='line'> 34</span> standard - remote standard paging (no caching)
<span class='line'> 35</span> livescrolling - remote livescrolling (with caching)
<span class='line'> 36</span> localpaging - local paging
<span class='line'> 37</span> nonpaging - local or remote data with no paging
<span class='line'> 38</span> smartpaging - remote standard paging (with caching)
<span class='line'> 39</span> locallivescrolling - local livescrolling
<span class='line'> 40</span> */</span><span class="WHIT">
<span class='line'> 41</span> 
<span class='line'> 42</span> </span><span class="COMM">/**
<span class='line'> 43</span>  * Creates a new Grid component.
<span class='line'> 44</span>  * @class The nitobi.grid.Grid class is used to create Grid components. More often than not, you'll be instantiating a Grid via a declaration.
<span class='line'> 45</span>  * For example, a databound grid declaration might look like this:
<span class='line'> 46</span>  * &lt;div class="code">
<span class='line'> 47</span>  * &lt;pre>&lt;code class="html">
<span class='line'> 48</span>  * &lt;ntb:grid id="DataboundGrid" gethandler="get.do" savehandler="save.do" mode="livescrolling"&gt;&lt;/ntb:grid&gt;
<span class='line'> 49</span>  * &lt;/code>&lt;/pre>
<span class='line'> 50</span>  * &lt;/div>
<span class='line'> 51</span>  * &lt;p>
<span class='line'> 52</span>  * A grid that uses locally defined data might declared like so:
<span class='line'> 53</span>  * &lt;/p>
<span class='line'> 54</span>  * &lt;div class="code">
<span class='line'> 55</span>  * &lt;pre>&lt;code class="html">
<span class='line'> 56</span>  * &lt;ntb:grid id="SimpleGrid" width="350" height="300" mode="locallivescrolling" datasourceid="data" toolbarenabled="true"&gt;
<span class='line'> 57</span>  * 	&lt;ntb:datasources&gt;
<span class='line'> 58</span>  *		&lt;ntb:datasource id="data"&gt;
<span class='line'> 59</span>  *			&lt;ntb:datasourcestructure FieldNames="Name|FavColor|FavAnimal"&nbsp;&nbsp;&gt;&lt;/ntb:datasourcestructure&gt;
<span class='line'> 60</span>  *			&lt;ntb:data&gt;
<span class='line'> 61</span>  *				&lt;ntb:e xi="1" a="Tammara Farley" b="blue" c="cat" &gt;&lt;/ntb:e&gt;
<span class='line'> 62</span>  *				&lt;ntb:e xi="2" a="Dwana Barton" b="red" c="dog"&gt;&lt;/ntb:e&gt;
<span class='line'> 63</span>  *				&lt;ntb:e xi="3" a="Lucas Blake" b="green" c="ferret"&gt;&lt;/ntb:e&gt;
<span class='line'> 64</span>  *				&lt;ntb:e xi="4" a="Lilli Bender" b="grey" c="squirrel"&gt;&lt;/ntb:e&gt;
<span class='line'> 65</span>  *				&lt;ntb:e xi="5" a="Emilia Foster" b="orange" c="pig"&gt;&lt;/ntb:e&gt;
<span class='line'> 66</span>  *				&lt;ntb:e xi="7" a="Crystal House" b="brown" c="horse"&gt;&lt;/ntb:e&gt;
<span class='line'> 67</span>  *				&lt;ntb:e xi="8" a="Lindsay Cohen" b="cyan" c="cow"&gt;&lt;/ntb:e&gt;
<span class='line'> 68</span>  *				&lt;ntb:e xi="12" a="Lindsay Bender" b="grey" c="squirrel"&gt;&lt;/ntb:e&gt;
<span class='line'> 69</span>  *				&lt;ntb:e xi="13" a="Emilia Foster" b="orange" c="pig"&gt;&lt;/ntb:e&gt;
<span class='line'> 70</span>  *				&lt;ntb:e xi="14" a="Dwana Irwin" b="beige" c="crocodile"&gt;&lt;/ntb:e&gt;
<span class='line'> 71</span>  *				&lt;ntb:e xi="15" a="Steve Lilli" b="brown" c="horse"&gt;&lt;/ntb:e&gt;
<span class='line'> 72</span>  *				&lt;ntb:e xi="16" a="Lindsay Dwana" b="cyan" c="cow"&gt;&lt;/ntb:e&gt;
<span class='line'> 73</span>  *			&lt;/ntb:data&gt;
<span class='line'> 74</span>  *		&lt;/ntb:datasource&gt;								
<span class='line'> 75</span>  *	&lt;/ntb:datasources&gt;
<span class='line'> 76</span>  * &lt;/ntb:grid&gt;&lt;/code>&lt;/pre>
<span class='line'> 77</span>  * &lt;/div>
<span class='line'> 78</span>  * The &lt;code>mode&lt;/code> attribute on the &lt;code>ntb:grid&lt;/code> declaration defines what sort of Grid to instantiate such as
<span class='line'> 79</span>  * LiveScrolling, LocalPaging, NonPaging, or Standard.
<span class='line'> 80</span>  * To instantiate through script a specific version of the Grid class should be instantiated such as: 
<span class='line'> 81</span>  * &lt;div class="code">
<span class='line'> 82</span>  * &lt;pre>&lt;code class="javascript">
<span class='line'> 83</span>  * var myGrid = new nitobi.grid.GridLiveScrolling();
<span class='line'> 84</span>  * myGrid.setPagingMode(nitobi.grid.PAGINGMODE_LIVESCROLLING);
<span class='line'> 85</span>  * myGrid.setDataMode(nitobi.data.DATAMODE_CACHING);
<span class='line'> 86</span>  * myGrid.setGetHandler("data.xml");
<span class='line'> 87</span>  * myGrid.attachToParentDomElement(document.getElementById("myGrid"));
<span class='line'> 88</span>  * myGrid.bind();
<span class='line'> 89</span>  * &lt;/code>&lt;/pre>
<span class='line'> 90</span>  * &lt;/div>
<span class='line'> 91</span>  * @constructor
<span class='line'> 92</span>  * @param {String} uid The unique ID of the Grid. 
<span class='line'> 93</span>  * @see #mode
<span class='line'> 94</span>  * @see nitobi.grid.GridLiveScrolling
<span class='line'> 95</span>  * @see nitobi.grid.GridNonpaging
<span class='line'> 96</span>  * @see nitobi.grid.GridLocalPage
<span class='line'> 97</span>  * @see nitobi.grid.GridStandard
<span class='line'> 98</span>  */</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="NAME">nitobi.grid.Grid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">uid</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.prepare</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">	</span><span class="COMM">// pre-compile accessors (if necessary)</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>103</span> 	 * @private
<span class='line'>104</span> 	 */</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">	</span><span class="NAME">EBAAutoRender</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>106</span> 
<span class='line'>107</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>108</span> 	 * @private
<span class='line'>109</span> 	 */</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">	</span><span class="NAME">this.disposal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>111</span> 
<span class='line'>112</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>113</span> 	 * @private
<span class='line'>114</span> 	 */</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">	</span><span class="NAME">this.uid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">uid</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nitobi.base.getUid</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>116</span> 
<span class='line'>117</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Move this into a base class</span><span class="WHIT">
<span class='line'>118</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>119</span> 	 * @private
<span class='line'>120</span> 	 * This is a hash of named attributes to XML DOM nodes (attributes or elements) in the Grid model.
<span class='line'>121</span> 	 */</span><span class="WHIT">
<span class='line'>122</span> </span><span class="WHIT">	</span><span class="NAME">this.modelNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>123</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>124</span> 	 * @private
<span class='line'>125</span> 	 * This is a hash of Grid Cell objects indexed by row_col.
<span class='line'>126</span> 	 */</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">	</span><span class="NAME">this.cachedCells</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span> 
<span class='line'>129</span> </span><span class="WHIT">	</span><span class="NAME">this.configureDefaults</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>130</span> 
<span class='line'>131</span> </span><span class="WHIT">	</span><span class="COMM">//	First thing is to register the dispose method onunload.</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">	</span><span class="COMM">//	We do not use he regular unload mechanism since it will not get call</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">	</span><span class="COMM">//	cause it will be detached by the global nitobi unload cleanup method.</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">	</span><span class="COMM">//	This will add the disposed method to a custom list that will also be called on global unload</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE6</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>136</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.html.addUnload</span><span class="PUNC">(</span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.dispose</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>137</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>138</span> 
<span class='line'>139</span> </span><span class="WHIT">	</span><span class="COMM">// Attach event handlers</span><span class="WHIT">
<span class='line'>140</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AttachToParent"</span><span class="PUNC">,</span><span class="NAME">this.initialize</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>141</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"DataReady"</span><span class="PUNC">,</span><span class="NAME">this.layout</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>142</span> 
<span class='line'>143</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterCellEdit"</span><span class="PUNC">,</span><span class="NAME">this.autoSave</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterRowInsert"</span><span class="PUNC">,</span><span class="NAME">this.autoSave</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterRowDelete"</span><span class="PUNC">,</span><span class="NAME">this.autoSave</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterPaste"</span><span class="PUNC">,</span><span class="NAME">this.autoSave</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterPaste"</span><span class="PUNC">,</span><span class="NAME">this.focus</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>148</span> 
<span class='line'>149</span> </span><span class="WHIT">	</span><span class="COMM">// We need to check if the horizontal scroll bar needs to be drawn after it's</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">	</span><span class="COMM">// rendered and everytime the grid is resized.</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.adjustHorizontalScrollBars</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterGridResize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.adjustHorizontalScrollBars</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>153</span> 
<span class='line'>154</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>155</span> 	 * Various events that are attached to the root of the Grid HTML.
<span class='line'>156</span> 	 * @type Array
<span class='line'>157</span> 	 */</span><span class="WHIT">
<span class='line'>158</span> </span><span class="WHIT">	</span><span class="NAME">this.events</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>159</span> 
<span class='line'>160</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>161</span> 	 * Various events that are attached to the Grid scroller element that contains both the data and header.
<span class='line'>162</span> 	 * @type Array
<span class='line'>163</span> 	 */</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT">	</span><span class="NAME">this.scrollerEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> 
<span class='line'>166</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>167</span> 	 * Various events that are attached to the Grid data element, which contains the rendered data cells.
<span class='line'>168</span> 	 * @type Array
<span class='line'>169</span> 	 */</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT">	</span><span class="NAME">this.cellEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span> 
<span class='line'>172</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>173</span> 	 * Various events that are attached to the Grid header element, which contains the column headers.
<span class='line'>174</span> 	 * @type Array
<span class='line'>175</span> 	 */</span><span class="WHIT">
<span class='line'>176</span> </span><span class="WHIT">	</span><span class="NAME">this.headerEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>177</span> 
<span class='line'>178</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>179</span> 	 * Various key events that are attached to the Grid key navigator element.
<span class='line'>180</span> 	 * @type Array
<span class='line'>181</span> 	 */</span><span class="WHIT">
<span class='line'>182</span> </span><span class="WHIT">	</span><span class="NAME">this.keyEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>183</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>184</span> 
<span class='line'>185</span> </span><span class="NAME">nitobi.lang.implement</span><span class="PUNC">(</span><span class="NAME">nitobi.grid.Grid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nitobi.Object</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>186</span> 
<span class='line'>187</span> </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ntb_gridp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Grid.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>188</span> 
<span class='line'>189</span> </span><span class="NAME">ntb_gridp.properties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>190</span> </span><span class="WHIT">	</span><span class="COMM">// JS properties</span><span class="WHIT">
<span class='line'>191</span> </span><span class="WHIT">	</span><span class="NAME">id</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ID"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>192</span> </span><span class="WHIT">	</span><span class="NAME">selection</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Selection"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>193</span> </span><span class="WHIT">	</span><span class="NAME">bound</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Bound"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>194</span> </span><span class="WHIT">	</span><span class="NAME">registeredto</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RegisteredTo"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">	</span><span class="NAME">licensekey</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"LicenseKey"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">	</span><span class="NAME">columns</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Columns"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">	</span><span class="NAME">columnsdefined</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ColumnsDefined"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">	</span><span class="NAME">declaration</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Declaration"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>199</span> </span><span class="WHIT">	</span><span class="NAME">datasource</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Datasource"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">	</span><span class="NAME">keygenerator</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"KeyGenerator"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">	</span><span class="NAME">version</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Version"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">3.01</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">	</span><span class="NAME">cellclicked</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CellClicked"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"j"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>203</span> 
<span class='line'>204</span> </span><span class="WHIT">		</span><span class="COMM">// XML properties</span><span class="WHIT">
<span class='line'>205</span> </span><span class="WHIT">	</span><span class="NAME">uid</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"uid"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">	</span><span class="NAME">datasourceid</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DatasourceId"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">	</span><span class="NAME">currentpageindex</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CurrentPageIndex"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">	</span><span class="NAME">columnindicatorsenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ColumnIndicatorsEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">	</span><span class="NAME">rowindicatorsenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowIndicatorsEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">	</span><span class="NAME">toolbarenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ToolbarEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">	</span><span class="NAME">toolbarheight</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ToolbarHeight"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">25</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">	</span><span class="NAME">rowhighlightenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowHighlightEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">	</span><span class="NAME">rowselectenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowSelectEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">	</span><span class="NAME">gridresizeenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GridResizeEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">	</span><span class="NAME">widthfixed</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"WidthFixed"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>216</span> </span><span class="WHIT">	</span><span class="NAME">heightfixed</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"HeightFixed"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>217</span> </span><span class="WHIT">	</span><span class="NAME">minwidth</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MinWidth"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">	</span><span class="NAME">minheight</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MinHeight"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">	</span><span class="NAME">singleclickeditenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"SingleClickEditEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">	</span><span class="NAME">autokeyenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"AutoKeyEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">	</span><span class="NAME">tooltipsenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ToolTipsEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">	</span><span class="NAME">entertab</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"EnterTab"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"down"</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">	</span><span class="NAME">hscrollbarenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"HScrollbarEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>224</span> </span><span class="WHIT">	</span><span class="NAME">vscrollbarenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"VScrollbarEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>225</span> </span><span class="WHIT">	</span><span class="NAME">rowheight</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowHeight"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">23</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">	</span><span class="NAME">headerheight</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"HeaderHeight"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">23</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">	</span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"top"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">	</span><span class="NAME">left</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"left"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">	</span><span class="NAME">scrollbarwidth</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"scrollbarWidth"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">	</span><span class="NAME">scrollbarheight</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"scrollbarHeight"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">22</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">	</span><span class="NAME">freezetop</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"freezetop"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">	</span><span class="NAME">frozenleftcolumncount</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"FrozenLeftColumnCount"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">	</span><span class="NAME">rowinsertenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowInsertEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">	</span><span class="NAME">rowdeleteenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowDeleteEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">	</span><span class="NAME">asynchronous</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Asynchronous"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">	</span><span class="NAME">autosaveenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"AutoSaveEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">	</span><span class="NAME">columncount</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ColumnCount"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>238</span> </span><span class="WHIT">	</span><span class="NAME">rowsperpage</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RowsPerPage"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">20</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>239</span> </span><span class="WHIT">	</span><span class="NAME">forcevalidate</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ForceValidate"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>240</span> </span><span class="WHIT">	</span><span class="NAME">height</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Height"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>241</span> </span><span class="WHIT">	</span><span class="NAME">lasterror</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"LastError"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>242</span> </span><span class="WHIT">	</span><span class="NAME">multirowselectenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MultiRowSelectEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">	</span><span class="NAME">multirowselectfield</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MultiRowSelectField"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>244</span> </span><span class="WHIT">	</span><span class="NAME">multirowselectattr</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MultiRowSelectAttr"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>245</span> </span><span class="WHIT">	</span><span class="NAME">gethandler</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GetHandler"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">	</span><span class="NAME">savehandler</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"SaveHandler"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">	</span><span class="NAME">width</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Width"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">	</span><span class="NAME">pagingmode</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"PagingMode"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"LiveScrolling"</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>249</span> </span><span class="WHIT">	</span><span class="NAME">datamode</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DataMode"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"Caching"</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>250</span> </span><span class="WHIT">	</span><span class="NAME">rendermode</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"RenderMode"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">	</span><span class="NAME">copyenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CopyEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">	</span><span class="NAME">pasteenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"PasteEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">	</span><span class="NAME">sortenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"SortEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">	</span><span class="NAME">sortmode</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"SortMode"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"default"</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">	</span><span class="NAME">editmode</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"EditMode"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">	</span><span class="NAME">expanding</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Expanding"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">	</span><span class="NAME">theme</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Theme"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"nitobi"</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">	</span><span class="NAME">cellborder</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CellBorder"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">	</span><span class="NAME">dragfillenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DragFillEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"x"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>261</span> </span><span class="WHIT">		</span><span class="COMM">// Events</span><span class="WHIT">
<span class='line'>262</span> </span><span class="WHIT">	</span><span class="NAME">oncellclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellClickEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">	</span><span class="NAME">onbeforecellclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeCellClickEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">	</span><span class="NAME">oncelldblclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellDblClickEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">	</span><span class="NAME">ondatareadyevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnDataReadyEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">	</span><span class="NAME">onhtmlreadyevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnHtmlReadyEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>267</span> </span><span class="WHIT">	</span><span class="NAME">ondatarenderedevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnDataRenderedEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>268</span> </span><span class="WHIT">	</span><span class="NAME">oncelldoubleclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellDoubleClickEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">	</span><span class="NAME">onafterloaddatapageevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterLoadDataPageEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">	</span><span class="NAME">onbeforeloaddatapageevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeLoadDataPageEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">	</span><span class="NAME">onafterloadpreviouspageevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterLoadPreviousPageEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">	</span><span class="NAME">onbeforeloadpreviouspageevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeLoadPreviousPageEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">	</span><span class="NAME">onafterloadnextpageevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterLoadNextPageEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">	</span><span class="NAME">onbeforeloadnextpageevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeLoadNextPageEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">	</span><span class="NAME">onbeforecelleditevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeCellEditEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">	</span><span class="NAME">onaftercelleditevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterCellEditEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">	</span><span class="NAME">onbeforerowinsertevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeRowInsertEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">	</span><span class="NAME">onafterrowinsertevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterRowInsertEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">	</span><span class="NAME">onbeforesortevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeSortEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">	</span><span class="NAME">onaftersortevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterSortEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>281</span> </span><span class="WHIT">	</span><span class="NAME">onbeforerefreshevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeRefreshEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>282</span> </span><span class="WHIT">	</span><span class="NAME">onafterrefreshevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterRefreshEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">	</span><span class="NAME">onbeforesaveevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeSaveEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">	</span><span class="NAME">onaftersaveevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterSaveEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">	</span><span class="NAME">onhandlererrorevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnHandlerErrorEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">	</span><span class="NAME">onrowblurevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnRowBlurEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>287</span> </span><span class="WHIT">	</span><span class="NAME">oncellfocusevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellFocusEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>288</span> </span><span class="WHIT">	</span><span class="NAME">onfocusevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnFocusEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>289</span> </span><span class="WHIT">	</span><span class="NAME">oncellblurevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellBlurEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>290</span> </span><span class="WHIT">	</span><span class="NAME">onafterrowdeleteevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterRowDeleteEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">	</span><span class="NAME">onbeforerowdeleteevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeRowDeleteEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">	</span><span class="NAME">oncellupdateevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellUpdateEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">	</span><span class="NAME">onrowfocusevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnRowFocusEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">	</span><span class="NAME">onbeforecopyevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeCopyEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>295</span> </span><span class="WHIT">	</span><span class="NAME">onaftercopyevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterCopyEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>296</span> </span><span class="WHIT">	</span><span class="NAME">onbeforepasteevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforePasteEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">	</span><span class="NAME">onafterpasteevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterPasteEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">	</span><span class="NAME">onerrorevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnErrorEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">	</span><span class="NAME">oncontextmenuevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnContextMenuEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">	</span><span class="NAME">oncellvalidateevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellValidateEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">	</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>302</span> </span><span class="WHIT">	</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>303</span> </span><span class="WHIT">	</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>304</span> </span><span class="WHIT">	</span><span class="NAME">onmouseoverevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnMouseOverEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>305</span> </span><span class="WHIT">	</span><span class="NAME">onmouseoutevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnMouseOutEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">	</span><span class="NAME">onmousemoveevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnMouseMoveEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">	</span><span class="NAME">onhitrowendevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnHitRowEndEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">	</span><span class="NAME">onhitrowstartevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnHitRowStartEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">	</span><span class="NAME">onafterdragfillevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterDragFillEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>310</span> </span><span class="WHIT">	</span><span class="NAME">onbeforedragfillevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeDragFillEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>311</span> </span><span class="WHIT">	</span><span class="NAME">onafterresizeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterResizeEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>312</span> </span><span class="WHIT">	</span><span class="NAME">onbeforeresizeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeResizeEvent"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">p</span><span class="PUNC">:</span><span class="STRN">"e"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>313</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>314</span> 
<span class='line'>315</span> </span><span class="COMM">// This is a temporary thing to map lowercase attribute names to uppercase ones</span><span class="WHIT">
<span class='line'>316</span> </span><span class="NAME">ntb_gridp.xColumnProperties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">	</span><span class="NAME">column</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">		</span><span class="NAME">align</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Align"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"left"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">		</span><span class="NAME">classname</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ClassName"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">		</span><span class="NAME">cssstyle</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CssStyle"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">		</span><span class="NAME">columnname</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ColumnName"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>322</span> </span><span class="WHIT">		</span><span class="NAME">type</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Type"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"text"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>323</span> </span><span class="WHIT">		</span><span class="NAME">datatype</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DataType"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"text"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">		</span><span class="NAME">editable</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Editable"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">		</span><span class="NAME">initial</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Initial"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">		</span><span class="NAME">label</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Label"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">		</span><span class="NAME">gethandler</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GetHandler"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>328</span> </span><span class="WHIT">		</span><span class="NAME">datasource</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DataSource"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>329</span> </span><span class="WHIT">		</span><span class="NAME">template</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Template"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">		</span><span class="NAME">templateurl</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"TemplateUrl"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">		</span><span class="NAME">maxlength</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MaxLength"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">255</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">		</span><span class="NAME">sortdirection</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"SortDirection"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"Desc"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">		</span><span class="NAME">sortenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"SortEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">		</span><span class="NAME">width</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Width"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">		</span><span class="NAME">visible</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Visible"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">		</span><span class="NAME">xdatafld</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"xdatafld"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">		</span><span class="NAME">value</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Value"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">		</span><span class="NAME">xi</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"xi"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">100</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">		</span><span class="NAME">oncellclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellClickEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">		</span><span class="NAME">onbeforecellclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeCellClickEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">		</span><span class="NAME">oncelldblclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellDblClickEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">		</span><span class="NAME">onheaderdoubleclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnHeaderDoubleClickEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>343</span> </span><span class="WHIT">		</span><span class="NAME">onheaderclickevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnHeaderClickEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>344</span> </span><span class="WHIT">		</span><span class="NAME">onbeforeresizeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeResizeEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>345</span> </span><span class="WHIT">		</span><span class="NAME">onafterresizeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterResizeEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>346</span> </span><span class="WHIT">		</span><span class="NAME">oncellvalidateevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellValidateEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>347</span> </span><span class="WHIT">		</span><span class="NAME">onbeforecelleditevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeCellEditEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">		</span><span class="NAME">onaftercelleditevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterCellEditEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">		</span><span class="NAME">oncellblurevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellBlurEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">		</span><span class="NAME">oncellfocusevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellFocusEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">		</span><span class="NAME">onbeforesortevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnBeforeSortEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>352</span> </span><span class="WHIT">		</span><span class="NAME">onaftersortevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnAfterSortEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">		</span><span class="NAME">oncellupdateevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnCellUpdateEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">	</span><span class="NAME">textcolumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">	</span><span class="NAME">numbercolumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">		</span><span class="NAME">align</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Align"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"right"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">		</span><span class="NAME">mask</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Mask"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"#,###.00"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>364</span> </span><span class="WHIT">		</span><span class="NAME">negativemask</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"NegativeMask"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>365</span> </span><span class="WHIT">		</span><span class="NAME">groupingseparator</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GroupingSeparator"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">","</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>366</span> </span><span class="WHIT">		</span><span class="NAME">decimalseparator</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DecimalSeparator"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"."</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>367</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>368</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>369</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>370</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>371</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>372</span> </span><span class="WHIT">	</span><span class="NAME">datecolumn</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>373</span> </span><span class="WHIT">		</span><span class="NAME">mask</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Mask"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"M/d/yyyy"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>374</span> </span><span class="WHIT">		</span><span class="NAME">calendarenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CalendarEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>375</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>376</span> </span><span class="WHIT">	</span><span class="NAME">listboxeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>377</span> </span><span class="WHIT">		</span><span class="NAME">datasourceid</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DatasourceId"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>378</span> </span><span class="WHIT">		</span><span class="NAME">datasource</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Datasource"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>379</span> </span><span class="WHIT">		</span><span class="NAME">gethandler</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GetHandler"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>380</span> </span><span class="WHIT">		</span><span class="NAME">displayfields</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DisplayFields"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>381</span> </span><span class="WHIT">		</span><span class="NAME">valuefield</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ValueField"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>382</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>385</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>387</span> </span><span class="WHIT">	</span><span class="NAME">lookupeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>388</span> </span><span class="WHIT">		</span><span class="NAME">datasourceid</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DatasourceId"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">		</span><span class="NAME">datasource</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Datasource"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">		</span><span class="NAME">gethandler</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GetHandler"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">		</span><span class="NAME">displayfields</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DisplayFields"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">		</span><span class="NAME">valuefield</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ValueField"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">		</span><span class="NAME">delay</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Delay"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">		</span><span class="NAME">size</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Size"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">6</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">		</span><span class="NAME">forcevalidoption</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ForceValidOption"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">		</span><span class="NAME">autocomplete</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"AutoComplete"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">		</span><span class="NAME">autoclear</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"AutoClear"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">		</span><span class="NAME">getonenter</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GetOnEnter"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">false</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">		</span><span class="NAME">referencecolumn</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ReferenceColumn"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">	</span><span class="NAME">checkboxeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">		</span><span class="NAME">datasourceid</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DatasourceId"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">		</span><span class="NAME">datasource</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Datasource"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">		</span><span class="NAME">gethandler</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"GetHandler"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">		</span><span class="NAME">displayfields</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"DisplayFields"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">		</span><span class="NAME">valuefield</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ValueField"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>411</span> </span><span class="WHIT">		</span><span class="NAME">checkedvalue</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CheckedValue"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>412</span> </span><span class="WHIT">		</span><span class="NAME">uncheckedvalue</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"UnCheckedValue"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>413</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>414</span> </span><span class="WHIT">	</span><span class="NAME">linkeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>415</span> </span><span class="WHIT">		</span><span class="NAME">openwindow</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OpenWindow"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>416</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>417</span> </span><span class="WHIT">	</span><span class="NAME">texteditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>418</span> </span><span class="WHIT">		</span><span class="NAME">maxlength</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MaxLength"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">255</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>419</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>420</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>421</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>422</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>423</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>424</span> </span><span class="WHIT">	</span><span class="NAME">numbereditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>425</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>426</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>427</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>428</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">	</span><span class="NAME">textareaeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">		</span><span class="NAME">maxlength</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"MaxLength"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"i"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="NUMB">255</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>433</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>434</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">	</span><span class="NAME">dateeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">		</span><span class="NAME">mask</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"Mask"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">"M/d/yyyy"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">		</span><span class="NAME">calendarenabled</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"CalendarEnabled"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"b"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="KEYW">true</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">		</span><span class="NAME">onkeydownevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyDownEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">		</span><span class="NAME">onkeyupevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyUpEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">		</span><span class="NAME">onkeypressevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnKeyPressEvent"</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">		</span><span class="NAME">onchangeevent</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"OnChangeEvent"</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">	</span><span class="NAME">imageeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">		</span><span class="NAME">imageurl</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">n</span><span class="PUNC">:</span><span class="STRN">"ImageUrl"</span><span class="PUNC">,</span><span class="NAME">t</span><span class="PUNC">:</span><span class="STRN">"s"</span><span class="PUNC">,</span><span class="NAME">d</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">	</span><span class="NAME">passwordeditor</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>450</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>451</span> 
<span class='line'>452</span> </span><span class="NAME">ntb_gridp.typeAccessorCreators</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">	</span><span class="NAME">s</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//string</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">	</span><span class="NAME">b</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//bool</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">	</span><span class="NAME">i</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="COMM">//integer</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">	</span><span class="NAME">n</span><span class="PUNC">:</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="COMM">//number</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>458</span> 
<span class='line'>459</span> </span><span class="NAME">ntb_gridp.createAccessors</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ntb_gridp.properties</span><span class="PUNC">[</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">	</span><span class="NAME">ntb_gridp</span><span class="PUNC">[</span><span class="STRN">"set"</span><span class="PUNC">+</span><span class="NAME">item.n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item.p</span><span class="PUNC">+</span><span class="NAME">item.t</span><span class="PUNC">+</span><span class="STRN">"SET"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">item.n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">	</span><span class="NAME">ntb_gridp</span><span class="PUNC">[</span><span class="STRN">"get"</span><span class="PUNC">+</span><span class="NAME">item.n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item.p</span><span class="PUNC">+</span><span class="NAME">item.t</span><span class="PUNC">+</span><span class="STRN">"GET"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">item.n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">	</span><span class="NAME">ntb_gridp</span><span class="PUNC">[</span><span class="STRN">"is"</span><span class="PUNC">+</span><span class="NAME">item.n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item.p</span><span class="PUNC">+</span><span class="NAME">item.t</span><span class="PUNC">+</span><span class="STRN">"GET"</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">item.n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">	</span><span class="NAME">ntb_gridp</span><span class="PUNC">[</span><span class="NAME">item.n</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item.d</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>465</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>466</span> 
<span class='line'>467</span> </span><span class="COMM">//ntb_gridp.properties</span><span class="WHIT">
<span class='line'>468</span> </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">name</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">ntb_gridp.properties</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>469</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>470</span> </span><span class="WHIT">	</span><span class="NAME">ntb_gridp.createAccessors</span><span class="PUNC">(</span><span class="NAME">name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>471</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>472</span> 
<span class='line'>473</span> </span><span class="COMM">/**
<span class='line'>474</span>  * Initializes the component and creates all children objects of the component. This method is called implicitly 
<span class='line'>475</span>  * when the component is attached to a DOM element in the web page. This is primarily for use by component developers
<span class='line'>476</span>  * @private
<span class='line'>477</span>  */</span><span class="WHIT">
<span class='line'>478</span> </span><span class="NAME">ntb_gridp.initialize</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>479</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>480</span> </span><span class="WHIT">	</span><span class="COMM">// Called when parent.addChild() occurs </span><span class="WHIT">
<span class='line'>481</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"Preinitialize"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>482</span> </span><span class="WHIT">	</span><span class="NAME">this.initializeFromCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>483</span> </span><span class="WHIT">	</span><span class="NAME">this.createChildren</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Each subclass overrides this method to create its own children</span><span class="WHIT">
<span class='line'>484</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterInitialize"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>485</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CreationComplete"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>486</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>487</span> 
<span class='line'>488</span> </span><span class="COMM">/**
<span class='line'>489</span>  * Initializes properties such as header height and row height from CSS classes.
<span class='line'>490</span>  * @private
<span class='line'>491</span>  */</span><span class="WHIT">
<span class='line'>492</span> </span><span class="NAME">ntb_gridp.initializeFromCss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>493</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>494</span> </span><span class="WHIT">	</span><span class="NAME">this.CellHoverColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedStyle</span><span class="PUNC">(</span><span class="STRN">"ntb-cell-hover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"backgroundColor"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"#C0C0FF"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>495</span> </span><span class="WHIT">	</span><span class="NAME">this.RowHoverColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedStyle</span><span class="PUNC">(</span><span class="STRN">"ntb-row-hover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"backgroundColor"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"#FFFFC0"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">	</span><span class="NAME">this.CellActiveColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedStyle</span><span class="PUNC">(</span><span class="STRN">"ntb-cell-active"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"backgroundColor"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"#F0C0FF"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">	</span><span class="NAME">this.RowActiveColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedStyle</span><span class="PUNC">(</span><span class="STRN">"ntb-row-active"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"backgroundColor"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"#FFC0FF"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>498</span> 
<span class='line'>499</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedStyle</span><span class="PUNC">(</span><span class="STRN">"ntb-row"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>500</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowHeight</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rowHeight</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>501</span> </span><span class="WHIT">		</span><span class="NAME">this.setRowHeight</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">rowHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>502</span> 
<span class='line'>503</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedStyle</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-header"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>504</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">headerHeight</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">headerHeight</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>505</span> </span><span class="WHIT">		</span><span class="NAME">this.setHeaderHeight</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">headerHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>506</span> 
<span class='line'>507</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.isStandards</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>508</span> </span><span class="WHIT">		</span><span class="COMM">// We need to get the cell padding values</span><span class="WHIT">
<span class='line'>509</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cellBorder</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getThemedClass</span><span class="PUNC">(</span><span class="STRN">"ntb-cell-border"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>510</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cellBorder</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>511</span> </span><span class="WHIT">			</span><span class="NAME">this.setCellBorder</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">cellBorder.borderLeftWidth</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">cellBorder.borderRightWidth</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">cellBorder.paddingLeft</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">cellBorder.paddingRight</span><span class="PUNC">+</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>512</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>513</span> </span><span class="COMM">/*
<span class='line'>514</span> 	// TODO:
<span class='line'>515</span> 	// In IE standards mode we need to do some rowHeight and headerHeight adjustments for padding ...
<span class='line'>516</span> 	// Maybe in Firefox too ...
<span class='line'>517</span> 	var cellClass = nitobi.html.Css.getClass(".ntb-cell");
<span class='line'>518</span> 	var rowClass = nitobi.html.Css.getClass(".ntb-row"+this.uid);
<span class='line'>519</span> 	rowClass.height = parseInt(rowClass.height) - (parseInt(cellClass.paddingTop) + parseInt(cellClass.paddingTop));
<span class='line'>520</span> */</span><span class="WHIT">
<span class='line'>521</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>522</span> 
<span class='line'>523</span> </span><span class="NAME">ntb_gridp.getThemedClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>524</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>525</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css.getRule</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getTheme</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">C.getRule</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">clazz</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>526</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>527</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">r.style</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>528</span> </span><span class="WHIT">		</span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">r.style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>529</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>530</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>531</span> 
<span class='line'>532</span> </span><span class="NAME">ntb_gridp.getThemedStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">clazz</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>533</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>534</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css.getClassStyle</span><span class="PUNC">(</span><span class="STRN">"."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getTheme</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">clazz</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">style</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>535</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>536</span> 
<span class='line'>537</span> </span><span class="COMM">/**
<span class='line'>538</span>  * Sets the xmlDataSource property of the various renderers associated with the Grid. This method is called from connectToDataSet.
<span class='line'>539</span>  * @private
<span class='line'>540</span>  * @param {nitobi.data.DataSet} dataSet The DataSet to connect the renders to.
<span class='line'>541</span>  * @see #connectToDataSet
<span class='line'>542</span>  */</span><span class="WHIT">
<span class='line'>543</span> </span><span class="NAME">ntb_gridp.connectRenderersToDataSet</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dataset</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>544</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>545</span> </span><span class="WHIT">	</span><span class="NAME">this.TopLeftRenderer.xmlDataSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>546</span> </span><span class="WHIT">	</span><span class="NAME">this.TopCenterRenderer.xmlDataSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>547</span> </span><span class="WHIT">	</span><span class="NAME">this.MidLeftRenderer.xmlDataSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>548</span> </span><span class="WHIT">	</span><span class="NAME">this.MidCenterRenderer.xmlDataSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>549</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>550</span> 
<span class='line'>551</span> </span><span class="COMM">/**
<span class='line'>552</span>  * Connects the component to a nitobi.data.DataTable in a nitobi.data.DataSet. 
<span class='line'>553</span>  * If the DataTable is specified then this will also call conntectToDataTable(). 
<span class='line'>554</span>  * Before a Grid can render any data it must be connected to a DataSet.
<span class='line'>555</span>  * @param {nitobi.data.DataSet} dataSet The DataSet to connect the component to.
<span class='line'>556</span>  * @param {nitobi.data.DataTable} dataTable The nitobi.data.DataSet to connect the component to.
<span class='line'>557</span>  * @see #connectToDataSet
<span class='line'>558</span>  * @private
<span class='line'>559</span>  */</span><span class="WHIT">
<span class='line'>560</span> </span><span class="NAME">ntb_gridp.connectToDataSet</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dataset</span><span class="PUNC">,</span><span class="NAME">table</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>561</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>562</span> </span><span class="WHIT">	</span><span class="NAME">this.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>563</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: why is this here and when is it used?</span><span class="WHIT">
<span class='line'>564</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.TopLeftRenderer</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>565</span> 
<span class='line'>566</span> </span><span class="WHIT">		</span><span class="NAME">this.connectRenderersToDataSet</span><span class="PUNC">(</span><span class="NAME">dataset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>567</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>568</span> </span><span class="WHIT">	</span><span class="NAME">this.connectToTable</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>569</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>570</span> 
<span class='line'>571</span> </span><span class="COMM">/**
<span class='line'>572</span>  * Connects a Grid to a table as specified by the table argument. If there is 
<span class='line'>573</span>  * no table argument it will attempt to connect a table with the id '_default'. 
<span class='line'>574</span>  * If no table can be found it will return false.  This is also called from 
<span class='line'>575</span>  * conntectToDataSet if the second argument is used when calling that function.&lt;br>&lt;br>
<span class='line'>576</span>  * The component subscribes to the following events from the 
<span class='line'>577</span>  * nitobi.data.DataTable:
<span class='line'>578</span>  * &lt;ul&gt;
<span class='line'>579</span>  * &lt;li&gt;RowCountChanged - nitobi.grid.Grid.setRowCount()&lt;/li&gt;
<span class='line'>580</span>  * &lt;li&gt;RowCountKnown - nitobi.grid.Grid.setRowCount()&lt;/li&gt;
<span class='line'>581</span>  * &lt;li&gt;StructureChanged - nitobigrid..Grid.updateStructure()&lt;/li&gt;
<span class='line'>582</span>  * &lt;li&gt;ColumnsInitialized - nitobi.grid.Grid.updateStructure()&lt;/li&gt;
<span class='line'>583</span>  * &lt;/ul&gt;
<span class='line'>584</span>  * After the DataTable is connected, the OnTableConnectedEvent will fire.
<span class='line'>585</span>  * @param {String} table The table to which the Grid should connect.
<span class='line'>586</span>  * @return {Boolean} Returns true if the table was successfully connected to and false otherwise.
<span class='line'>587</span>  */</span><span class="WHIT">
<span class='line'>588</span> </span><span class="NAME">ntb_gridp.connectToTable</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>589</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>590</span> </span><span class="WHIT">	</span><span class="COMM">// Use the table as the table id if it is a string</span><span class="WHIT">
<span class='line'>591</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>592</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.data.getTable</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>593</span> </span><span class="WHIT">	</span><span class="COMM">// Use the table itself if it's an object</span><span class="WHIT">
<span class='line'>594</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">table</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>595</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">table</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>596</span> </span><span class="WHIT">	</span><span class="COMM">// Use the default table if it exists</span><span class="WHIT">
<span class='line'>597</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data.getTable</span><span class="PUNC">(</span><span class="STRN">'_default'</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">''</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>598</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.data.getTable</span><span class="PUNC">(</span><span class="STRN">'_default'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>599</span> </span><span class="WHIT">	</span><span class="COMM">// Otherwise we have problems</span><span class="WHIT">
<span class='line'>600</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>601</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>602</span> 
<span class='line'>603</span> </span><span class="WHIT">	</span><span class="NAME">this.connected</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>604</span> </span><span class="WHIT">	</span><span class="NAME">this.updateStructure</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>605</span> 
<span class='line'>606</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>607</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">L</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>608</span> 
<span class='line'>609</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"DataReady"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.handleHandlerError</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>610</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"DataReady"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.syncWithData</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>611</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"DataSorted"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.syncWithData</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>612</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"RowInserted"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.syncWithData</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>613</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"RowDeleted"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.syncWithData</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>614</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"RowCountChanged"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.setRowCount</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>615</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"PastEndOfData"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.adjustRowCount</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>616</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"RowCountKnown"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.finalizeRowCount</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>617</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"StructureChanged"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.updateStructure</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>618</span> </span><span class="WHIT">	</span><span class="NAME">dt.subscribe</span><span class="PUNC">(</span><span class="STRN">"ColumnsInitialized"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.updateStructure</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>619</span> 
<span class='line'>620</span> </span><span class="WHIT">	</span><span class="NAME">this.dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>621</span> </span><span class="WHIT">	</span><span class="NAME">this.datatable.setOnGenerateKey</span><span class="PUNC">(</span><span class="NAME">this.getKeyGenerator</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>622</span> 
<span class='line'>623</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">'TableConnected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.datatable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>624</span> 
<span class='line'>625</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>626</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>627</span> 
<span class='line'>628</span> </span><span class="COMM">/**
<span class='line'>629</span>  * Ensures that the Grid is connected to a DataTable. If there is no connected 
<span class='line'>630</span>  * DataTable it will create a new DataTable with ID "_default" and use the 
<span class='line'>631</span>  * GetHandler, SaveHandler and DataMode properties on the Grid.
<span class='line'>632</span>  */</span><span class="WHIT">
<span class='line'>633</span> </span><span class="NAME">ntb_gridp.ensureConnected</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>634</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>635</span> </span><span class="WHIT">	</span><span class="COMM">// Case: nodataSet has been been defined</span><span class="WHIT">
<span class='line'>636</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>637</span> </span><span class="WHIT">		</span><span class="NAME">this.data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.data.DataSet</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>638</span> </span><span class="WHIT">		</span><span class="NAME">this.data.initialize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>639</span> 
<span class='line'>640</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.data.DataTable</span><span class="PUNC">(</span><span class="NAME">this.getDataMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getPagingMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.PAGINGMODE_LIVESCROLLING</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">this.isAutoKeyEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>641</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.initialize</span><span class="PUNC">(</span><span class="STRN">"_default"</span><span class="PUNC">,</span><span class="NAME">this.getGetHandler</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.getSaveHandler</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>642</span> </span><span class="WHIT">		</span><span class="NAME">this.data.add</span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>643</span> </span><span class="WHIT">		</span><span class="NAME">this.connectToDataSet</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>644</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>645</span> </span><span class="WHIT">	</span><span class="COMM">// Case: no dataTable has been defined</span><span class="WHIT">
<span class='line'>646</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: this only works with remote datasources ...</span><span class="WHIT">
<span class='line'>647</span> </span><span class="WHIT">	</span><span class="COMM">// this is grid mode dependent.</span><span class="WHIT">
<span class='line'>648</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>649</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable</span><span class="PUNC">=</span><span class="NAME">this.data.getTable</span><span class="PUNC">(</span><span class="STRN">"_default"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>650</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>651</span> </span><span class="WHIT">			</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.data.DataTable</span><span class="PUNC">(</span><span class="NAME">this.getDataMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getPagingMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.PAGINGMODE_LIVESCROLLING</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isAutoKeyEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>652</span> </span><span class="WHIT">			</span><span class="NAME">this.datatable.initialize</span><span class="PUNC">(</span><span class="STRN">"_default"</span><span class="PUNC">,</span><span class="NAME">this.getGetHandler</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.getSaveHandler</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>653</span> </span><span class="WHIT">			</span><span class="NAME">this.data.add</span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>654</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>655</span> </span><span class="WHIT">		</span><span class="NAME">this.connectToDataSet</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>656</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>657</span> </span><span class="WHIT">	</span><span class="NAME">this.connected</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>658</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>659</span> 
<span class='line'>660</span> </span><span class="COMM">/**
<span class='line'>661</span>  * Updates the component with information about a connected DataTable. This will be called when the OnStructureChangedEvent 
<span class='line'>662</span>  * or OnColumnsInitializedEvent is fired from the DataTable.
<span class='line'>663</span>  * @private
<span class='line'>664</span>  */</span><span class="WHIT">
<span class='line'>665</span> </span><span class="NAME">ntb_gridp.updateStructure</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>666</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>667</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.inferredColumns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>668</span> </span><span class="WHIT">		</span><span class="NAME">this.defineColumns</span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>669</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>670</span> </span><span class="WHIT">	</span><span class="NAME">this.mapColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>671</span> 
<span class='line'>672</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.TopLeftRenderer</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>673</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>674</span> </span><span class="WHIT">		</span><span class="NAME">this.defineColumnBindings</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>675</span> </span><span class="WHIT">		</span><span class="NAME">this.defineColumnsFinalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>676</span> </span><span class="COMM">//		this.makeXSL();</span><span class="WHIT">
<span class='line'>677</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>678</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>679</span> 
<span class='line'>680</span> </span><span class="COMM">/**
<span class='line'>681</span>  * Sets the &lt;code>fieldMap&lt;/code> property of the Grid to match that of the connected DataTable. This is called from &lt;code>updateStructure()&lt;/code>.
<span class='line'>682</span>  * @private
<span class='line'>683</span>  */</span><span class="WHIT">
<span class='line'>684</span> </span><span class="NAME">ntb_gridp.mapColumns</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>685</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>686</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: This seems a bit sketchy to keep in sync if we ever use this.fieldMap</span><span class="WHIT">
<span class='line'>687</span> </span><span class="WHIT">	</span><span class="COMM">// if so we should be using a setter and preferably creating the connection between the two properties</span><span class="WHIT">
<span class='line'>688</span> </span><span class="WHIT">	</span><span class="NAME">this.fieldMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable.fieldMap</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>689</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>690</span> 
<span class='line'>691</span> </span><span class="COMM">/**
<span class='line'>692</span>  * @private
<span class='line'>693</span>  */</span><span class="WHIT">
<span class='line'>694</span> </span><span class="NAME">ntb_gridp.configureDefaults</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>695</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>696</span> </span><span class="WHIT">	</span><span class="COMM">// Note: properties should be assigned before components are attached or initialized (to avoid duplicate code execution)</span><span class="WHIT">
<span class='line'>697</span> </span><span class="WHIT">	</span><span class="COMM">// Assume that accessors expect that sub-components haven't been created yet.</span><span class="WHIT">
<span class='line'>698</span> </span><span class="WHIT">	</span><span class="COMM">// Make settings quickly - defer work until validation</span><span class="WHIT">
<span class='line'>699</span> 
<span class='line'>700</span> </span><span class="WHIT">	</span><span class="NAME">this.initializeModel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>701</span> </span><span class="WHIT">	</span><span class="NAME">this.displayedFirstRow</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>702</span> </span><span class="WHIT">	</span><span class="NAME">this.displayedRowCount</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>703</span> </span><span class="WHIT">	</span><span class="NAME">this.localFilter</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>704</span> </span><span class="WHIT">	</span><span class="NAME">this.columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>705</span> </span><span class="WHIT">	</span><span class="NAME">this.fieldMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>706</span> </span><span class="WHIT">	</span><span class="NAME">this.frameRendered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>707</span> </span><span class="WHIT">	</span><span class="NAME">this.connected</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>708</span> </span><span class="WHIT">	</span><span class="NAME">this.inferredColumns</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>709</span> </span><span class="WHIT">	</span><span class="NAME">this.selectedRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>710</span> 
<span class='line'>711</span> </span><span class="WHIT">	</span><span class="NAME">this.minHeight</span><span class="PUNC">=</span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>712</span> </span><span class="WHIT">	</span><span class="NAME">this.minWidth</span><span class="PUNC">=</span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>713</span> 
<span class='line'>714</span> </span><span class="WHIT">	</span><span class="NAME">this.setRowCount</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>715</span> </span><span class="WHIT">	</span><span class="NAME">this.layoutValid</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>716</span> 
<span class='line'>717</span> </span><span class="WHIT">	</span><span class="COMM">//	This is a hack for backwards compat</span><span class="WHIT">
<span class='line'>718</span> </span><span class="WHIT">	</span><span class="COMM">//	It is set in the bind method by looking at the data format returned from the server</span><span class="WHIT">
<span class='line'>719</span> </span><span class="WHIT">	</span><span class="NAME">this.oldVersion</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>720</span> 
<span class='line'>721</span> </span><span class="WHIT">	</span><span class="COMM">// create XSL Processors</span><span class="WHIT">
<span class='line'>722</span> </span><span class="WHIT">	</span><span class="NAME">this.frameCssXslProc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.frameCssXslProc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>723</span> </span><span class="WHIT">	</span><span class="NAME">this.frameXslProc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.frameXslProc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>724</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>725</span> 
<span class='line'>726</span> </span><span class="COMM">/**
<span class='line'>727</span>  * Attaches any events to the component DOM elements after the intial render. Common DOM events attached here include KeyPress, SelectStart and ContextMenu.
<span class='line'>728</span>  * @private
<span class='line'>729</span>  * @align
<span class='line'>730</span>  */</span><span class="WHIT">
<span class='line'>731</span> </span><span class="NAME">ntb_gridp.attachDomEvents</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>732</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>733</span> </span><span class="WHIT">	</span><span class="COMM">// The only way to attach the selection-prevention event in an XHTML compliant way.</span><span class="WHIT">
<span class='line'>734</span> </span><span class="WHIT">	</span><span class="COMM">// This is only used (and will only work) for IE - for Moz/others we have CSS that handles it.</span><span class="WHIT">
<span class='line'>735</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="NAME">this.UiContainer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nitobi.html.getFirstChild</span><span class="PUNC">(</span><span class="NAME">this.UiContainer</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">'The Grid has not been attached to the DOM yet using attachToDom method. Therefore, attachDomEvents cannot proceed.'</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">EBA_THROW</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>736</span> 
<span class='line'>737</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dGridElement</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getGridContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>738</span> 
<span class='line'>739</span> </span><span class="WHIT">	</span><span class="COMM">// Header specific events</span><span class="WHIT">
<span class='line'>740</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">he</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.headerEvents</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>741</span> </span><span class="WHIT">	</span><span class="NAME">he.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousedown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleHeaderMouseDown</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>742</span> </span><span class="WHIT">	</span><span class="NAME">he.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mouseup'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleHeaderMouseUp</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>743</span> </span><span class="WHIT">	</span><span class="NAME">he.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousemove'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleHeaderMouseMove</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>744</span> 
<span class='line'>745</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.html.attachEvents</span><span class="PUNC">(</span><span class="NAME">this.getHeaderContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">he</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>746</span> 
<span class='line'>747</span> </span><span class="WHIT">	</span><span class="COMM">// Data or cell specific events</span><span class="WHIT">
<span class='line'>748</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ce</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.cellEvents</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>749</span> </span><span class="WHIT">	</span><span class="NAME">ce.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousedown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleCellMouseDown</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>750</span> </span><span class="WHIT">	</span><span class="NAME">ce.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousemove'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleCellMouseMove</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>751</span> 
<span class='line'>752</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.html.attachEvents</span><span class="PUNC">(</span><span class="NAME">this.getDataContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ce</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>753</span> 
<span class='line'>754</span> </span><span class="WHIT">	</span><span class="COMM">// Scroller specific (ie Header + Data) events</span><span class="WHIT">
<span class='line'>755</span> </span><span class="WHIT">	</span><span class="COMM">//var se = this.scrollerEvents;</span><span class="WHIT">
<span class='line'>756</span> </span><span class="WHIT">	</span><span class="COMM">//se.push({type:"selectstart", handler:function(evt) { return false; }});</span><span class="WHIT">
<span class='line'>757</span> 
<span class='line'>758</span> </span><span class="WHIT">	</span><span class="COMM">//nitobi.html.attachEvents(this.getScrollerContainer(), se, this);</span><span class="WHIT">
<span class='line'>759</span> 
<span class='line'>760</span> </span><span class="WHIT">	</span><span class="COMM">// Global Grid events</span><span class="WHIT">
<span class='line'>761</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ge</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.events</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>762</span> </span><span class="WHIT">	</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'contextmenu'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleContextMenu</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>763</span> </span><span class="WHIT">	</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousedown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseDown</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>764</span> </span><span class="WHIT">	</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mouseup'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseUp</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>765</span> </span><span class="WHIT">	</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousemove'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseMove</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>766</span> </span><span class="WHIT">	</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mouseout'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseOut</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>767</span> </span><span class="WHIT">	</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mouseover'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseOver</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>768</span> 
<span class='line'>769</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: decode these sorts of registrations in the event manager.</span><span class="WHIT">
<span class='line'>770</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.browser.MOZ</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>771</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>772</span> </span><span class="WHIT">		</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'mousewheel'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseWheel</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>773</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>774</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="COMM">// MOZ</span><span class="WHIT">
<span class='line'>775</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>776</span> </span><span class="WHIT">		</span><span class="COMM">// Not sure this actually works since in the scorllhoriz and vert methods we focus again.</span><span class="WHIT">
<span class='line'>777</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.html.attachEvent</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"vscrollclip"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.focus</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>778</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.html.attachEvent</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"hscrollclip"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.focus</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>779</span> 
<span class='line'>780</span> </span><span class="WHIT">		</span><span class="COMM">// This one needs to be tested still ...</span><span class="WHIT">
<span class='line'>781</span> </span><span class="WHIT">		</span><span class="NAME">ge.push</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'DOMMouseScroll'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleMouseWheel</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>782</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>783</span> 
<span class='line'>784</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.html.attachEvents</span><span class="PUNC">(</span><span class="NAME">dGridElement</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ge</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>785</span> 
<span class='line'>786</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>787</span> </span><span class="WHIT">		</span><span class="NAME">dGridElement.onselectstart</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">id</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="NAME">window.event.srcElement.id</span><span class="PUNC">;</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">id.indexOf</span><span class="PUNC">(</span><span class="STRN">'selectbox'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">id.indexOf</span><span class="PUNC">(</span><span class="STRN">'cell'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>788</span> 
<span class='line'>789</span> </span><span class="WHIT">	</span><span class="COMM">// If it is IE we choose the entire grid to be the keyNav focused element </span><span class="WHIT">
<span class='line'>790</span> </span><span class="WHIT">	</span><span class="COMM">// otherwise we use a special hidden element for Firefox for foucs performance reason</span><span class="WHIT">
<span class='line'>791</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>792</span> </span><span class="WHIT">		</span><span class="NAME">this.keyNav</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getScrollerContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>793</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>794</span> </span><span class="WHIT">		</span><span class="NAME">this.keyNav</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-keynav"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>795</span> 
<span class='line'>796</span> </span><span class="WHIT">	</span><span class="NAME">this.keyEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="WHIT">
<span class='line'>797</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'keydown'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleKey</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>798</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'keyup'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleKeyUp</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>799</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="NAME">type</span><span class="PUNC">:</span><span class="STRN">'keypress'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">handler</span><span class="PUNC">:</span><span class="NAME">this.handleKeyPress</span><span class="PUNC">}</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>800</span> 
<span class='line'>801</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.html.attachEvents</span><span class="PUNC">(</span><span class="NAME">this.keyNav</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.keyEvents</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>802</span> 
<span class='line'>803</span> </span><span class="WHIT">	</span><span class="COMM">// Attach the DOM events for grid resizing</span><span class="WHIT">
<span class='line'>804</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rightGrabby</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-resizeright"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>805</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">btmGrabby</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-resizebottom"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>806</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rightGrabby</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>807</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>808</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.html.attachEvent</span><span class="PUNC">(</span><span class="NAME">rightGrabby</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.beforeResize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>809</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.html.attachEvent</span><span class="PUNC">(</span><span class="NAME">btmGrabby</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"mousedown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.beforeResize</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>810</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>811</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>812</span> 
<span class='line'>813</span> </span><span class="COMM">/**
<span class='line'>814</span>  * @private
<span class='line'>815</span>  */</span><span class="WHIT">
<span class='line'>816</span> </span><span class="NAME">ntb_gridp.hoverCell</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>817</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>818</span> </span><span class="WHIT">	</span><span class="COMM">// This will check if the BG color is the expected BG color</span><span class="WHIT">
<span class='line'>819</span> </span><span class="WHIT">	</span><span class="COMM">// and only apply the hover if it is</span><span class="WHIT">
<span class='line'>820</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hovered</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>821</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>822</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">h.style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>823</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hs.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.CellHoverColor</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>824</span> </span><span class="WHIT">			</span><span class="NAME">hs.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hoveredbg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>825</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>826</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">==</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>827</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.style</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>828</span> </span><span class="WHIT">	</span><span class="NAME">this.hoveredbg</span><span class="PUNC">=</span><span class="NAME">cs.backgroundColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>829</span> </span><span class="WHIT">	</span><span class="NAME">this.hovered</span><span class="PUNC">=</span><span class="NAME">cell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>830</span> </span><span class="WHIT">	</span><span class="NAME">cs.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.CellHoverColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>831</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>832</span> 
<span class='line'>833</span> </span><span class="COMM">/**
<span class='line'>834</span>  * @private
<span class='line'>835</span>  */</span><span class="WHIT">
<span class='line'>836</span> </span><span class="NAME">ntb_gridp.hoverRow</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>837</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>838</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isRowHighlightEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>839</span> 
<span class='line'>840</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">C</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>841</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.leftrowhovered</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.leftrowhovered</span><span class="PUNC">!=</span><span class="NAME">this.leftActiveRow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>842</span> </span><span class="WHIT">		</span><span class="NAME">this.leftrowhovered.style.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.leftrowhoveredbg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>843</span> </span><span class="WHIT">		</span><span class="COMM">//C.removeClass(this.leftrowhovered, "ntb-row-hover", true);</span><span class="WHIT">
<span class='line'>844</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>845</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.midrowhovered</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.midrowhovered</span><span class="PUNC">!=</span><span class="NAME">this.midActiveRow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>846</span> </span><span class="WHIT">		</span><span class="NAME">this.midrowhovered.style.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.midrowhoveredbg</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>847</span> </span><span class="WHIT">		</span><span class="COMM">//C.removeClass(this.midrowhovered, "ntb-row-hover", true);</span><span class="WHIT">
<span class='line'>848</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>849</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">==</span><span class="NAME">this.activeRow</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>850</span> 
<span class='line'>851</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">offset</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>852</span> 
<span class='line'>853</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.getFirstChild</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>854</span> 
<span class='line'>855</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row.getRowNumber</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>856</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row.getRowElements</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rowNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>857</span> 
<span class='line'>858</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowNodes.left</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rowNodes.left</span><span class="PUNC">!=</span><span class="NAME">this.leftActiveRow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>859</span> </span><span class="WHIT">		</span><span class="NAME">this.leftrowhoveredbg</span><span class="PUNC">=</span><span class="NAME">rowNodes.left.style.backgroundColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>860</span> </span><span class="WHIT">		</span><span class="NAME">this.leftrowhovered</span><span class="PUNC">=</span><span class="NAME">rowNodes.left</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>861</span> </span><span class="WHIT">		</span><span class="NAME">rowNodes.left.style.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.RowHoverColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>862</span> </span><span class="WHIT">		</span><span class="COMM">//C.addClass(rowNodes.left, "ntb-row-hover", true);</span><span class="WHIT">
<span class='line'>863</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>864</span> 
<span class='line'>865</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowNodes.mid</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">rowNodes.mid</span><span class="PUNC">!=</span><span class="NAME">this.midActiveRow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>866</span> </span><span class="WHIT">		</span><span class="NAME">this.midrowhoveredbg</span><span class="PUNC">=</span><span class="NAME">rowNodes.mid.style.backgroundColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>867</span> </span><span class="WHIT">		</span><span class="NAME">this.midrowhovered</span><span class="PUNC">=</span><span class="NAME">rowNodes.mid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>868</span> </span><span class="WHIT">		</span><span class="NAME">rowNodes.mid.style.backgroundColor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.RowHoverColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>869</span> </span><span class="WHIT">		</span><span class="COMM">//C.addClass(rowNodes.mid, "ntb-row-hover", true);</span><span class="WHIT">
<span class='line'>870</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>871</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>872</span> 
<span class='line'>873</span> </span><span class="COMM">/**
<span class='line'>874</span>  * @private
<span class='line'>875</span>  */</span><span class="WHIT">
<span class='line'>876</span> </span><span class="NAME">ntb_gridp.clearHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>877</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>878</span> </span><span class="WHIT">	</span><span class="COMM">// Clear hover</span><span class="WHIT">
<span class='line'>879</span> </span><span class="WHIT">	</span><span class="NAME">this.hoverCell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>880</span> </span><span class="WHIT">	</span><span class="NAME">this.hoverRow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>881</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>882</span> 
<span class='line'>883</span> </span><span class="COMM">/**
<span class='line'>884</span>  * Event handler for the mouseover event.
<span class='line'>885</span>  * @param {Event} evt The Event object.
<span class='line'>886</span>  * @private
<span class='line'>887</span>  */</span><span class="WHIT">
<span class='line'>888</span> </span><span class="NAME">ntb_gridp.handleMouseOver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>889</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>890</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"MouseOver"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>891</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>892</span> 
<span class='line'>893</span> </span><span class="COMM">/**
<span class='line'>894</span>  * Event handler for the mouseout event.
<span class='line'>895</span>  * @param {Event} evt The Event object.
<span class='line'>896</span>  * @private
<span class='line'>897</span>  */</span><span class="WHIT">
<span class='line'>898</span> </span><span class="NAME">ntb_gridp.handleMouseOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>899</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>900</span> </span><span class="WHIT">	</span><span class="NAME">this.clearHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>901</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"MouseOut"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>902</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>903</span> 
<span class='line'>904</span> </span><span class="COMM">/**
<span class='line'>905</span>  * Event handler for the mouse wheel event.
<span class='line'>906</span>  * @param {Event} evt The Event object.
<span class='line'>907</span>  * @private
<span class='line'>908</span>  */</span><span class="WHIT">
<span class='line'>909</span> </span><span class="NAME">ntb_gridp.handleMouseDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>910</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>911</span> </span><span class="WHIT">	</span><span class="COMM">// check if grid is in edit mode - if so, validate input first</span><span class="WHIT">
<span class='line'>912</span> </span><span class="WHIT">	</span><span class="COMM">//if (this.isEditMode())</span><span class="WHIT">
<span class='line'>913</span> </span><span class="WHIT">		</span><span class="COMM">//if (!this.cellEditor.checkValidity(evt)) return;</span><span class="WHIT">
<span class='line'>914</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>915</span> 
<span class='line'>916</span> </span><span class="COMM">/**
<span class='line'>917</span>  * @private
<span class='line'>918</span>  */</span><span class="WHIT">
<span class='line'>919</span> </span><span class="NAME">ntb_gridp.handleHeaderMouseDown</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>920</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>921</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.findActiveCell</span><span class="PUNC">(</span><span class="NAME">evt.srcElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>922</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>923</span> 
<span class='line'>924</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>925</span> 
<span class='line'>926</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.headerResizeHover</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>927</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>928</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">colNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>929</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeColumnResizeEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeColumnResizeEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>930</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">col.getOnBeforeResizeEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">beforeColumnResizeEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>931</span> 
<span class='line'>932</span> </span><span class="WHIT">		</span><span class="NAME">this.columnResizer.startResize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colNumber</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>933</span> 
<span class='line'>934</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>935</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>936</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>937</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>938</span> </span><span class="WHIT">		</span><span class="NAME">this.headerClicked</span><span class="PUNC">(</span><span class="NAME">colNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>939</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HeaderDown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>940</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>941</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>942</span> 
<span class='line'>943</span> </span><span class="COMM">/**
<span class='line'>944</span>  * @private
<span class='line'>945</span>  */</span><span class="WHIT">
<span class='line'>946</span> </span><span class="NAME">ntb_gridp.handleCellMouseDown</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>947</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>948</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT">  </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.findActiveCell</span><span class="PUNC">(</span><span class="NAME">evt.srcElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>949</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>950</span> 
<span class='line'>951</span> </span><span class="WHIT">	</span><span class="COMM">//	Check if the shift key is not pressed and if not then start selecting</span><span class="WHIT">
<span class='line'>952</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">evt.shiftKey</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>953</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>954</span> </span><span class="WHIT">		</span><span class="COMM">// Fire the beforecellclick event on the grid and column</span><span class="WHIT">
<span class='line'>955</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activeColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelectedColumnObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>956</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clickEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCellClickEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getSelectedCellObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>957</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeCellClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clickEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">activeColumn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">activeColumn.getOnBeforeCellClickEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clickEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>958</span> 
<span class='line'>959</span> </span><span class="WHIT">		</span><span class="COMM">// Set the state variable indicating that we are have started a click...</span><span class="WHIT">
<span class='line'>960</span> </span><span class="WHIT">		</span><span class="COMM">// This may turn into drag in cellMouseMove</span><span class="WHIT">
<span class='line'>961</span> </span><span class="WHIT">		</span><span class="NAME">this.setCellClicked</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>962</span> 
<span class='line'>963</span> </span><span class="WHIT">		</span><span class="COMM">// SetActiveCell will collapse the selection onto the specified cell</span><span class="WHIT">
<span class='line'>964</span> </span><span class="WHIT">		</span><span class="NAME">this.setActiveCell</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">evt.metaKey</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>965</span> 
<span class='line'>966</span> </span><span class="WHIT">		</span><span class="NAME">this.selection.selecting</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>967</span> 
<span class='line'>968</span> </span><span class="WHIT">		</span><span class="COMM">// Fire the cellclick event on the grid and column</span><span class="WHIT">
<span class='line'>969</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activeColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelectedColumnObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>970</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clickEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCellClickEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getSelectedCellObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>971</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CellClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clickEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>972</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">activeColumn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">activeColumn.getOnCellClickEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">clickEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>973</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>974</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>975</span> 
<span class='line'>976</span> </span><span class="COMM">/**
<span class='line'>977</span>  * @private
<span class='line'>978</span>  */</span><span class="WHIT">
<span class='line'>979</span> </span><span class="NAME">ntb_gridp.handleMouseUp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evtObj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>980</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>981</span> </span><span class="WHIT">	</span><span class="COMM">// This mouseup may be due to a selection expansion - so lets just pass </span><span class="WHIT">
<span class='line'>982</span> </span><span class="WHIT">	</span><span class="COMM">// this on to the selection mouseup handler to where it will deal with it if we are in expanding mode.</span><span class="WHIT">
<span class='line'>983</span> </span><span class="WHIT">	</span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">handleGrabbyMouseUp</span><span class="PUNC">(</span><span class="NAME">evtObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>984</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>985</span> 
<span class='line'>986</span> </span><span class="COMM">/**
<span class='line'>987</span>  * MouseUp event handler for the Grid header.
<span class='line'>988</span>  */</span><span class="WHIT">
<span class='line'>989</span> </span><span class="NAME">ntb_gridp.handleHeaderMouseUp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>990</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>991</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">domMouseUpCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.findActiveCell</span><span class="PUNC">(</span><span class="NAME">evt.srcElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>992</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">domMouseUpCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>993</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>994</span> </span><span class="WHIT">		</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>995</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>996</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>997</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">domMouseUpCell.getAttribute</span><span class="PUNC">(</span><span class="STRN">"xi"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>998</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HeaderUp"</span><span class="PUNC">,</span><span class="NAME">columnNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>999</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1000</span> 
<span class='line'>1001</span> </span><span class="COMM">/**
<span class='line'>1002</span>  * @private
<span class='line'>1003</span>  * Event handler for the mouse move event.
<span class='line'>1004</span>  */</span><span class="WHIT">
<span class='line'>1005</span> </span><span class="NAME">ntb_gridp.handleMouseMove</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1006</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1007</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"MouseMove"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1008</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1009</span> 
<span class='line'>1010</span> </span><span class="COMM">/**
<span class='line'>1011</span>  * @private
<span class='line'>1012</span>  */</span><span class="WHIT">
<span class='line'>1013</span> </span><span class="NAME">ntb_gridp.handleHeaderMouseMove</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1014</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">=</span><span class="NAME">this.findActiveCell</span><span class="PUNC">(</span><span class="NAME">evt.srcElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1015</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1016</span> 
<span class='line'>1017</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.headerResizeHover</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1018</span> </span><span class="WHIT">		</span><span class="NAME">cell.style.cursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"w-resize"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1019</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1020</span> </span><span class="WHIT">		</span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">?</span><span class="NAME">cell.style.cursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"hand"</span><span class="PUNC">:</span><span class="NAME">cell.style.cursor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"pointer"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1021</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1022</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1023</span> 
<span class='line'>1024</span> </span><span class="COMM">/**
<span class='line'>1025</span>  * Calculates if the mouse if near the resize grabby
<span class='line'>1026</span>  * TODO: need to get rid of this and put in a DOM node for this 
<span class='line'>1027</span>  * @private
<span class='line'>1028</span>  * @param {Object} evt
<span class='line'>1029</span>  * @param {Object} cell
<span class='line'>1030</span>  */</span><span class="WHIT">
<span class='line'>1031</span> </span><span class="NAME">ntb_gridp.headerResizeHover</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1032</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1033</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.clientX</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1034</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rect</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.getBoundingClientRect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.grid.Cell.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.scroller.getScrollLeft</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1035</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">rect.right</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">rect.right</span><span class="PUNC">-</span><span class="NUMB">10</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1036</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1037</span> 
<span class='line'>1038</span> </span><span class="COMM">/**
<span class='line'>1039</span>  * Manages the application of hover classes to column headers
<span class='line'>1040</span>  * @private
<span class='line'>1041</span>  */</span><span class="WHIT">
<span class='line'>1042</span> </span><span class="NAME">ntb_gridp.handleHeaderMouseOver</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1043</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1044</span> </span><span class="WHIT">	</span><span class="COMM">// nitobi.html.Css.addClass(e, "ntb-hover", true); // one day we can use this ... when no one uses IE anymore</span><span class="WHIT">
<span class='line'>1045</span> </span><span class="WHIT">	</span><span class="NAME">e.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.className.replace</span><span class="PUNC">(</span><span class="REGX">/(ntb-column-indicator-border)(.*?)(\s|$)/g</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1046</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">2</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"hover "</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1047</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1048</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1049</span> 
<span class='line'>1050</span> </span><span class="COMM">/**
<span class='line'>1051</span>  * Manages the application of hover classes to column headers
<span class='line'>1052</span>  * @private
<span class='line'>1053</span>  */</span><span class="WHIT">
<span class='line'>1054</span> </span><span class="NAME">ntb_gridp.handleHeaderMouseOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1055</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1056</span> </span><span class="WHIT">	</span><span class="COMM">// nitobi.html.Css.removeClass(e, "ntb-hover", true);</span><span class="WHIT">
<span class='line'>1057</span> </span><span class="WHIT">	</span><span class="NAME">e.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.className.replace</span><span class="PUNC">(</span><span class="REGX">/(ntb-column-indicator-border)(.*?)(\s|$)/g</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1058</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">"hover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1059</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1060</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1061</span> 
<span class='line'>1062</span> </span><span class="COMM">/**
<span class='line'>1063</span>  * @private
<span class='line'>1064</span>  */</span><span class="WHIT">
<span class='line'>1065</span> </span><span class="NAME">ntb_gridp.handleCellMouseMove</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1066</span> 
<span class='line'>1067</span> </span><span class="WHIT">	</span><span class="COMM">// Clear a possible cell clicked state</span><span class="WHIT">
<span class='line'>1068</span> </span><span class="WHIT">	</span><span class="NAME">this.setCellClicked</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1069</span> 
<span class='line'>1070</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">=</span><span class="NAME">this.findActiveCell</span><span class="PUNC">(</span><span class="NAME">evt.srcElement</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1071</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1072</span> 
<span class='line'>1073</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1074</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.selecting</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1075</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1076</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.button</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1077</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1078</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.getEventCoords</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1079</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.x</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1080</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1081</span> </span><span class="WHIT">			</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.clientX</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.clientY</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1082</span> 
<span class='line'>1083</span> </span><span class="WHIT">		</span><span class="COMM">//	TODO: known bug with Mozilla - evt.button is ALWAYS 0 after the button is pressed!</span><span class="WHIT">
<span class='line'>1084</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">button</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1085</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1086</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sel.expanding</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1087</span> </span><span class="WHIT">				</span><span class="NAME">sel.redraw</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1088</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1089</span> </span><span class="WHIT">				</span><span class="COMM">// If we are expanding we need to calculate which dir to expand - either horiz or vert.</span><span class="WHIT">
<span class='line'>1090</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selStartCoords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.expandStartCoords</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1091</span> </span><span class="WHIT">				</span><span class="COMM">// figure out which direction we are furthest from the original selection in terms of 1/2 cells</span><span class="WHIT">
<span class='line'>1092</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">normEvtX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1093</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selStartCoords.right</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1094</span> </span><span class="WHIT">					</span><span class="NAME">normEvtX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">selStartCoords.right</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1095</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">selStartCoords.left</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1096</span> </span><span class="WHIT">					</span><span class="NAME">normEvtX</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">selStartCoords.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1097</span> 
<span class='line'>1098</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">normEvtY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1099</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selStartCoords.bottom</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1100</span> </span><span class="WHIT">					</span><span class="NAME">normEvtY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">selStartCoords.bottom</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1101</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">selStartCoords.top</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1102</span> </span><span class="WHIT">					</span><span class="NAME">normEvtY</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.abs</span><span class="PUNC">(</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">selStartCoords.top</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1103</span> 
<span class='line'>1104</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">normEvtY</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">normEvtX</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1105</span> </span><span class="WHIT">					</span><span class="NAME">expandDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"vert"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1106</span> </span><span class="WHIT">				</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1107</span> </span><span class="WHIT">					</span><span class="NAME">expandDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"horiz"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1108</span> 
<span class='line'>1109</span> </span><span class="WHIT">				</span><span class="NAME">sel.expand</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">expandDir</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1110</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1111</span> </span><span class="WHIT">			</span><span class="NAME">this.ensureCellInView</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1112</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1113</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1114</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1115</span> </span><span class="WHIT">			</span><span class="NAME">this.selection.selecting</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1116</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1117</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1118</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1119</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1120</span> </span><span class="WHIT">		</span><span class="NAME">this.hoverCell</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1121</span> </span><span class="WHIT">		</span><span class="NAME">this.hoverRow</span><span class="PUNC">(</span><span class="NAME">cell.parentNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1122</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: onMouseOver event to be fired.</span><span class="WHIT">
<span class='line'>1123</span> </span><span class="WHIT">		</span><span class="COMM">//this.onMouseOver.notify();</span><span class="WHIT">
<span class='line'>1124</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1125</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1126</span> 
<span class='line'>1127</span> </span><span class="COMM">/**
<span class='line'>1128</span>  * Event handler for the mouse wheel event.
<span class='line'>1129</span>  * @param {Event} evt The Event object.
<span class='line'>1130</span>  * @private
<span class='line'>1131</span>  */</span><span class="WHIT">
<span class='line'>1132</span> </span><span class="NAME">ntb_gridp.handleMouseWheel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evtObj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1133</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1134</span> </span><span class="WHIT">	</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// blurs active cell; see ticket 871</span><span class="WHIT">
<span class='line'>1135</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1136</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evtObj.wheelDelta</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1137</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1138</span> </span><span class="WHIT">		</span><span class="COMM">// IE</span><span class="WHIT">
<span class='line'>1139</span> </span><span class="WHIT">		</span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evtObj.wheelDelta</span><span class="PUNC">/</span><span class="NUMB">120</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1140</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1141</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evtObj.detail</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1142</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1143</span> </span><span class="WHIT">		</span><span class="COMM">// Mozilla</span><span class="WHIT">
<span class='line'>1144</span> </span><span class="WHIT">		</span><span class="NAME">delta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">evtObj.detail</span><span class="PUNC">/</span><span class="NUMB">3</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1145</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1146</span> </span><span class="WHIT">	</span><span class="NAME">this.scrollVerticalRelative</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">20</span><span class="PUNC">*</span><span class="NAME">delta</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1147</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.html.cancelEvent</span><span class="PUNC">(</span><span class="NAME">evtObj</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1148</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1149</span> 
<span class='line'>1150</span> </span><span class="COMM">/**
<span class='line'>1151</span>  * Sets the active cell of the Grid to the specified cell.
<span class='line'>1152</span>  * @param {HTMLElement} cell The HTML element for the cell to be made active.
<span class='line'>1153</span>  * @param {Boolean} multi Indicates whether multi-row select should be used.
<span class='line'>1154</span>  * @see #selectCellByCoords
<span class='line'>1155</span>  */</span><span class="WHIT">
<span class='line'>1156</span> </span><span class="NAME">ntb_gridp.setActiveCell</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">,</span><span class="NAME">multi</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1157</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1158</span> </span><span class="WHIT">	</span><span class="COMM">// At this point if cell is null we can't do the activation of the cell</span><span class="WHIT">
<span class='line'>1159</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1160</span> 
<span class='line'>1161</span> </span><span class="WHIT">	</span><span class="NAME">this.blurActiveCell</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1162</span> 
<span class='line'>1163</span> </span><span class="WHIT">	</span><span class="COMM">// Focus the grid if it is not already focused</span><span class="WHIT">
<span class='line'>1164</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: should this focus occur when this is done through the API?</span><span class="WHIT">
<span class='line'>1165</span> </span><span class="WHIT">	</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1166</span> 
<span class='line'>1167</span> </span><span class="WHIT">	</span><span class="COMM">// Update the active cell to the provided cell</span><span class="WHIT">
<span class='line'>1168</span> </span><span class="WHIT">	</span><span class="NAME">this.activateCell</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1169</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">activeColumnObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1170</span> 
<span class='line'>1171</span> </span><span class="WHIT">	</span><span class="COMM">// Setup the cell selection and ensure that the cell is in view.</span><span class="WHIT">
<span class='line'>1172</span> </span><span class="WHIT">	</span><span class="NAME">this.selection.collapse</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1173</span> 
<span class='line'>1174</span> </span><span class="WHIT">	</span><span class="COMM">// Check if we are in a click process - if so then we need to wait to ensure cell in view </span><span class="WHIT">
<span class='line'>1175</span> </span><span class="WHIT">	</span><span class="COMM">// otherwise it can cause the selection to go into select mode.</span><span class="WHIT">
<span class='line'>1176</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isCellClicked</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1177</span> </span><span class="WHIT">		</span><span class="NAME">this.ensureCellInView</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1178</span> </span><span class="WHIT">		</span><span class="NAME">this.setCellClicked</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1179</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1180</span> 
<span class='line'>1181</span> </span><span class="WHIT">	</span><span class="COMM">// Now set the active row</span><span class="WHIT">
<span class='line'>1182</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1183</span> </span><span class="WHIT">	</span><span class="NAME">this.setActiveRow</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">multi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1184</span> 
<span class='line'>1185</span> </span><span class="WHIT">	</span><span class="COMM">// Finally focus on the cell </span><span class="WHIT">
<span class='line'>1186</span> </span><span class="WHIT">	</span><span class="COMM">// NOTE: The cell is focused after the row is focused and the cell is blurred before the row is blurred ...</span><span class="WHIT">
<span class='line'>1187</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">focusEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCellFocusEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getSelectedCellObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1188</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CellFocus"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">focusEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1189</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">activeColumnObject</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">activeColumnObject.getOnCellFocusEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">focusEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1190</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1191</span> 
<span class='line'>1192</span> </span><span class="COMM">/**
<span class='line'>1193</span>  * @private 
<span class='line'>1194</span>  * Sets Grid properties activeCell, activeCellObject and activeColumnObject for the new active cell.
<span class='line'>1195</span>  * @param {HTMLElement} activeCell The new active cell in the Grid.
<span class='line'>1196</span>  */</span><span class="WHIT">
<span class='line'>1197</span> </span><span class="NAME">ntb_gridp.activateCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1198</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1199</span> </span><span class="WHIT">	</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1200</span> </span><span class="WHIT">	</span><span class="NAME">this.activeCellObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1201</span> </span><span class="WHIT">	</span><span class="NAME">this.activeColumnObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelectedColumnObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1202</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1203</span> 
<span class='line'>1204</span> 
<span class='line'>1205</span> </span><span class="COMM">/**
<span class='line'>1206</span>  * @private
<span class='line'>1207</span>  * Blurs the currently active cell.
<span class='line'>1208</span>  * @param {HTMLElement} oldCell The previously selected cell. When bluring the entire grid 
<span class='line'>1209</span>  * one may want to set oldCell to be null. 
<span class='line'>1210</span>  */</span><span class="WHIT">
<span class='line'>1211</span> </span><span class="NAME">ntb_gridp.blurActiveCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oldCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1212</span> </span><span class="WHIT">	</span><span class="COMM">// Setup the oldCell property which can be null if we are clearing the grid or the new activeCell otherwise</span><span class="WHIT">
<span class='line'>1213</span> </span><span class="WHIT">	</span><span class="NAME">this.oldCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">oldCell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1214</span> </span><span class="WHIT">	</span><span class="COMM">// First do the blur stuff since this can happen if cell is null</span><span class="WHIT">
<span class='line'>1215</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1216</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blurEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCellBlurEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getSelectedCellObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1217</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="PUNC">!</span><span class="NAME">oldColumn</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1218</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CellBlur"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">blurEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">oldColumn.getOnCellBlurEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">blurEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1219</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1220</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1221</span> 
<span class='line'>1222</span> </span><span class="COMM">/**
<span class='line'>1223</span>  * @deprecated
<span class='line'>1224</span>  * @private
<span class='line'>1225</span>  */</span><span class="WHIT">
<span class='line'>1226</span> </span><span class="NAME">ntb_gridp.getRowNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1227</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1228</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row.getRowElements</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row.getRowNumber</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1229</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1230</span> 
<span class='line'>1231</span> </span><span class="COMM">/**
<span class='line'>1232</span>  * Sets the active row of the Grid to the specified row.
<span class='line'>1233</span>  * @param {HTMLElement} row The HTML element for the row to be made active.
<span class='line'>1234</span>  * @param {Boolean} multi Indicates whether multi-row select should be used.
<span class='line'>1235</span>  */</span><span class="WHIT">
<span class='line'>1236</span> </span><span class="NAME">ntb_gridp.setActiveRow</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">multi</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1237</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1238</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Row</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1239</span> 
<span class='line'>1240</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newRowNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Row.getRowNumber</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1241</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldRowNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1242</span> 
<span class='line'>1243</span> </span><span class="WHIT">	</span><span class="COMM">// If there is an old row selected then gets its row number</span><span class="WHIT">
<span class='line'>1244</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.oldCell</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1245</span> </span><span class="WHIT">		</span><span class="NAME">oldRowNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Row.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.oldCell</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1246</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.selectedRows</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1247</span> </span><span class="WHIT">		</span><span class="NAME">oldRowNum</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Row.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.selectedRows</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1248</span> 
<span class='line'>1249</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">multi</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.isMultiRowSelectEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1250</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1251</span> </span><span class="WHIT">		</span><span class="COMM">// Check if the old and newly selected / clicked rows are the same or not</span><span class="WHIT">
<span class='line'>1252</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newRowNum</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">oldRowNum</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">oldRowNum</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1253</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">blurEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnRowBlurEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.getRowObject</span><span class="PUNC">(</span><span class="NAME">oldRowNum</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1254</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"RowBlur"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">blurEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">this.getOnRowBlurEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">blurEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1255</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1256</span> </span><span class="WHIT">		</span><span class="NAME">this.clearActiveRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1257</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1258</span> 
<span class='line'>1259</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isRowSelectEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1260</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1261</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Row.getRowElements</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newRowNum</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1262</span> 
<span class='line'>1263</span> </span><span class="WHIT">		</span><span class="NAME">this.midActiveRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rowNodes.mid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1264</span> </span><span class="WHIT">		</span><span class="NAME">this.leftActiveRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rowNodes.left</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1265</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row.getAttribute</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1266</span> </span><span class="WHIT">			</span><span class="NAME">this.clearActiveRow</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1267</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1268</span> </span><span class="WHIT">			</span><span class="NAME">this.selectedRows.push</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1269</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.leftActiveRow</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1270</span> </span><span class="WHIT">				</span><span class="NAME">this.leftActiveRow.setAttribute</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">,</span><span class="STRN">"1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1271</span> </span><span class="WHIT">				</span><span class="NAME">this.applyRowStyle</span><span class="PUNC">(</span><span class="NAME">this.leftActiveRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1272</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1273</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.midActiveRow</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1274</span> </span><span class="WHIT">				</span><span class="NAME">this.midActiveRow.setAttribute</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">,</span><span class="STRN">"1"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1275</span> </span><span class="WHIT">				</span><span class="NAME">this.applyRowStyle</span><span class="PUNC">(</span><span class="NAME">this.midActiveRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1276</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1277</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1278</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1279</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">newRowNum</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">oldRowNum</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1280</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">focusEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnRowFocusEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.getRowObject</span><span class="PUNC">(</span><span class="NAME">newRowNum</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1281</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"RowFocus"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">focusEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1282</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">this.getOnRowFocusEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">focusEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1283</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1284</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1285</span> 
<span class='line'>1286</span> </span><span class="COMM">/**
<span class='line'>1287</span>  * Returns an Array of the currently selected rows in the Grid.  This is
<span class='line'>1288</span>  * particularly useful if your grid has multiselect enabled..
<span class='line'>1289</span>  * &lt;p>
<span class='line'>1290</span>  * &lt;b>Example&lt;/b>
<span class='line'>1291</span>  * &lt;/p>
<span class='line'>1292</span>  * &lt;div class="code">
<span class='line'>1293</span>  * &lt;pre>&lt;code class="">
<span class='line'>1294</span>  * // Iterate through the rows that have been selected and change
<span class='line'>1295</span>  * // the value of the cell at column index 'col' to "New Value!"
<span class='line'>1296</span>  * &#102;unction setDefault(col)
<span class='line'>1297</span>  * {
<span class='line'>1298</span>  * 	var grid = nitobi.getGrid('grid1');
<span class='line'>1299</span>  * 	var selectedRows = grid.getSelectedRows();
<span class='line'>1300</span>  * 
<span class='line'>1301</span>  * 	for( var i = 0; i &lt; selectedRows.length; i++ ) 
<span class='line'>1302</span>  * 	{
<span class='line'>1303</span>  * 	var xi = selectedRows[i].getAttribute("xi");
<span class='line'>1304</span>  * 	var celly = grid.getCellObject(xi, col);
<span class='line'>1305</span>  * 	celly.setValue("New Value!");
<span class='line'>1306</span>  * 	}
<span class='line'>1307</span>  * }
<span class='line'>1308</span>  * &lt;/code>&lt;/pre>
<span class='line'>1309</span>  * &lt;/div>
<span class='line'>1310</span>  * @type Array
<span class='line'>1311</span>  * @see #getCellObject
<span class='line'>1312</span>  */</span><span class="WHIT">
<span class='line'>1313</span> </span><span class="NAME">ntb_gridp.getSelectedRows</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1314</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1315</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selectedRows</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1316</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1317</span> </span><span class="COMM">/**
<span class='line'>1318</span>  * @private
<span class='line'>1319</span>  */</span><span class="WHIT">
<span class='line'>1320</span> </span><span class="NAME">ntb_gridp.clearActiveRows</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1321</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1322</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.selectedRows.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1323</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="PUNC">=</span><span class="NAME">this.selectedRows</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1324</span> </span><span class="WHIT">		</span><span class="NAME">this.clearActiveRow</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1325</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1326</span> </span><span class="WHIT">	</span><span class="NAME">this.selectedRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1327</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1328</span> 
<span class='line'>1329</span> </span><span class="COMM">/**
<span class='line'>1330</span>  * Selects all the rows in the Grid.
<span class='line'>1331</span>  * &lt;p>
<span class='line'>1332</span>  * &lt;b>N.B.&lt;/b>:  The grid must have multiselect enabled
<span class='line'>1333</span>  * &lt;/p>
<span class='line'>1334</span>  * @type Array
<span class='line'>1335</span>  */</span><span class="WHIT">
<span class='line'>1336</span> </span><span class="NAME">ntb_gridp.selectAllRows</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1337</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1338</span> </span><span class="WHIT">	</span><span class="NAME">this.clearActiveRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1339</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">this.getDisplayedRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1340</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1341</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getCellElement</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1342</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1343</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1344</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.parentNode</span><span class="WHIT">
<span class='line'>1345</span> </span><span class="WHIT">			</span><span class="NAME">this.setActiveRow</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1346</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1347</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1348</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.selectedRows</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1349</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1350</span> </span><span class="COMM">/**
<span class='line'>1351</span>  * Clears any active rows in the Grid.
<span class='line'>1352</span>  */</span><span class="WHIT">
<span class='line'>1353</span> </span><span class="NAME">ntb_gridp.clearActiveRow</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1354</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1355</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row.getRowNumber</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1356</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNodes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row.getRowElements</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">rowNumber</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1357</span> 
<span class='line'>1358</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowNodes.left</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1359</span> </span><span class="WHIT">		</span><span class="NAME">rowNodes.left.removeAttribute</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1360</span> </span><span class="WHIT">		</span><span class="NAME">this.removeRowStyle</span><span class="PUNC">(</span><span class="NAME">rowNodes.left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1361</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1362</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowNodes.mid</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1363</span> </span><span class="WHIT">		</span><span class="NAME">rowNodes.mid.removeAttribute</span><span class="PUNC">(</span><span class="STRN">"select"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1364</span> </span><span class="WHIT">		</span><span class="NAME">this.removeRowStyle</span><span class="PUNC">(</span><span class="NAME">rowNodes.mid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1365</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1366</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1367</span> 
<span class='line'>1368</span> </span><span class="COMM">/**
<span class='line'>1369</span>  * @private
<span class='line'>1370</span>  */</span><span class="WHIT">
<span class='line'>1371</span> </span><span class="NAME">ntb_gridp.applyCellStyle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1372</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1373</span> </span><span class="WHIT">	</span><span class="NAME">cell.style.background</span><span class="PUNC">=</span><span class="NAME">this.CellActiveColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1374</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1375</span> 
<span class='line'>1376</span> </span><span class="COMM">/**
<span class='line'>1377</span>  * @private
<span class='line'>1378</span>  */</span><span class="WHIT">
<span class='line'>1379</span> </span><span class="NAME">ntb_gridp.removeCellStyle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1380</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1381</span> </span><span class="WHIT">	</span><span class="NAME">cell.style.background</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1382</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1383</span> 
<span class='line'>1384</span> </span><span class="COMM">/**
<span class='line'>1385</span>  * @private
<span class='line'>1386</span>  */</span><span class="WHIT">
<span class='line'>1387</span> </span><span class="NAME">ntb_gridp.applyRowStyle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1388</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1389</span> </span><span class="WHIT">	</span><span class="NAME">row.style.background</span><span class="PUNC">=</span><span class="NAME">this.RowActiveColor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1390</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1391</span> 
<span class='line'>1392</span> </span><span class="COMM">/**
<span class='line'>1393</span>  * @private
<span class='line'>1394</span>  */</span><span class="WHIT">
<span class='line'>1395</span> </span><span class="NAME">ntb_gridp.removeRowStyle</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1396</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1397</span> </span><span class="WHIT">	</span><span class="NAME">row.style.background</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1398</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1399</span> 
<span class='line'>1400</span> </span><span class="COMM">/**
<span class='line'>1401</span>  * @private
<span class='line'>1402</span>  */</span><span class="WHIT">
<span class='line'>1403</span> </span><span class="NAME">ntb_gridp.findActiveCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">domSrcElem</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1404</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1405</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">breakOut</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">5</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1406</span> </span><span class="WHIT">	</span><span class="NAME">domSrcElem</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1407</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">breakOut</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">domSrcElem.getAttribute</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1408</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1409</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">=</span><span class="NAME">domSrcElem.getAttribute</span><span class="PUNC">(</span><span class="STRN">'ebatype'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1410</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">t</span><span class="PUNC">==</span><span class="STRN">'cell'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">t</span><span class="PUNC">==</span><span class="STRN">'columnheader'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">domSrcElem</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1411</span> </span><span class="WHIT">		</span><span class="NAME">domSrcElem</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">domSrcElem.parentNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1412</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1413</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1414</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1415</span> 
<span class='line'>1416</span> </span><span class="COMM">/**
<span class='line'>1417</span>  * Attaches a component to the HTML DOM. If a component is created using 
<span class='line'>1418</span>  * script, this is an important method to use as 
<span class='line'>1419</span>  * it will cause the render of all unbound elements of the user-interface. 
<span class='line'>1420</span>  * This is primarily for use by component developers.
<span class='line'>1421</span>  * @param {HTMLElement} parentElement The HTML DOM element where the component 
<span class='line'>1422</span>  * will be rendered.
<span class='line'>1423</span>  */</span><span class="WHIT">
<span class='line'>1424</span> </span><span class="NAME">ntb_gridp.attachToParentDomElement</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">parentElement</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1425</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1426</span> </span><span class="WHIT">	</span><span class="NAME">this.UiContainer</span><span class="PUNC">=</span><span class="NAME">parentElement</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1427</span> </span><span class="WHIT">	</span><span class="COMM">// This event key is created in the constructor and connected to initialize</span><span class="WHIT">
<span class='line'>1428</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AttachToParent"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1429</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1430</span> 
<span class='line'>1431</span> </span><span class="COMM">/**
<span class='line'>1432</span>  * Returns all the toolbars currently being used in the grid.  The grid has two 
<span class='line'>1433</span>  * toolbars named standardToolbar and pagingToolbar. The pagingToolbar is only available
<span class='line'>1434</span>  * if the grid is set to standard mode.
<span class='line'>1435</span>  * @type nitobi.ui.Toolbars
<span class='line'>1436</span>  */</span><span class="WHIT">
<span class='line'>1437</span> </span><span class="NAME">ntb_gridp.getToolbars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1438</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1439</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.toolbars</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1440</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1441</span> 
<span class='line'>1442</span> </span><span class="COMM">/**
<span class='line'>1443</span>  * Checks if the horizontal scroll bar needs to be drawn and makes the proper adjustments
<span class='line'>1444</span>  * to the viewable area of the Grid.
<span class='line'>1445</span>  * @private
<span class='line'>1446</span>  */</span><span class="WHIT">
<span class='line'>1447</span> </span><span class="NAME">ntb_gridp.adjustHorizontalScrollBars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1448</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1449</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">viewableWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.calculateWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1450</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hScrollbarContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-hscrollshow"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1451</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">viewableWidth</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1452</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1453</span> </span><span class="WHIT">		</span><span class="NAME">hScrollbarContainer.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"none"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1454</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1455</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1456</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1457</span> </span><span class="WHIT">		</span><span class="NAME">hScrollbarContainer.style.display</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"block"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1458</span> </span><span class="WHIT">		</span><span class="NAME">this.resizeScroller</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1459</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pctW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.calculateWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1460</span> </span><span class="WHIT">		</span><span class="NAME">this.hScrollbar.setRange</span><span class="PUNC">(</span><span class="NAME">pctW</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1461</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1462</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1463</span> 
<span class='line'>1464</span> </span><span class="COMM">/**
<span class='line'>1465</span>  * Creats all children objects of the component. These can be visual or non-visual aspects of the component such as 
<span class='line'>1466</span>  * panels, toolbars or managers.
<span class='line'>1467</span>  * @private
<span class='line'>1468</span>  */</span><span class="WHIT">
<span class='line'>1469</span> </span><span class="NAME">ntb_gridp.createChildren</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1470</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1471</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">L</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1472</span> 
<span class='line'>1473</span> </span><span class="WHIT">	</span><span class="COMM">// *** OVERRIDE IN THIS FUNCTION IN INHERITED GRIDS BASED ON MODE ***</span><span class="WHIT">
<span class='line'>1474</span> 
<span class='line'>1475</span> </span><span class="WHIT">	</span><span class="COMM">// Creating children here streamlines startup performance</span><span class="WHIT">
<span class='line'>1476</span> </span><span class="WHIT">	</span><span class="COMM">// Give sub-classes first-crack at definining sub-components</span><span class="WHIT">
<span class='line'>1477</span> </span><span class="WHIT">	</span><span class="COMM">// Possibly call super.createChildren()</span><span class="WHIT">
<span class='line'>1478</span> </span><span class="WHIT">	</span><span class="COMM">// Defer creating dynamic and data-driven components to commitProperties()</span><span class="WHIT">
<span class='line'>1479</span> 
<span class='line'>1480</span> </span><span class="WHIT">	</span><span class="COMM">// Rules for adding children: </span><span class="WHIT">
<span class='line'>1481</span> </span><span class="WHIT">	</span><span class="COMM">// 	1. Containers must contain only UIComponents</span><span class="WHIT">
<span class='line'>1482</span> </span><span class="WHIT">	</span><span class="COMM">//	2. UIComponents must go inside other UIComponents</span><span class="WHIT">
<span class='line'>1483</span> </span><span class="WHIT">	</span><span class="COMM">//	3. UIComponents can contain anything </span><span class="WHIT">
<span class='line'>1484</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">this.UiContainer</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"Grid must have a UI Container"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1485</span> 
<span class='line'>1486</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.UiContainer</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.getGridContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1487</span> </span><span class="WHIT">		</span><span class="NAME">this.renderFrame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="COMM">// UI children need ui containers</span><span class="WHIT">
<span class='line'>1488</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1489</span> 
<span class='line'>1490</span> </span><span class="WHIT">	</span><span class="NAME">this.generateFrameCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 	</span><span class="COMM">// *** BAD - genCss depends on Scroller - this shouldn't be so</span><span class="WHIT">
<span class='line'>1491</span> 
<span class='line'>1492</span> </span><span class="WHIT">	</span><span class="COMM">// Moved this to the createChildren method since it is a child of the Grid.</span><span class="WHIT">
<span class='line'>1493</span> </span><span class="WHIT">	</span><span class="COMM">// To fix the loading screen aligment problem it needs to be attached the grid tag - not the body</span><span class="WHIT">
<span class='line'>1494</span> 
<span class='line'>1495</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ls</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.loadingScreen</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.LoadingScreen</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1496</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"Preinitialize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">ls</span><span class="PUNC">,</span><span class="NAME">ls.show</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1497</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">ls</span><span class="PUNC">,</span><span class="NAME">ls.hide</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1498</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterGridResize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">ls</span><span class="PUNC">,</span><span class="NAME">ls.resize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1499</span> </span><span class="WHIT">	</span><span class="NAME">ls.initialize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1500</span> </span><span class="WHIT">	</span><span class="NAME">ls.attachToElement</span><span class="PUNC">(</span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-overlay"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1501</span> </span><span class="WHIT">	</span><span class="NAME">ls.show</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1502</span> 
<span class='line'>1503</span> </span><span class="COMM">//	nitobi.html.setBgImage($("ntb-frozenshadow"+this.uid));</span><span class="WHIT">
<span class='line'>1504</span> 
<span class='line'>1505</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: these resizers should be inheriting from one resizer base class to reduce code.</span><span class="WHIT">
<span class='line'>1506</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>1507</span> 	 * The object that is responsible for managing runtime resizing of Grid Columns.
<span class='line'>1508</span> 	 * @type nitobi.grid.ColumnResizer
<span class='line'>1509</span> 	 */</span><span class="WHIT">
<span class='line'>1510</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.ColumnResizer</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1511</span> </span><span class="WHIT">	</span><span class="NAME">cr.onAfterResize.subscribe</span><span class="PUNC">(</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.afterColumnResize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1512</span> </span><span class="WHIT">	</span><span class="NAME">this.columnResizer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1513</span> 
<span class='line'>1514</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>1515</span> 	 * The object that is responsible for managing runtime resizing of the Grid.
<span class='line'>1516</span> 	 * @type nitobi.grid.GridResizer
<span class='line'>1517</span> 	 */</span><span class="WHIT">
<span class='line'>1518</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.GridResizer</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1519</span> </span><span class="WHIT">	</span><span class="NAME">gr.widthFixed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isWidthFixed</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1520</span> </span><span class="WHIT">	</span><span class="NAME">gr.heightFixed</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isHeightFixed</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1521</span> </span><span class="WHIT">	</span><span class="NAME">gr.minWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getMinWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1522</span> </span><span class="WHIT">	</span><span class="NAME">gr.minHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.getMinHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">this.getscrollbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1523</span> </span><span class="WHIT">	</span><span class="NAME">gr.onAfterResize.subscribe</span><span class="PUNC">(</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.afterResize</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1524</span> </span><span class="WHIT">	</span><span class="NAME">this.gridResizer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">gr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1525</span> 
<span class='line'>1526</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Scroller is deprecated</span><span class="WHIT">
<span class='line'>1527</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.scroller</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Scroller3x3</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getDisplayedRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getfreezetop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1528</span> </span><span class="WHIT">	</span><span class="NAME">sc.setRowHeight</span><span class="PUNC">(</span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1529</span> </span><span class="WHIT">	</span><span class="NAME">sc.setHeaderHeight</span><span class="PUNC">(</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1530</span> 
<span class='line'>1531</span> </span><span class="WHIT">	</span><span class="COMM">// Set up default key handlers - eventually move these out into editor factory</span><span class="WHIT">
<span class='line'>1532</span> </span><span class="COMM">//	var kh = function(k) {if ((k > 64 && k &lt; 91) || (k > 47 && k &lt; 58) || (k > 95 && k &lt; 111) || (k > 188 && k &lt; 191) || (k == 113) ) {_this.edit();}};</span><span class="WHIT">
<span class='line'>1533</span> </span><span class="COMM">//	var gh = function(k) {if (k==32) {var group =  _this.activeCell.getAttribute("xig");_this.toggleGroup(group);}}; </span><span class="WHIT">
<span class='line'>1534</span> </span><span class="COMM">//	this.keyHandlerFunc={"TEXT":kh,"PASSWORD":kh,"TEXTAREA":kh,"NUMBER":kh,"IMAGE":kh,"DATE":kh,"LISTBOX":kh,"LOOKUP":kh,"CHECKBOX":kh,"LINK":kh};</span><span class="WHIT">
<span class='line'>1535</span> 
<span class='line'>1536</span> </span><span class="WHIT">	</span><span class="COMM">// Subscribe to the HtmlReady event for things like afterrowinsert etc</span><span class="WHIT">
<span class='line'>1537</span> </span><span class="WHIT">	</span><span class="NAME">sc.onHtmlReady.subscribe</span><span class="PUNC">(</span><span class="NAME">this.handleHtmlReady</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1538</span> </span><span class="WHIT">	</span><span class="COMM">// only connect the scrolled setDataTable method to the tableconnected event</span><span class="WHIT">
<span class='line'>1539</span> </span><span class="WHIT">	</span><span class="COMM">// once we know the scroller is defined.</span><span class="WHIT">
<span class='line'>1540</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">'TableConnected'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">sc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sc.setDataTable</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1541</span> </span><span class="WHIT">	</span><span class="COMM">// Since we may already have connected a datatable to the grid we need to explicitly</span><span class="WHIT">
<span class='line'>1542</span> </span><span class="WHIT">	</span><span class="COMM">// connect update the scroller when we create it</span><span class="WHIT">
<span class='line'>1543</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: should this be a constructor / initialize argument instead? </span><span class="WHIT">
<span class='line'>1544</span> </span><span class="WHIT">	</span><span class="NAME">sc.setDataTable</span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1545</span> 
<span class='line'>1546</span> </span><span class="WHIT">	</span><span class="NAME">this.initializeSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1547</span> 
<span class='line'>1548</span> </span><span class="WHIT">	</span><span class="NAME">this.createRenderers</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1549</span> 
<span class='line'>1550</span> </span><span class="WHIT">	</span><span class="COMM">// Attach renderers to Scroller views</span><span class="WHIT">
<span class='line'>1551</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sv</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.view</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1552</span> </span><span class="WHIT">	</span><span class="NAME">sv.midleft.rowRenderer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.MidLeftRenderer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1553</span> </span><span class="WHIT">	</span><span class="NAME">sv.midcenter.rowRenderer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.MidCenterRenderer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1554</span> </span><span class="WHIT">	</span><span class="NAME">sv.topleft.rowRenderer</span><span class="PUNC">=</span><span class="NAME">this.TopLeftRenderer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1555</span> </span><span class="WHIT">	</span><span class="NAME">sv.topcenter.rowRenderer</span><span class="PUNC">=</span><span class="NAME">this.TopCenterRenderer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1556</span> 
<span class='line'>1557</span> 
<span class='line'>1558</span> </span><span class="WHIT">	</span><span class="NAME">this.mapToHtml</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">			</span><span class="COMM">// Children need dom references</span><span class="WHIT">
<span class='line'>1559</span> 
<span class='line'>1560</span> </span><span class="WHIT">	</span><span class="COMM">// Logic for features:</span><span class="WHIT">
<span class='line'>1561</span> </span><span class="WHIT">	</span><span class="COMM">// 	Paging Mode</span><span class="WHIT">
<span class='line'>1562</span> </span><span class="WHIT">	</span><span class="COMM">//		Overrides toolbars, scrollbars</span><span class="WHIT">
<span class='line'>1563</span> </span><span class="WHIT">	</span><span class="COMM">//	Toolbars</span><span class="WHIT">
<span class='line'>1564</span> </span><span class="WHIT">	</span><span class="COMM">//	Scrollbars</span><span class="WHIT">
<span class='line'>1565</span> 
<span class='line'>1566</span> </span><span class="WHIT">	</span><span class="COMM">// create Scrollbars</span><span class="WHIT">
<span class='line'>1567</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.vScrollbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.ui.VerticalScrollbar</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1568</span> </span><span class="WHIT">	</span><span class="NAME">vs.attachToParent</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"vscroll"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1569</span> </span><span class="WHIT">	</span><span class="NAME">vs.subscribe</span><span class="PUNC">(</span><span class="STRN">"ScrollByUser"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.scrollVertical</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1570</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"PercentHeightChanged"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">vs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vs.setRange</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// I had to do it this way ... context wasn't being passed properly</span><span class="WHIT">
<span class='line'>1571</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"ScrollVertical"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">vs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vs.setScrollPercent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1572</span> </span><span class="WHIT">	</span><span class="NAME">this.setscrollbarWidth</span><span class="PUNC">(</span><span class="NAME">vs.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1573</span> 
<span class='line'>1574</span> </span><span class="COMM">//	this.subscribe("PercentHeightChanged",nitobi.lang.close(this,this.vScrollbar.setRange));</span><span class="WHIT">
<span class='line'>1575</span> </span><span class="COMM">//	this.subscribe("PercentHeightChanged",this.vScrollbar.setRange,this);</span><span class="WHIT">
<span class='line'>1576</span> 
<span class='line'>1577</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.hScrollbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.ui.HorizontalScrollbar</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1578</span> </span><span class="WHIT">	</span><span class="NAME">hs.attachToParent</span><span class="PUNC">(</span><span class="NAME">this.element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">$</span><span class="PUNC">(</span><span class="STRN">"hscroll"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1579</span> </span><span class="WHIT">	</span><span class="NAME">hs.subscribe</span><span class="PUNC">(</span><span class="STRN">"ScrollByUser"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.scrollHorizontal</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1580</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"PercentWidthChanged"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">hs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hs.setRange</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// I had to do it this way ... context wasn't being passed properly</span><span class="WHIT">
<span class='line'>1581</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"ScrollHorizontal"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="NAME">hs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">hs.setScrollPercent</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1582</span> </span><span class="WHIT">	</span><span class="NAME">this.setscrollbarHeight</span><span class="PUNC">(</span><span class="NAME">hs.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1583</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1584</span> 
<span class='line'>1585</span> </span><span class="COMM">/**
<span class='line'>1586</span>  * Creates the toolbars collection. Toolbars are always there in case
<span class='line'>1587</span>  * the programmer calls setToolbarEnabled(true).
<span class='line'>1588</span>  * 
<span class='line'>1589</span>  * @param {nitobi.ui.Toolbars.VisibleToolbars} visibleToolbars A bitmask representing which toolbars are being shown.
<span class='line'>1590</span>  * @private
<span class='line'>1591</span>  */</span><span class="WHIT">
<span class='line'>1592</span> </span><span class="NAME">ntb_gridp.createToolbars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">visibleToolbars</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1593</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1594</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tb</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toolbars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.ui.Toolbars</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isToolbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">visibleToolbars</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1595</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">TBContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"toolbarContainer"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1596</span> </span><span class="WHIT">	</span><span class="NAME">tb.setWidth</span><span class="PUNC">(</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1597</span> </span><span class="WHIT">	</span><span class="NAME">tb.setHeight</span><span class="PUNC">(</span><span class="NAME">this.getToolbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1598</span> </span><span class="WHIT">	</span><span class="NAME">tb.setRowInsertEnabled</span><span class="PUNC">(</span><span class="NAME">this.isRowInsertEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1599</span> </span><span class="WHIT">	</span><span class="NAME">tb.setRowDeleteEnabled</span><span class="PUNC">(</span><span class="NAME">this.isRowDeleteEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1600</span> </span><span class="WHIT">	</span><span class="NAME">tb.attachToParent</span><span class="PUNC">(</span><span class="NAME">TBContainer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1601</span> 
<span class='line'>1602</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">L</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1603</span> </span><span class="WHIT">	</span><span class="NAME">tb.subscribe</span><span class="PUNC">(</span><span class="STRN">"InsertRow"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.insertAfterCurrentRow</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1604</span> </span><span class="WHIT">	</span><span class="NAME">tb.subscribe</span><span class="PUNC">(</span><span class="STRN">"DeleteRow"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.deleteCurrentRow</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1605</span> </span><span class="WHIT">	</span><span class="NAME">tb.subscribe</span><span class="PUNC">(</span><span class="STRN">"Save"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.save</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1606</span> </span><span class="WHIT">	</span><span class="NAME">tb.subscribe</span><span class="PUNC">(</span><span class="STRN">"Refresh"</span><span class="PUNC">,</span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.refresh</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1607</span> 
<span class='line'>1608</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="STRN">"AfterGridResize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">L.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.resizeToolbars</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1609</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1610</span> 
<span class='line'>1611</span> </span><span class="COMM">/**
<span class='line'>1612</span>  * Called on the &lt;code>AfterGridResize&lt;/code> event.
<span class='line'>1613</span>  * @private
<span class='line'>1614</span>  */</span><span class="WHIT">
<span class='line'>1615</span> </span><span class="NAME">ntb_gridp.resizeToolbars</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1616</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1617</span> </span><span class="WHIT">	</span><span class="NAME">this.toolbars.setWidth</span><span class="PUNC">(</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1618</span> </span><span class="WHIT">	</span><span class="NAME">this.toolbars.resize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1619</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1620</span> 
<span class='line'>1621</span> </span><span class="COMM">/**
<span class='line'>1622</span>  * Vertically scrolls the Grid relative to the current vertical scroll 
<span class='line'>1623</span>  * position.
<span class='line'>1624</span>  * &lt;p>
<span class='line'>1625</span>  * If the Grid is in livescrolling mode, use of this method may cause
<span class='line'>1626</span>  * an asynchronous request to the server if more data is required to be
<span class='line'>1627</span>  * rendered--i.e. the behaviour is the same if you scroll programatically
<span class='line'>1628</span>  * or scroll using the mouse
<span class='line'>1629</span>  * &lt;/p>
<span class='line'>1630</span>  * &lt;p>
<span class='line'>1631</span>  * &lt;b>Example&lt;/b>
<span class='line'>1632</span>  * &lt;/p>
<span class='line'>1633</span>  * &lt;div class="code">
<span class='line'>1634</span>  * &lt;pre>&lt;code class="">
<span class='line'>1635</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>1636</span>  * grid.scrollVerticalRelative(150);
<span class='line'>1637</span>  * grid.scrollVerticalRelative(100);	// Moves the grid 250 pixels down
<span class='line'>1638</span>  * &lt;/code>&lt;/pre>
<span class='line'>1639</span>  * &lt;/div>
<span class='line'>1640</span>  * @param {Number} offset The amount by which to scroll the Grid with respect to its current vertical scroll value.
<span class='line'>1641</span>  */</span><span class="WHIT">
<span class='line'>1642</span> </span><span class="NAME">ntb_gridp.scrollVerticalRelative</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1643</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1644</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">st</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.scroller.getScrollTop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1645</span> 
<span class='line'>1646</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.view.midcenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1647</span> </span><span class="WHIT">	</span><span class="NAME">percent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">st</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="PUNC">(</span><span class="NAME">mc.container.offsetHeight</span><span class="PUNC">-</span><span class="NAME">mc.element.offsetHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1648</span> 
<span class='line'>1649</span> </span><span class="WHIT">	</span><span class="NAME">this.scrollVertical</span><span class="PUNC">(</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1650</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1651</span> 
<span class='line'>1652</span> </span><span class="COMM">/**
<span class='line'>1653</span>  * Vertically scrolls the Grid to the position specfied by the percent 
<span class='line'>1654</span>  * argument. This will fire the OnScrollVerticalEvent 
<span class='line'>1655</span>  * and the OnScrollHitBottomEvent or OnScrollHitTopEvent if the scrollbar 
<span class='line'>1656</span>  * is with 1% of the bottom or top of the data respectively.
<span class='line'>1657</span>  * &lt;p>
<span class='line'>1658</span>  * If the Grid is in livescrolling mode, use of this method may cause
<span class='line'>1659</span>  * an asynchronous request to the server if more data is required to be
<span class='line'>1660</span>  * rendered--i.e. the behaviour is the same if you scroll programatically
<span class='line'>1661</span>  * or scroll using the mouse
<span class='line'>1662</span>  * &lt;/p>
<span class='line'>1663</span>  * &lt;p>
<span class='line'>1664</span>  * &lt;b>Example&lt;/b>
<span class='line'>1665</span>  * &lt;/p>
<span class='line'>1666</span>  * &lt;div class="code">
<span class='line'>1667</span>  * &lt;pre>&lt;code class="">
<span class='line'>1668</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>1669</span>  * grid.scrollVertical(0.3);	// Scrolls the grid a third of the way to the bottom
<span class='line'>1670</span>  * grid.scrollVertical(0.5);	// Scrolls the grid half way to the bottom (not 80%)
<span class='line'>1671</span>  * &lt;/code>&lt;/pre>
<span class='line'>1672</span>  * &lt;/div>
<span class='line'>1673</span>  * @param {decimal} percent A value between 0 and 1 that specifies how far to vertically scroll, 0 being left and 1 being right.
<span class='line'>1674</span>  */</span><span class="WHIT">
<span class='line'>1675</span> </span><span class="NAME">ntb_gridp.scrollVertical</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1676</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1677</span> </span><span class="WHIT">	</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1678</span> </span><span class="WHIT">	</span><span class="NAME">this.clearHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1679</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origPct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.scroller.getScrollTopPercent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1680</span> </span><span class="WHIT">	</span><span class="NAME">this.scroller.setScrollTopPercent</span><span class="PUNC">(</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1681</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ScrollVertical"</span><span class="PUNC">,</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1682</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">percent</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">99</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">origPct</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">99</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1683</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ScrollHitBottom"</span><span class="PUNC">,</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1684</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1685</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">percent</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">01</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1686</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ScrollHitTop"</span><span class="PUNC">,</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1687</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1688</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1689</span> 
<span class='line'>1690</span> </span><span class="COMM">/**
<span class='line'>1691</span>  * Horizontally scrolls the Grid relative to the current horizontal scroll 
<span class='line'>1692</span>  * position.
<span class='line'>1693</span>  * &lt;p>
<span class='line'>1694</span>  * Note that this differs from {@link #scrollHorizontal} in two ways.  One,
<span class='line'>1695</span>  * it takes an offset representing the number of pixels to scroll as opposed
<span class='line'>1696</span>  * to a percantage.  Two, this method will scroll relative to the current
<span class='line'>1697</span>  * position and not absolutely
<span class='line'>1698</span>  * &lt;/p>
<span class='line'>1699</span>  * &lt;p>
<span class='line'>1700</span>  * &lt;b>Example&lt;/b>
<span class='line'>1701</span>  * &lt;/p>
<span class='line'>1702</span>  * &lt;div class="code">
<span class='line'>1703</span>  * &lt;pre>&lt;code class="">
<span class='line'>1704</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>1705</span>  * grid.scrollHorizontalRelative(150);
<span class='line'>1706</span>  * grid.scrollHorizontalRelative(100);	// Moves the grid 250 pixels to the right
<span class='line'>1707</span>  * &lt;/code>&lt;/pre>
<span class='line'>1708</span>  * &lt;/div>
<span class='line'>1709</span>  * @param {Number} offset The pixel amount by which to scroll the Grid with 
<span class='line'>1710</span>  * respect to its current horizontal scroll value.
<span class='line'>1711</span>  */</span><span class="WHIT">
<span class='line'>1712</span> </span><span class="NAME">ntb_gridp.scrollHorizontalRelative</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">offset</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1713</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1714</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.scroller.getScrollLeft</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NAME">offset</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1715</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.scroller.view.midcenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1716</span> </span><span class="WHIT">	</span><span class="NAME">percent</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sl</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mc.container.offsetWidth</span><span class="PUNC">-</span><span class="NAME">mc.element.offsetWidth</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1717</span> </span><span class="WHIT">	</span><span class="NAME">this.scrollHorizontal</span><span class="PUNC">(</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1718</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1719</span> 
<span class='line'>1720</span> </span><span class="COMM">/**
<span class='line'>1721</span>  * Horizontally scrolls the Grid to the position specfied by the percent 
<span class='line'>1722</span>  * argument. This will fire the &lt;code>OnScrollHorizontalEvent&lt;/code> 
<span class='line'>1723</span>  * and the &lt;code>OnScrollHitLeftEvent&lt;/code> or 
<span class='line'>1724</span>  * &lt;code>OnScrollHitRightEvent&lt;/code> if the scrollbar is with 1% of the 
<span class='line'>1725</span>  * left or right of the data respectively.
<span class='line'>1726</span>  * &lt;p>
<span class='line'>1727</span>  * &lt;b>Example&lt;/b>
<span class='line'>1728</span>  * &lt;/p>
<span class='line'>1729</span>  * &lt;div class="code">
<span class='line'>1730</span>  * &lt;pre>&lt;code class="">
<span class='line'>1731</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>1732</span>  * grid.scrollHorizontal(0.3);	// Scrolls the grid a third of the way to the right
<span class='line'>1733</span>  * grid.scrollHorizontal(0.5);	// Scrolls the grid half way to the right (not 80%)
<span class='line'>1734</span>  * &lt;/code>&lt;/pre>
<span class='line'>1735</span>  * &lt;/div>
<span class='line'>1736</span>  * @param {decimal} percent A value between 0 and 1 that specifies how far to horizontally scroll, 0 being left and 1 being right.
<span class='line'>1737</span>  */</span><span class="WHIT">
<span class='line'>1738</span> </span><span class="NAME">ntb_gridp.scrollHorizontal</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1739</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1740</span> </span><span class="WHIT">	</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1741</span> </span><span class="WHIT">	</span><span class="NAME">this.clearHover</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1742</span> </span><span class="WHIT">	</span><span class="NAME">this.scroller.setScrollLeftPercent</span><span class="PUNC">(</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1743</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ScrollHorizontal"</span><span class="PUNC">,</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1744</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">percent</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">99</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1745</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ScrollHitRight"</span><span class="PUNC">,</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1746</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1747</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">percent</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="PUNC">.</span><span class="NUMB">01</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1748</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ScrollHitLeft"</span><span class="PUNC">,</span><span class="NAME">percent</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1749</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1750</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1751</span> </span><span class="COMM">/**
<span class='line'>1752</span>  * Gets a reference to the midcenter HTML element which is the main grid surface. This is commonly
<span class='line'>1753</span>  * used to get the scrollTop and scrollLeft values for the grid.
<span class='line'>1754</span>  * @private
<span class='line'>1755</span>  */</span><span class="WHIT">
<span class='line'>1756</span> </span><span class="NAME">ntb_gridp.getScrollSurface</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1757</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1758</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.Scroller</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1759</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1760</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.Scroller.view.midcenter.element</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1761</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1762</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1763</span> 
<span class='line'>1764</span> </span><span class="COMM">/**
<span class='line'>1765</span>  * @private
<span class='line'>1766</span>  * @type nitobi.grid.Viewport
<span class='line'>1767</span>  */</span><span class="WHIT">
<span class='line'>1768</span> </span><span class="NAME">ntb_gridp.getActiveView</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1769</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1770</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">C</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1771</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.Scroller.getViewportByCoords</span><span class="PUNC">(</span><span class="WHIT">
<span class='line'>1772</span> </span><span class="WHIT">		</span><span class="NAME">C.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1773</span> </span><span class="WHIT">		</span><span class="NAME">C.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1774</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1775</span> 
<span class='line'>1776</span> </span><span class="COMM">/**
<span class='line'>1777</span>  * Scrolls the Grid such that the specified cell is visible. 
<span class='line'>1778</span>  * If the cell argument is specified then it will scroll to make 
<span class='line'>1779</span>  * the provide cell visible.
<span class='line'>1780</span>  * &lt;p>
<span class='line'>1781</span>  * &lt;b>Example&lt;/b>
<span class='line'>1782</span>  * &lt;/p>
<span class='line'>1783</span>  * &lt;div class="code">
<span class='line'>1784</span>  * &lt;pre>&lt;code class="javascript">
<span class='line'>1785</span>  * &#102;unction scrollToCell(row, col)
<span class='line'>1786</span>  * {
<span class='line'>1787</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>1788</span>  * 	var cellElement = grid.getCellElement(row, col);
<span class='line'>1789</span>  * 	grid.ensureCellInView(cellElement);
<span class='line'>1790</span>  * }
<span class='line'>1791</span>  * &lt;/code>&lt;/pre>
<span class='line'>1792</span>  * &lt;/div>
<span class='line'>1793</span>  * @param {HTMLElement} cell The cell that is to be in view.
<span class='line'>1794</span>  */</span><span class="WHIT">
<span class='line'>1795</span> </span><span class="NAME">ntb_gridp.ensureCellInView</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cell</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1796</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1797</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">SS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getScrollSurface</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1798</span> 
<span class='line'>1799</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.activeCell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1800</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1801</span> 
<span class='line'>1802</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: this is a big hack for Mozilla</span><span class="WHIT">
<span class='line'>1803</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sct</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1804</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scl</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1805</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.MOZ</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nitobi.browser.SAFARI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1806</span> </span><span class="WHIT">		</span><span class="NAME">sct</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SS.scrollTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1807</span> </span><span class="WHIT">		</span><span class="NAME">scl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SS.scrollLeft</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1808</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1809</span> 
<span class='line'>1810</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">R1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">AC.getBoundingClientRect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1811</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">R2</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">SS.getBoundingClientRect</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1812</span> 
<span class='line'>1813</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">B</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">EBA_SELECTION_BUFFER</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1814</span> 
<span class='line'>1815</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">up</span><span class="PUNC">=</span><span class="NAME">R1.top</span><span class="PUNC">-</span><span class="NAME">R2.top</span><span class="PUNC">-</span><span class="NAME">B</span><span class="PUNC">-</span><span class="NAME">sct</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1816</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">down</span><span class="PUNC">=</span><span class="NAME">R1.bottom</span><span class="PUNC">-</span><span class="NAME">R2.bottom</span><span class="PUNC">+</span><span class="NAME">B</span><span class="PUNC">-</span><span class="NAME">sct</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1817</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">left</span><span class="PUNC">=</span><span class="NAME">R1.left</span><span class="PUNC">-</span><span class="NAME">R2.left</span><span class="PUNC">-</span><span class="NAME">B</span><span class="PUNC">-</span><span class="NAME">scl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1818</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">right</span><span class="PUNC">=</span><span class="NAME">R1.right</span><span class="PUNC">-</span><span class="NAME">R2.right</span><span class="PUNC">+</span><span class="NAME">B</span><span class="PUNC">-</span><span class="NAME">scl</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1819</span> 
<span class='line'>1820</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">up</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scrollVerticalRelative</span><span class="PUNC">(</span><span class="NAME">up</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1821</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">down</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scrollVerticalRelative</span><span class="PUNC">(</span><span class="NAME">down</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1822</span> 
<span class='line'>1823</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.grid.Cell.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">AC</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1824</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">&lt;</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scrollHorizontalRelative</span><span class="PUNC">(</span><span class="NAME">left</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1825</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.scrollHorizontalRelative</span><span class="PUNC">(</span><span class="NAME">right</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1826</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1827</span> 
<span class='line'>1828</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CellCoordsChanged"</span><span class="PUNC">,</span><span class="NAME">R1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1829</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1830</span> 
<span class='line'>1831</span> </span><span class="COMM">/**
<span class='line'>1832</span>  * If the Grid is rendered, the Grid is updated to reflect the number of rows in the Grid DataTable. The change in data rows is 
<span class='line'>1833</span>  * also propagated to child object.
<span class='line'>1834</span>  * @private
<span class='line'>1835</span>  */</span><span class="WHIT">
<span class='line'>1836</span> </span><span class="NAME">ntb_gridp.updateCellRanges</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1837</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1838</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.frameRendered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1839</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1840</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.updateCellRanges</span><span class="PUNC">(</span><span class="NAME">this.getColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">rows</span><span class="PUNC">,</span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.getfreezetop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1841</span> 
<span class='line'>1842</span> </span><span class="WHIT">		</span><span class="NAME">this.measure</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1843</span> </span><span class="WHIT">		</span><span class="NAME">this.resizeScroller</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1844</span> </span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>1845</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isToolbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.getToolbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1846</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"PercentHeightChanged"</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">/</span><span class="NAME">this.calculateHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1847</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"PercentWidthChanged"</span><span class="PUNC">,</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">/</span><span class="NAME">this.calculateWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1848</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1849</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1850</span> 
<span class='line'>1851</span> </span><span class="COMM">/**
<span class='line'>1852</span>  * Re-calculates the dimensions of the component.
<span class='line'>1853</span>  * @private
<span class='line'>1854</span>  */</span><span class="WHIT">
<span class='line'>1855</span> </span><span class="NAME">ntb_gridp.measure</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1856</span> </span><span class="WHIT">	</span><span class="COMM">// Invoked by the framework when a components invalidateSize is called</span><span class="WHIT">
<span class='line'>1857</span> </span><span class="WHIT">	</span><span class="COMM">// Components calculate their natural size based on content and layout rules</span><span class="WHIT">
<span class='line'>1858</span> </span><span class="WHIT">	</span><span class="COMM">// Implicitly invoked when component children change size</span><span class="WHIT">
<span class='line'>1859</span> </span><span class="WHIT">	</span><span class="COMM">// Don't count on it: Framework should optimize away calls to measure</span><span class="WHIT">
<span class='line'>1860</span> </span><span class="WHIT">	</span><span class="COMM">// Start by explicitly sizing component and implement measure() later.</span><span class="WHIT">
<span class='line'>1861</span> 
<span class='line'>1862</span> </span><span class="COMM">/*	
<span class='line'>1863</span> 	this.toolbarbox.measure();
<span class='line'>1864</span> 	this.hscrollbarbox.measure();
<span class='line'>1865</span> 	this.vscrollbarbox.measure();
<span class='line'>1866</span> 	this.Scroller.measure();
<span class='line'>1867</span> */</span><span class="WHIT">
<span class='line'>1868</span> 
<span class='line'>1869</span> </span><span class="WHIT">	</span><span class="NAME">this.measureViews</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1870</span> </span><span class="WHIT">	</span><span class="NAME">this.sizeValid</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1871</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1872</span> 
<span class='line'>1873</span> </span><span class="COMM">/**
<span class='line'>1874</span>  * Calls both &lt;code>measureColumns&lt;/code> and &lt;code>measureRows&lt;/code>.
<span class='line'>1875</span>  * @private
<span class='line'>1876</span>  */</span><span class="WHIT">
<span class='line'>1877</span> </span><span class="NAME">ntb_gridp.measureViews</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1878</span> </span><span class="WHIT">	</span><span class="NAME">this.measureRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1879</span> </span><span class="WHIT">	</span><span class="NAME">this.measureColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1880</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1881</span> 
<span class='line'>1882</span> </span><span class="COMM">/**
<span class='line'>1883</span>  * @private
<span class='line'>1884</span>  */</span><span class="WHIT">
<span class='line'>1885</span> </span><span class="NAME">ntb_gridp.measureColumns</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1886</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="PUNC">=</span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1887</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1888</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1889</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1890</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">colDefs.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1891</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cols</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1892</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"Visible"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"1"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"visible"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"1"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1893</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1894</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">w</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"Width"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1895</span> </span><span class="WHIT">			</span><span class="NAME">wT</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1896</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">fL</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">wL</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">w</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1897</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1898</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1899</span> </span><span class="WHIT">	</span><span class="NAME">this.setleft</span><span class="PUNC">(</span><span class="NAME">wL</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1900</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1901</span> 
<span class='line'>1902</span> </span><span class="COMM">/**
<span class='line'>1903</span>  * @private
<span class='line'>1904</span>  */</span><span class="WHIT">
<span class='line'>1905</span> </span><span class="NAME">ntb_gridp.measureRows</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1906</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1907</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hdrH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isColumnIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1908</span> </span><span class="WHIT">	</span><span class="NAME">this.settop</span><span class="PUNC">(</span><span class="NAME">this.calculateHeight</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">this.getfreezetop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">hdrH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// should compute because heights may vary</span><span class="WHIT">
<span class='line'>1909</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1910</span> 
<span class='line'>1911</span> </span><span class="COMM">/**
<span class='line'>1912</span>  * Resizes the scroller dimensions.
<span class='line'>1913</span>  * @private
<span class='line'>1914</span>  */</span><span class="WHIT">
<span class='line'>1915</span> </span><span class="NAME">ntb_gridp.resizeScroller</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1916</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1917</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: refactor, the toolbars should not be taken into account .... that should all alredy be set in the this.getHeight property </span><span class="WHIT">
<span class='line'>1918</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tbDelta</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">this.getToolbars</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.isToolbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">this.getToolbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1919</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hdrH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isColumnIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1920</span> </span><span class="WHIT">	</span><span class="NAME">this.Scroller.resize</span><span class="PUNC">(</span><span class="WHIT">	</span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">tbDelta</span><span class="PUNC">-</span><span class="NAME">hdrH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1921</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1922</span> </span><span class="COMM">/**
<span class='line'>1923</span>  * Resizes the grid to the specified width and height. The size specified is the outermost container size
<span class='line'>1924</span>  * of the grid including toolbars, scrollbars and borders. 
<span class='line'>1925</span>  * @param {Number} width The width (in pixels) of the grid.
<span class='line'>1926</span>  * @param {Number} height The height (in pixels) of the grid.
<span class='line'>1927</span>  * @return {Boolean} Returns true if the table was successfully connected to and false otherwise.
<span class='line'>1928</span>  */</span><span class="WHIT">
<span class='line'>1929</span> </span><span class="NAME">ntb_gridp.resize</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1930</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1931</span> </span><span class="WHIT">	</span><span class="NAME">this.setWidth</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1932</span> </span><span class="WHIT">	</span><span class="NAME">this.setHeight</span><span class="PUNC">(</span><span class="NAME">height</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1933</span> 
<span class='line'>1934</span> </span><span class="WHIT">	</span><span class="COMM">// Just generate the CSS</span><span class="WHIT">
<span class='line'>1935</span> </span><span class="WHIT">	</span><span class="NAME">this.generateCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1936</span> 
<span class='line'>1937</span> </span><span class="WHIT">	</span><span class="COMM">// Then fix the toolbar</span><span class="WHIT">
<span class='line'>1938</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterGridResize"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">source</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">width</span><span class="PUNC">:</span><span class="NAME">width</span><span class="PUNC">,</span><span class="NAME">height</span><span class="PUNC">:</span><span class="NAME">height</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1939</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1940</span> 
<span class='line'>1941</span> </span><span class="COMM">/**
<span class='line'>1942</span>  * Executes before a user initiated resize event occurs.
<span class='line'>1943</span>  * @param {Object} evt Event arguments 
<span class='line'>1944</span>  */</span><span class="WHIT">
<span class='line'>1945</span> </span><span class="NAME">ntb_gridp.beforeResize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1946</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1947</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeResizeEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1948</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">this.getOnBeforeResizeEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">beforeResizeEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1949</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>1950</span> </span><span class="WHIT">	</span><span class="NAME">this.gridResizer.startResize</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1951</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1952</span> 
<span class='line'>1953</span> </span><span class="COMM">/**
<span class='line'>1954</span>  * Executes after a user initiated resize event occurs.
<span class='line'>1955</span>  */</span><span class="WHIT">
<span class='line'>1956</span> </span><span class="NAME">ntb_gridp.afterResize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1957</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1958</span> </span><span class="WHIT">	</span><span class="NAME">this.resize</span><span class="PUNC">(</span><span class="NAME">this.gridResizer.newWidth</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.gridResizer.newHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1959</span> </span><span class="WHIT">	</span><span class="NAME">this.syncWithData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1960</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1961</span> 
<span class='line'>1962</span> </span><span class="COMM">/**
<span class='line'>1963</span>  * Executes after a user initiated column resize event occurs.
<span class='line'>1964</span>  * @param {Object} evt Event arguments 
<span class='line'>1965</span>  */</span><span class="WHIT">
<span class='line'>1966</span> </span><span class="NAME">ntb_gridp.afterColumnResize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">resizer</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1967</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1968</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">resizer.column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1969</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">col.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1970</span> </span><span class="WHIT">	</span><span class="NAME">this.columnResize</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">prevWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">resizer.dx</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1971</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1972</span> 
<span class='line'>1973</span> </span><span class="COMM">/**
<span class='line'>1974</span>  * Resizes the grid column to the specified width. 
<span class='line'>1975</span>  * @param {Number} width The width (in pixels) of the column.
<span class='line'>1976</span>  * @param {Number|nitobi.grid.Column} column The index of the column to resize or the Column object.
<span class='line'>1977</span>  */</span><span class="WHIT">
<span class='line'>1978</span> </span><span class="NAME">ntb_gridp.columnResize</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>1979</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1980</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1981</span> 
<span class='line'>1982</span> </span><span class="WHIT">	</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">?</span><span class="NAME">column</span><span class="PUNC">:</span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1983</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">prevWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1984</span> </span><span class="WHIT">	</span><span class="NAME">column.setWidth</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1985</span> 
<span class='line'>1986</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: this is a hack to fix a problem with the fixed column header not resizing.</span><span class="WHIT">
<span class='line'>1987</span> </span><span class="WHIT">	</span><span class="COMM">// This was causing some hacky code to be added in EBASelection.collapse </span><span class="WHIT">
<span class='line'>1988</span> </span><span class="WHIT">	</span><span class="COMM">// see the following - tix for details.</span><span class="WHIT">
<span class='line'>1989</span> </span><span class="WHIT">	</span><span class="COMM">// http://portal:8090/cgi-bin/trac.cgi/ticket/522</span><span class="WHIT">
<span class='line'>1990</span> </span><span class="WHIT">	</span><span class="NAME">this.updateCellRanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1991</span> 
<span class='line'>1992</span> </span><span class="WHIT">	</span><span class="COMM">// This is ridiculous ... IE 7 has issues with changing rules directly!!!</span><span class="WHIT">
<span class='line'>1993</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE7</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>1994</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1995</span> </span><span class="WHIT">		</span><span class="NAME">this.generateCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>1996</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>1997</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>1998</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>1999</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.column</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2000</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">prevWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2001</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">C</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2002</span> </span><span class="WHIT">		</span><span class="COMM">// Things are different if we are resizing a frozen or unfrozen column</span><span class="WHIT">
<span class='line'>2003</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnIndex</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2004</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2005</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">leftStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">C.getClass</span><span class="PUNC">(</span><span class="STRN">".ntb-grid-leftwidth"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2006</span> </span><span class="WHIT">			</span><span class="NAME">leftStyle.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">leftStyle.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2007</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">centerStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">C.getClass</span><span class="PUNC">(</span><span class="STRN">".ntb-grid-centerwidth"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2008</span> </span><span class="WHIT">			</span><span class="NAME">centerStyle.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">centerStyle.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2009</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2010</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2011</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2012</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">surfaceStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">C.getClass</span><span class="PUNC">(</span><span class="STRN">".ntb-grid-surfacewidth"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2013</span> </span><span class="WHIT">			</span><span class="NAME">surfaceStyle.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">surfaceStyle.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2014</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2015</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2016</span> </span><span class="WHIT">		</span><span class="COMM">// No matter what do the column class itself</span><span class="WHIT">
<span class='line'>2017</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">C.getClass</span><span class="PUNC">(</span><span class="STRN">".ntb-column"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">columnIndex</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2018</span> </span><span class="WHIT">		</span><span class="NAME">columnStyle.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">columnStyle.width</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">dx</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2019</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2020</span> </span><span class="WHIT">		</span><span class="NAME">this.adjustHorizontalScrollBars</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2021</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2022</span> 
<span class='line'>2023</span> </span><span class="WHIT">	</span><span class="NAME">this.Selection.collapse</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2024</span> 
<span class='line'>2025</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">afterColumnResizeEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnAfterColumnResizeEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2026</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">column.getOnAfterResizeEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">afterColumnResizeEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2027</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2028</span> 
<span class='line'>2029</span> 
<span class='line'>2030</span> </span><span class="COMM">/**
<span class='line'>2031</span>  * Loads the Grid Model from XML. The Model is essentially a serialization of the Grid state which contains all the property values and 
<span class='line'>2032</span>  * child object information.
<span class='line'>2033</span>  * @private
<span class='line'>2034</span>  */</span><span class="WHIT">
<span class='line'>2035</span> </span><span class="NAME">ntb_gridp.initializeModel</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2036</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2037</span> </span><span class="WHIT">	</span><span class="NAME">this.model</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.createXmlDoc</span><span class="PUNC">(</span><span class="NAME">nitobi.xml.serialize</span><span class="PUNC">(</span><span class="NAME">nitobi.grid.modelDoc</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2038</span> 
<span class='line'>2039</span> </span><span class="WHIT">	</span><span class="NAME">this.modelNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.documentElement.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"//nitobi.grid.Grid"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2040</span> 
<span class='line'>2041</span> </span><span class="WHIT">	</span><span class="COMM">// Setup the scrollbar width / height that depends on the Windows style that is used</span><span class="WHIT">
<span class='line'>2042</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollBarHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.getScrollBarWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2043</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">scrollBarHeight</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2044</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2045</span> </span><span class="WHIT">		</span><span class="NAME">this.setscrollbarWidth</span><span class="PUNC">(</span><span class="NAME">scrollBarHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2046</span> </span><span class="WHIT">		</span><span class="NAME">this.setscrollbarHeight</span><span class="PUNC">(</span><span class="NAME">scrollBarHeight</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2047</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2048</span> 
<span class='line'>2049</span> </span><span class="WHIT">	</span><span class="COMM">// Set up column definitions - Do this in XSL</span><span class="WHIT">
<span class='line'>2050</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2051</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xDec</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2052</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="PUNC">=</span><span class="NAME">this.model.createElement</span><span class="PUNC">(</span><span class="STRN">"nitobi.grid.Columns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2053</span> </span><span class="WHIT">		</span><span class="NAME">this.model.documentElement.appendChild</span><span class="PUNC">(</span><span class="NAME">nitobi.xml.importNode</span><span class="PUNC">(</span><span class="NAME">this.model</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2054</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2055</span> 
<span class='line'>2056</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2057</span> 
<span class='line'>2058</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2059</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2060</span> </span><span class="WHIT">		</span><span class="COMM">// Generate column definitions</span><span class="WHIT">
<span class='line'>2061</span> </span><span class="WHIT">		</span><span class="NAME">this.defineColumns</span><span class="PUNC">(</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2062</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2063</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>2064</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2065</span> </span><span class="WHIT">		</span><span class="NAME">this.columnsDefined</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2066</span> </span><span class="WHIT">		</span><span class="NAME">this.inferredColumns</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>2067</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2068</span> 
<span class='line'>2069</span> </span><span class="WHIT">	</span><span class="NAME">this.model.documentElement.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ID"</span><span class="PUNC">,</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2070</span> </span><span class="WHIT">	</span><span class="NAME">this.model.documentElement.setAttribute</span><span class="PUNC">(</span><span class="STRN">"uniqueID"</span><span class="PUNC">,</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2071</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2072</span> 
<span class='line'>2073</span> </span><span class="COMM">/**
<span class='line'>2074</span>  * @private
<span class='line'>2075</span>  */</span><span class="WHIT">
<span class='line'>2076</span> </span><span class="NAME">ntb_gridp.clearDefaultData</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2077</span> </span><span class="WHIT">	</span><span class="COMM">// Set up default rows - Do this in XSL</span><span class="WHIT">
<span class='line'>2078</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">rows</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2079</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">=</span><span class="NAME">this.model.createElement</span><span class="PUNC">(</span><span class="STRN">"e"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2080</span> </span><span class="WHIT">		</span><span class="NAME">e.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xi"</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2081</span> </span><span class="WHIT">		</span><span class="NAME">xDec.appendChild</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2082</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2083</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2084</span> 
<span class='line'>2085</span> </span><span class="COMM">/**
<span class='line'>2086</span>  * Creates the renderers for the nine possilbe Viewports of the Grid.
<span class='line'>2087</span>  * @private
<span class='line'>2088</span>  */</span><span class="WHIT">
<span class='line'>2089</span> </span><span class="NAME">ntb_gridp.createRenderers</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2090</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">uniqueId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.uid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2091</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2092</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">renderers</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="STRN">"TopLeftRenderer"</span><span class="PUNC">,</span><span class="STRN">"TopCenterRenderer"</span><span class="PUNC">,</span><span class="STRN">"MidLeftRenderer"</span><span class="PUNC">,</span><span class="STRN">"MidCenterRenderer"</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2093</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NUMB">4</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2094</span> </span><span class="WHIT">		</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">renderers</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.RowRenderer</span><span class="PUNC">(</span><span class="NAME">this.data</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">rowHeight</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="NAME">uniqueId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2095</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2096</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2097</span> 
<span class='line'>2098</span> </span><span class="COMM">/**
<span class='line'>2099</span>  * @private
<span class='line'>2100</span>  */</span><span class="WHIT">
<span class='line'>2101</span> </span><span class="NAME">ntb_gridp.bind</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2102</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2103</span> </span><span class="WHIT">	</span><span class="COMM">//	bind() should do two things:</span><span class="WHIT">
<span class='line'>2104</span> </span><span class="WHIT">	</span><span class="COMM">//	1) look at all the columns and get any data for external datasources before grid rendering takes place</span><span class="WHIT">
<span class='line'>2105</span> </span><span class="WHIT">	</span><span class="COMM">//	2) get the actual grid datasource</span><span class="WHIT">
<span class='line'>2106</span> </span><span class="WHIT">	</span><span class="COMM">//	Columns can bind to datasources defined in the data that is returned from the server for the grid itself.</span><span class="WHIT">
<span class='line'>2107</span> </span><span class="WHIT">	</span><span class="COMM">//	They can also bind to a custom getHandler if they desire or even an inline datasource</span><span class="WHIT">
<span class='line'>2108</span> 
<span class='line'>2109</span> </span><span class="WHIT">	</span><span class="COMM">// If we are already bound to a datasource then we need to clear things out</span><span class="WHIT">
<span class='line'>2110</span> </span><span class="WHIT">	</span><span class="COMM">// to get ready for the the newly bound datatable.</span><span class="WHIT">
<span class='line'>2111</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isBound</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2112</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2113</span> </span><span class="WHIT">		</span><span class="NAME">this.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2114</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: Here temporarily. It should be in datatable.flush.</span><span class="WHIT">
<span class='line'>2115</span> </span><span class="WHIT">		</span><span class="COMM">// See that todo.</span><span class="WHIT">
<span class='line'>2116</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.descriptor.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2117</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2118</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2119</span> 
<span class='line'>2120</span> </span><span class="COMM">/**
<span class='line'>2121</span>  * Connects the component to a DataTable. 
<span class='line'>2122</span>  * &lt;p>If the data is located on a 
<span class='line'>2123</span>  * remote server then the GetHandler property is required to retrieve the 
<span class='line'>2124</span>  * data asynchronously from the remote server otherwise a DatasourceId is 
<span class='line'>2125</span>  * required if the data is already on the client. If the component was 
<span class='line'>2126</span>  * initialized using a declaration that contained column definitions these 
<span class='line'>2127</span>  * will be mapped to the columns in the data source using the 
<span class='line'>2128</span>  * &lt;ntb:datastructure ... /&gt; element returned from the remote data 
<span class='line'>2129</span>  * source. If there are no columns defined through either JavaScript or a 
<span class='line'>2130</span>  * declaration then the columns will be autogenerated from the data 
<span class='line'>2131</span>  * returned from the remote data source according to the 
<span class='line'>2132</span>  * &lt;ntb:datastructure ... /&gt; element.
<span class='line'>2133</span>  * &lt;/p>
<span class='line'>2134</span>  * &lt;p>
<span class='line'>2135</span>  * &lt;b>Example&lt;/b>:  Manually request data from the gethandler
<span class='line'>2136</span>  * &lt;/p>
<span class='line'>2137</span>  * &lt;div class="code">
<span class='line'>2138</span>  * &lt;pre>&lt;code class="">
<span class='line'>2139</span>  * &#102;unction customRequest(gridId)
<span class='line'>2140</span>  * {
<span class='line'>2141</span>  * 	var grid = nitobi.getComponent(gridId);
<span class='line'>2142</span>  * 	var datatable = grid.getDataSource();
<span class='line'>2143</span>  * 	datatable.setGetHandlerParameter("param1", "value1");
<span class='line'>2144</span>  * 	grid.dataBind();
<span class='line'>2145</span>  * }
<span class='line'>2146</span>  * &lt;/code>&lt;/pre>
<span class='line'>2147</span>  * &lt;/div>
<span class='line'>2148</span>  * @see #getDataSource
<span class='line'>2149</span>  * @see nitobi.data.DataTable#setGetHandlerParameter
<span class='line'>2150</span>  */</span><span class="WHIT">
<span class='line'>2151</span> </span><span class="NAME">ntb_gridp.dataBind</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2152</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2153</span> </span><span class="WHIT">	</span><span class="NAME">this.bind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2154</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2155</span> 
<span class='line'>2156</span> </span><span class="COMM">/**
<span class='line'>2157</span>  * Returns the DataTable with the specified id.
<span class='line'>2158</span>  * &lt;p>
<span class='line'>2159</span>  * The DataTable represents the Grid's client side, XML based, data source.
<span class='line'>2160</span>  * &lt;/p>
<span class='line'>2161</span>  * &lt;p>
<span class='line'>2162</span>  * &lt;b>Example&lt;/b>
<span class='line'>2163</span>  * &lt;/p>
<span class='line'>2164</span>  * &lt;div class="code">
<span class='line'>2165</span>  * &lt;pre>&lt;code class="">
<span class='line'>2166</span>  * &#102;unction customRequest(gridId)
<span class='line'>2167</span>  * {
<span class='line'>2168</span>  * 	var grid = nitobi.getComponent(gridId);
<span class='line'>2169</span>  * 	var datatable = grid.getDataSource();
<span class='line'>2170</span>  * 	datatable.setGetHandlerParameter("param1", "value1");
<span class='line'>2171</span>  * 	grid.dataBind();
<span class='line'>2172</span>  * }
<span class='line'>2173</span>  * &lt;/code>&lt;/pre>
<span class='line'>2174</span>  * &lt;/div>
<span class='line'>2175</span>  * @param {String} paramTableId The id of the DataTable to return. If no table ID is specified 
<span class='line'>2176</span>  * the Grid DataTable is returned. Optional. 
<span class='line'>2177</span>  * @type nitobi.data.DataTable
<span class='line'>2178</span>  * @see nitobi.data.DataTable#setGetHandlerParameter
<span class='line'>2179</span>  * @see #dataBind
<span class='line'>2180</span>  */</span><span class="WHIT">
<span class='line'>2181</span> </span><span class="NAME">ntb_gridp.getDataSource</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">paramTableId</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2182</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2183</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tableID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.dataTableId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"_default"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2184</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">paramTableId</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2185</span> </span><span class="WHIT">		</span><span class="NAME">tableID</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paramTableId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2186</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.data.getTable</span><span class="PUNC">(</span><span class="NAME">tableID</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2187</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2188</span> 
<span class='line'>2189</span> </span><span class="COMM">/**
<span class='line'>2190</span>  * Returns the change log from the specified DataTable. 
<span class='line'>2191</span>  * &lt;p>
<span class='line'>2192</span>  * &lt;b>Example&lt;/b>:  Format of change log
<span class='line'>2193</span>  * &lt;/p>
<span class='line'>2194</span>  * &lt;div class="code">
<span class='line'>2195</span>  * &lt;pre>&lt;code class="">
<span class='line'>2196</span>  * &lt;ntb:grid xmlns:ntb="http://www.nitobi.com"&gt;
<span class='line'>2197</span>  * 	&lt;ntb:datasources id="id"&gt;
<span class='line'>2198</span>  * 		&lt;ntb:datasource id="_default"&gt;
<span class='line'>2199</span>  * 			&lt;ntb:datasourcestructure /&gt;
<span class='line'>2200</span>  * 			&lt;ntb:data id="_default"&gt;
<span class='line'>2201</span>  * 				&lt;ntb:e xi="0" xid="id0x04922bc02ntbcmp_0" a="CIA" b="Adhesive" c="4021010" d="4.66" e="24 - 250 g pkgs" f="20896" xac="u" /&gt;
<span class='line'>2202</span>  * 			&lt;/ntb:data&gt;
<span class='line'>2203</span>  * 		&lt;/ntb:datasource&gt;
<span class='line'>2204</span>  * 	&lt;/ntb:datasources&gt;
<span class='line'>2205</span>  * &lt;/ntb:grid&gt;
<span class='line'>2206</span>  * &lt;/code>&lt;/pre>
<span class='line'>2207</span>  * &lt;/div>
<span class='line'>2208</span>  * @param {String} paramTableId The ID of the DataTable to retrieve the XML log for.  Can
<span class='line'>2209</span>  * be null if the grid is not using local data.
<span class='line'>2210</span>  * @type XMLDocument
<span class='line'>2211</span>  */</span><span class="WHIT">
<span class='line'>2212</span> </span><span class="NAME">ntb_gridp.getChangeLogXmlDoc</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">paramTableId</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2213</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2214</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getDataSource</span><span class="PUNC">(</span><span class="NAME">paramTableId</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getChangeLogXmlDoc</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2215</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2216</span> 
<span class='line'>2217</span> </span><span class="COMM">/**
<span class='line'>2218</span>  * Fired when a remote server call returns. This is the callback function used when for the server request made from the bind() method.
<span class='line'>2219</span>  * @param {nitobi.data.GetCompleteEventArgs}
<span class='line'>2220</span>  * @private
<span class='line'>2221</span>  */</span><span class="WHIT">
<span class='line'>2222</span> </span><span class="NAME">ntb_gridp.getComplete</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evtArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2223</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2224</span> </span><span class="WHIT">	</span><span class="COMM">// This is ok here, but we should use the error handlers in table data source.</span><span class="WHIT">
<span class='line'>2225</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">evtArgs.dataSource.xmlDoc</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2226</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2227</span> </span><span class="WHIT">		</span><span class="NAME">ebaErrorReport</span><span class="PUNC">(</span><span class="STRN">"evtArgs.dataSource.xmlDoc is null or not defined. Likely the gethandler failed use fiddler to check the response"</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">EBA_ERROR</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2228</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"LoadingError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2229</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2230</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2231</span> 
<span class='line'>2232</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataSource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evtArgs.dataSource.xmlDoc.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">'//'</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">'datasource[@id=\''</span><span class="PUNC">+</span><span class="NAME">evtArgs.dataSource.id</span><span class="PUNC">+</span><span class="STRN">'\']'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2233</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">dataSource</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Datasource is not avialable in bindComplete handler.\n'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2234</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2235</span> 
<span class='line'>2236</span> </span><span class="COMM">/**
<span class='line'>2237</span>  * Fired when binding - to either a local or remote datasource - is complete. 
<span class='line'>2238</span>  * At this point the the data is rendered and the Grid is ready for use.
<span class='line'>2239</span>  */</span><span class="WHIT">
<span class='line'>2240</span> </span><span class="NAME">ntb_gridp.bindComplete</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2241</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2242</span> </span><span class="WHIT">	</span><span class="COMM">// If columns haven't been defined yet then define them</span><span class="WHIT">
<span class='line'>2243</span> </span><span class="WHIT">	</span><span class="COMM">// This is the case where the columns are defined by the data</span><span class="WHIT">
<span class='line'>2244</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.inferredColumns</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.columnsDefined</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2245</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2246</span> </span><span class="WHIT">		</span><span class="NAME">this.defineColumns</span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2247</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2248</span> 
<span class='line'>2249</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: this setRowCount should not be here ...</span><span class="WHIT">
<span class='line'>2250</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: But this is in conflict with grouping grid / block rendering mechanism so I am leaving it.  </span><span class="WHIT">
<span class='line'>2251</span> </span><span class="WHIT">	</span><span class="NAME">this.setRowCount</span><span class="PUNC">(</span><span class="NAME">this.datatable.remoteRowCount</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2252</span> 
<span class='line'>2253</span> </span><span class="WHIT">	</span><span class="COMM">// The bound property indicates that events from the datasource to which</span><span class="WHIT">
<span class='line'>2254</span> </span><span class="WHIT">	</span><span class="COMM">// we are bound will now be able to cause re-renders of our interface</span><span class="WHIT">
<span class='line'>2255</span> </span><span class="WHIT">	</span><span class="NAME">this.setBound</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2256</span> 
<span class='line'>2257</span> </span><span class="WHIT">	</span><span class="NAME">this.syncWithData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2258</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2259</span> </span><span class="COMM">/**
<span class='line'>2260</span>  * Keeps the Grid UI surfaces in sync with the data in the connected DataTable.
<span class='line'>2261</span>  */</span><span class="WHIT">
<span class='line'>2262</span> </span><span class="NAME">ntb_gridp.syncWithData</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2263</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2264</span> </span><span class="WHIT">	</span><span class="COMM">// Only if we are in the "Bound" state do we want to actually render changes to the data.</span><span class="WHIT">
<span class='line'>2265</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isBound</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2266</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2267</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.render</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2268</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"DataReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"source"</span><span class="PUNC">:</span><span class="KEYW">this</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2269</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2270</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2271</span> 
<span class='line'>2272</span> </span><span class="COMM">/**
<span class='line'>2273</span>  * Sets RowCountKnown to true and sets the RowCount to the rows argument value. 
<span class='line'>2274</span>  * This method is subscribed to the OnRowCountKnownEvent event on the DataTable.
<span class='line'>2275</span>  * @param {Number} rows
<span class='line'>2276</span>  * @see #OnRowCountKnownEvent
<span class='line'>2277</span>  * @private
<span class='line'>2278</span>  */</span><span class="WHIT">
<span class='line'>2279</span> </span><span class="NAME">ntb_gridp.finalizeRowCount</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2280</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2281</span> </span><span class="WHIT">	</span><span class="NAME">this.rowCountKnown</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2282</span> </span><span class="WHIT">	</span><span class="NAME">this.setRowCount</span><span class="PUNC">(</span><span class="NAME">rows</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2283</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2284</span> </span><span class="COMM">/**
<span class='line'>2285</span>  * Calls scrollVertical() with the pct argument. This method is subscribed to OnPastEndOfDataEvent of the DataTable.
<span class='line'>2286</span>  * @private
<span class='line'>2287</span>  * @param {Number} pct The percentage that the vertical scroll should be set to.
<span class='line'>2288</span>  * @see #OnPastEndOfData
<span class='line'>2289</span>  */</span><span class="WHIT">
<span class='line'>2290</span> </span><span class="NAME">ntb_gridp.adjustRowCount</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pct</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2291</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2292</span> </span><span class="COMM">//	alert("Past End-of-data "+ pct+" : "+this.rowCount)</span><span class="WHIT">
<span class='line'>2293</span> </span><span class="WHIT">	</span><span class="NAME">this.scrollVertical</span><span class="PUNC">(</span><span class="NAME">pct</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2294</span> </span><span class="COMM">//	this.setRowCount(scrollVertical)</span><span class="WHIT">
<span class='line'>2295</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2296</span> </span><span class="COMM">/**
<span class='line'>2297</span>  * Sets the number of rows in the Grid
<span class='line'>2298</span>  * @private
<span class='line'>2299</span>  */</span><span class="WHIT">
<span class='line'>2300</span> </span><span class="NAME">ntb_gridp.setRowCount</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2301</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2302</span> </span><span class="WHIT">	</span><span class="NAME">this.xSET</span><span class="PUNC">(</span><span class="STRN">"RowCount"</span><span class="PUNC">,</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2303</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getPagingMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.PAGINGMODE_STANDARD</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2304</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2305</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDataMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.data.DATAMODE_LOCAL</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2306</span> </span><span class="WHIT">			</span><span class="NAME">this.setDisplayedRowCount</span><span class="PUNC">(</span><span class="NAME">this.getRowsPerPage</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2307</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2308</span> </span><span class="WHIT">		</span><span class="NAME">this.setDisplayedRowCount</span><span class="PUNC">(</span><span class="NAME">rows</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2309</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2310</span> </span><span class="WHIT">	</span><span class="NAME">this.rowCount</span><span class="PUNC">=</span><span class="NAME">rows</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2311</span> 
<span class='line'>2312</span> </span><span class="WHIT">	</span><span class="COMM">//this.Scroller.setRowCount(); // maybe do this instead of updateCellRanges (more lightweight)</span><span class="WHIT">
<span class='line'>2313</span> </span><span class="WHIT">	</span><span class="NAME">this.updateCellRanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2314</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2315</span> 
<span class='line'>2316</span> </span><span class="COMM">/**
<span class='line'>2317</span>  * Returns the number of rows in the Grid.
<span class='line'>2318</span>  * @type Number
<span class='line'>2319</span>  */</span><span class="WHIT">
<span class='line'>2320</span> </span><span class="NAME">ntb_gridp.getRowCount</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2321</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2322</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.rowCount</span><span class="WHIT">
<span class='line'>2323</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2324</span> </span><span class="COMM">/**
<span class='line'>2325</span>  * Applies all measurements that were calculated in &lt;code>measure()&lt;/code> and adjusts layout or re-renders things that need to be re-rendered.
<span class='line'>2326</span>  * @private
<span class='line'>2327</span>  */</span><span class="WHIT">
<span class='line'>2328</span> </span><span class="NAME">ntb_gridp.layout</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2329</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2330</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.prevHeight</span><span class="PUNC">!=</span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.prevWidth</span><span class="PUNC">!=</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2331</span> </span><span class="WHIT">		</span><span class="NAME">this.prevHeight</span><span class="PUNC">=</span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2332</span> </span><span class="WHIT">		</span><span class="NAME">this.prevWidth</span><span class="PUNC">=</span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2333</span> </span><span class="WHIT">		</span><span class="NAME">this.layoutValid</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2334</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2335</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.layoutValid</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.frameRendered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2336</span> </span><span class="WHIT">		</span><span class="NAME">this.layoutFrame</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2337</span> </span><span class="WHIT">		</span><span class="NAME">this.generateFrameCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2338</span> </span><span class="WHIT">		</span><span class="NAME">this.layoutValid</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2339</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2340</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2341</span> 
<span class='line'>2342</span> </span><span class="COMM">/**
<span class='line'>2343</span>  * @private
<span class='line'>2344</span>  */</span><span class="WHIT">
<span class='line'>2345</span> </span><span class="NAME">ntb_gridp.layoutFrame</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2346</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2347</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.frameRendered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">		</span><span class="COMM">//Exit if frameRendered is not true</span><span class="WHIT">
<span class='line'>2348</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.Scroller</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">				</span><span class="COMM">//Exit if Scroller not initialized</span><span class="WHIT">
<span class='line'>2349</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2350</span> </span><span class="WHIT">	</span><span class="NAME">this.minHeight</span><span class="PUNC">=</span><span class="NAME">this.getMinHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2351</span> </span><span class="WHIT">	</span><span class="NAME">this.minWidth</span><span class="PUNC">=</span><span class="NAME">this.getMinWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2352</span> 
<span class='line'>2353</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colScale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2354</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowScale</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2355</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tbH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getToolbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 		</span><span class="COMM">// Height of toolbar;</span><span class="WHIT">
<span class='line'>2356</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 		</span><span class="COMM">// Height of a single row;</span><span class="WHIT">
<span class='line'>2357</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">20</span><span class="PUNC">;</span><span class="WHIT"> 							</span><span class="COMM">// Width = of a single column;</span><span class="WHIT">
<span class='line'>2358</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sbH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getscrollbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 	</span><span class="COMM">// Height of Scrollbar;</span><span class="WHIT">
<span class='line'>2359</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sbW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getscrollbarWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 	</span><span class="COMM">// Width of scrollbar;</span><span class="WHIT">
<span class='line'>2360</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hdrH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 	</span><span class="COMM">// Height of the header;</span><span class="WHIT">
<span class='line'>2361</span> 
<span class='line'>2362</span> </span><span class="COMM">// TODO: is tbH really the height or is it the delta.</span><span class="WHIT">
<span class='line'>2363</span> </span><span class="WHIT">	</span><span class="NAME">tbH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isToolbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">tbH</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// If toolbar is not visible, make its height value 0</span><span class="WHIT">
<span class='line'>2364</span> </span><span class="WHIT">	</span><span class="NAME">hdrH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isColumnIndicatorsEnabled</span><span class="PUNC">?</span><span class="NAME">hdrH</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2365</span> 
<span class='line'>2366</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.minHeight</span><span class="PUNC">,</span><span class="NAME">tbH</span><span class="PUNC">+</span><span class="NAME">rowH</span><span class="PUNC">+</span><span class="NAME">sbH</span><span class="PUNC">+</span><span class="NAME">hdrH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// Note: need to calculate this value if width is a percent of container</span><span class="WHIT">
<span class='line'>2367</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Height</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// Note: need to calculate this value if height is a percent of container</span><span class="WHIT">
<span class='line'>2368</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">this.minWidth</span><span class="PUNC">,</span><span class="NAME">colW</span><span class="PUNC">+</span><span class="NAME">sbW</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2369</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Width</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2370</span> 
<span class='line'>2371</span> </span><span class="WHIT">	</span><span class="COMM">// If columns can scale then use min and max surface widths, otherwise surface width is fixed</span><span class="WHIT">
<span class='line'>2372</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colScale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2373</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minSW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.minSurfaceWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2374</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.maxSurfaceWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2375</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2376</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minSW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.SurfaceWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2377</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minSW</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2378</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2379</span> </span><span class="WHIT">	</span><span class="COMM">// If rows can scale(not likely) then use min and max surface heights, otherwise surface height is fixed</span><span class="WHIT">
<span class='line'>2380</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowScale</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2381</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minSH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.minSurfaceHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2382</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.maxSurfaceHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2383</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2384</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">minSH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.SurfaceHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2385</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">maxSH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minSH</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2386</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2387</span> 
<span class='line'>2388</span> </span><span class="WHIT">	</span><span class="COMM">// Calculate total height that would be required for vertical elements (without scrolling or scaling)</span><span class="WHIT">
<span class='line'>2389</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">totalH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minSH</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">tbH</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">hdrH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Not including scrollbar</span><span class="WHIT">
<span class='line'>2390</span> </span><span class="WHIT">	</span><span class="COMM">// Calculate total that that would be required for horizontal elements (without scrolling or scaling)</span><span class="WHIT">
<span class='line'>2391</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">totalW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">minSW</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Not including scrollbar</span><span class="WHIT">
<span class='line'>2392</span> 
<span class='line'>2393</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">VSvisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">totalH</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxH</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// This says scrollbar is required when the rows can't be scaled smaller and the  grid can't be scaled taller</span><span class="WHIT">
<span class='line'>2394</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">HSvisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">totalW</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">maxW</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// This says scrollbar is required when the columns can't be scaled smaller andhe  grid can't be scaled wider</span><span class="WHIT">
<span class='line'>2395</span> 
<span class='line'>2396</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">VSvisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">HSvisible</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">totalH</span><span class="PUNC">+</span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">maxH</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">VSvisible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Secondary check in case the additional height of the hscrollbar makes a vscrollbar necessary</span><span class="WHIT">
<span class='line'>2397</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">HSvisible</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">VSvisible</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">totalW</span><span class="PUNC">+</span><span class="NUMB">20</span><span class="PUNC">)</span><span class="PUNC">></span><span class="NAME">maxW</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">HSvisible</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Secondary check in case the additional width of the vscrollbar makes a hscrollbar necessary</span><span class="WHIT">
<span class='line'>2398</span> 
<span class='line'>2399</span> </span><span class="WHIT">	</span><span class="NAME">sbH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">HSvisible</span><span class="PUNC">?</span><span class="NAME">sbH</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// If scrollbar is not visible, make its height value 0</span><span class="WHIT">
<span class='line'>2400</span> </span><span class="WHIT">	</span><span class="NAME">sbV</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">VSvisible</span><span class="PUNC">?</span><span class="NAME">sbV</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="COMM">// If scrollbar is not visible, make its width value 0</span><span class="WHIT">
<span class='line'>2401</span> 
<span class='line'>2402</span> </span><span class="WHIT">	</span><span class="COMM">// Now we have enough info to calculate 2 width dimensions and 4 height dimensions for the frame (looks like a 2x4 table)</span><span class="WHIT">
<span class='line'>2403</span> </span><span class="WHIT">		</span><span class="COMM">// Width dimensions</span><span class="WHIT">
<span class='line'>2404</span> </span><span class="WHIT">			</span><span class="COMM">// 1. Width of viewport (vpW)- calcutated</span><span class="WHIT">
<span class='line'>2405</span> </span><span class="WHIT">			</span><span class="COMM">// 2. Width of scrollbar (sbW)</span><span class="WHIT">
<span class='line'>2406</span> </span><span class="WHIT">		</span><span class="COMM">// Height dimenions</span><span class="WHIT">
<span class='line'>2407</span> </span><span class="WHIT">			</span><span class="COMM">// 1. Header height (hdrH)</span><span class="WHIT">
<span class='line'>2408</span> </span><span class="WHIT">			</span><span class="COMM">// 2. Height of visible rows (vpH) - calculated </span><span class="WHIT">
<span class='line'>2409</span> </span><span class="WHIT">			</span><span class="COMM">// 3. Height of scrollbar (sbH)</span><span class="WHIT">
<span class='line'>2410</span> </span><span class="WHIT">			</span><span class="COMM">// 4. Height of toolbar (tbH)</span><span class="WHIT">
<span class='line'>2411</span> 
<span class='line'>2412</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vpH</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">totalH</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">hdrH</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">tbH</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sbH</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2413</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vpW</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">totalW</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">sbW</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2414</span> 
<span class='line'>2415</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: FROM GROUPING GRID</span><span class="WHIT">
<span class='line'>2416</span> </span><span class="WHIT">	</span><span class="NAME">this.resize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2417</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2418</span> 
<span class='line'>2419</span> </span><span class="COMM">/**
<span class='line'>2420</span>  * Defines the columns to be displayed in the Grid. Depending on the type of the columns argument different methods are dispatched to initialize the list of columns. 
<span class='line'>2421</span>  * As a String this property must be a bar ("|") seperated list of the column names in the nitobi.data.DataTable to which the Grid will connect. The XmlElement must 
<span class='line'>2422</span>  * contain a list column definitions as children XML nodes. Like the String type, the Array type specifies the column names in the nitobi.data.DataTable to which the 
<span class='line'>2423</span>  * Grid will connect. If an nitobi.data.DataTable is provided as the columns argument the columns in the nitobi.data.DataTable will define the columns in the Grid. 
<span class='line'>2424</span>  * Finally, if the columns argumnet is an integer it will prepare that number of columns to be defined at a later stage. OnBeforeColumnsDefinedEvent and OnAfterColumnsDefinedEvent 
<span class='line'>2425</span>  * are fired before and after this method is executed. This method is called from various places such as updateStructure(), commitProperties(), initializeModel(), and bindComplete().
<span class='line'>2426</span>  * @param {String | XmlElement | Array | nitobi.data.DataTable | Number} columns This is the description of the columns from which the Grid can determine the list of columns.
<span class='line'>2427</span>  * @see #OnAfterColumnsDefinedEvent
<span class='line'>2428</span>  * @see #OnBeforeColumnsDefinedEvent
<span class='line'>2429</span>  * @type XMLElement
<span class='line'>2430</span>  * @private
<span class='line'>2431</span>  */</span><span class="WHIT">
<span class='line'>2432</span> </span><span class="NAME">ntb_gridp.defineColumns</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2433</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2434</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeColumnsDefined"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Everything other than the frame should be cleared</span><span class="WHIT">
<span class='line'>2435</span> </span><span class="WHIT">	</span><span class="NAME">this.resetColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2436</span> 
<span class='line'>2437</span> </span><span class="WHIT">	</span><span class="COMM">//	get all the column defs</span><span class="WHIT">
<span class='line'>2438</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2439</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.typeOf</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2440</span> 
<span class='line'>2441</span> </span><span class="WHIT">	</span><span class="NAME">this.inferredColumns</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2442</span> 
<span class='line'>2443</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colType</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2444</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2445</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2446</span> </span><span class="WHIT">			</span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsFromString</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2447</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2448</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.type.XMLNODE</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2449</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.type.XMLDOC</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2450</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.type.HTMLNODE</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2451</span> </span><span class="WHIT">			</span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsFromXml</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2452</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2453</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.type.ARRAY</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2454</span> </span><span class="WHIT">			</span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsFromArray</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2455</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2456</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2457</span> </span><span class="WHIT">			</span><span class="NAME">this.inferredColumns</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2458</span> </span><span class="WHIT">			</span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsFromData</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2459</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2460</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2461</span> </span><span class="WHIT">			</span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsCollection</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2462</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2463</span> </span><span class="WHIT">		</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>2464</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2465</span> 
<span class='line'>2466</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterColumnsDefined"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2467</span> </span><span class="WHIT">	</span><span class="NAME">this.defineColumnsFinalize</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2468</span> 
<span class='line'>2469</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2470</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2471</span> 
<span class='line'>2472</span> </span><span class="COMM">/**
<span class='line'>2473</span>  * Defines the columns to be displayed in the Grid. The XMLElement must contain 
<span class='line'>2474</span>  * a list column definitions as children XML nodes and follow the Grid tag reference for the &lt;ntb:columns&gt; element.
<span class='line'>2475</span>  * @private
<span class='line'>2476</span>  */</span><span class="WHIT">
<span class='line'>2477</span> </span><span class="NAME">ntb_gridp.defineColumnsFromXml</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2478</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2479</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">columns.childNodes.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2480</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2481</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsCollection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2482</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2483</span> 
<span class='line'>2484</span> </span><span class="WHIT">	</span><span class="COMM">// If we are using the old-style column definitions</span><span class="WHIT">
<span class='line'>2485</span> </span><span class="WHIT">	</span><span class="COMM">// then convert them to new-style defs</span><span class="WHIT">
<span class='line'>2486</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columns.childNodes</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">nodeName</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">'columndefinition'</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2487</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2488</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xslDoc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.declarationConverterXslProc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2489</span> </span><span class="WHIT">		</span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.transformToXml</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslDoc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2490</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2491</span> 
<span class='line'>2492</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">wR</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2493</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultColumnDef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"/state/Defaults/nitobi.grid.Column"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2494</span> 
<span class='line'>2495</span> </span><span class="WHIT">	</span><span class="COMM">// get the original list of columns from the model</span><span class="WHIT">
<span class='line'>2496</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">originalCols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2497</span> 
<span class='line'>2498</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columns.childNodes.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2499</span> 
<span class='line'>2500</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2501</span> 
<span class='line'>2502</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">columns.xml</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'There are either no column definitions defined in the HTML declaration or they could not be parsed as valid XML.'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">EBA_DEBUG</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2503</span> 
<span class='line'>2504</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnDefinitionsArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columns.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2505</span> 
<span class='line'>2506</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: these are set in intitializeModelFromDeclaration but maybe they should not be ...</span><span class="WHIT">
<span class='line'>2507</span> </span><span class="WHIT">	</span><span class="COMM">//	intitializeModelFromDeclaration is called immediately prior to this method</span><span class="WHIT">
<span class='line'>2508</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="PUNC">=</span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2509</span> 
<span class='line'>2510</span> </span><span class="WHIT">		</span><span class="COMM">// If the state of the grid has not been saved, we should have 0 columns </span><span class="WHIT">
<span class='line'>2511</span> </span><span class="WHIT">		</span><span class="COMM">// in the model and go off the declaration.</span><span class="WHIT">
<span class='line'>2512</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">originalCols</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2513</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2514</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnDefinitionsArray.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2515</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cols</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2516</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2517</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnDefinitionsArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2518</span> 
<span class='line'>2519</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnDataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2520</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnNodeName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">col.nodeName</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2521</span> 
<span class='line'>2522</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">editorNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">col.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"ntb:texteditor|ntb:numbereditor|ntb:textareaeditor|ntb:imageeditor|ntb:linkeditor|ntb:dateeditor|ntb:lookupeditor|ntb:listboxeditor|ntb:checkboxeditor|ntb:passwordeditor"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2523</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnEditor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"TEXT"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2524</span> 
<span class='line'>2525</span> </span><span class="WHIT">				</span><span class="COMM">// Get the column datat type from the column node name</span><span class="WHIT">
<span class='line'>2526</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="STRN">"ntb:textcolumn"</span><span class="PUNC">:</span><span class="STRN">"EBATextColumn"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2527</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:numbercolumn"</span><span class="PUNC">:</span><span class="STRN">"EBANumberColumn"</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>2528</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:datecolumn"</span><span class="PUNC">:</span><span class="STRN">"EBADateColumn"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2529</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnDataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnNames</span><span class="PUNC">[</span><span class="NAME">columnNodeName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">'EBA'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">'Column'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2530</span> 
<span class='line'>2531</span> </span><span class="WHIT">				</span><span class="COMM">// Column editor name shows up in the column def as "type" and "editor"</span><span class="WHIT">
<span class='line'>2532</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnEditorNames</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2533</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:numbereditor"</span><span class="PUNC">:</span><span class="STRN">"EBANumberEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2534</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:textareaeditor"</span><span class="PUNC">:</span><span class="STRN">"EBATextareaEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2535</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:imageeditor"</span><span class="PUNC">:</span><span class="STRN">"EBAImageEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2536</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:linkeditor"</span><span class="PUNC">:</span><span class="STRN">"EBALinkEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2537</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:dateeditor"</span><span class="PUNC">:</span><span class="STRN">"EBADateEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2538</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:lookupeditor"</span><span class="PUNC">:</span><span class="STRN">"EBALookupEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2539</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:listboxeditor"</span><span class="PUNC">:</span><span class="STRN">"EBAListboxEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2540</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:passwordeditor"</span><span class="PUNC">:</span><span class="STRN">"EBAPasswordEditor"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2541</span> </span><span class="WHIT">								</span><span class="STRN">"ntb:checkboxeditor"</span><span class="PUNC">:</span><span class="STRN">"EBACheckboxEditor"</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2542</span> 
<span class='line'>2543</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">editorNode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2544</span> </span><span class="WHIT">					</span><span class="COMM">// If there is an editor element defined then use it</span><span class="WHIT">
<span class='line'>2545</span> </span><span class="WHIT">					</span><span class="NAME">columnEditor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnEditorNames</span><span class="PUNC">[</span><span class="NAME">editorNode.nodeName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">columnEditor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2546</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2547</span> </span><span class="WHIT">					</span><span class="COMM">// If there is no editor element then use editor for the column data type</span><span class="WHIT">
<span class='line'>2548</span> </span><span class="WHIT">					</span><span class="NAME">columnEditor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnNames</span><span class="PUNC">[</span><span class="NAME">columnNodeName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">columnEditor</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2549</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2550</span> </span><span class="WHIT">				</span><span class="NAME">columnEditor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnEditor.replace</span><span class="PUNC">(</span><span class="STRN">'EBA'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">'Editor'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="STRN">'Column'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2551</span> 
<span class='line'>2552</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"/state/Defaults/nitobi.grid.Column[@DataType='"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">columnDataType</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"' and @type='"</span><span class="PUNC">+</span><span class="NAME">columnEditor</span><span class="PUNC">+</span><span class="STRN">"' and @editor='"</span><span class="PUNC">+</span><span class="NAME">columnEditor</span><span class="PUNC">+</span><span class="STRN">"']"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2553</span> 
<span class='line'>2554</span> </span><span class="WHIT">				</span><span class="NAME">this.setModelValues</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2555</span> 
<span class='line'>2556</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sColumnType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnNames</span><span class="PUNC">[</span><span class="NAME">col.nodeName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">"EBATextColumn"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2557</span> 
<span class='line'>2558</span> </span><span class="WHIT">				</span><span class="COMM">// Looks for Datasource attributes on the column and parses it</span><span class="WHIT">
<span class='line'>2559</span> </span><span class="WHIT">				</span><span class="COMM">// into a real datatable object.</span><span class="WHIT">
<span class='line'>2560</span> </span><span class="WHIT"> 				</span><span class="NAME">this.defineColumnDatasource</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2561</span> 
<span class='line'>2562</span> </span><span class="WHIT">				</span><span class="COMM">// By now ALL attributes are set.</span><span class="WHIT">
<span class='line'>2563</span> </span><span class="WHIT">				</span><span class="COMM">//	Except for maybe the DatasourceId</span><span class="WHIT">
<span class='line'>2564</span> </span><span class="WHIT">				</span><span class="NAME">this.defineColumnBinding</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2565</span> 
<span class='line'>2566</span> </span><span class="WHIT">				</span><span class="COMM">// This adds the column def to the grid's state.</span><span class="WHIT">
<span class='line'>2567</span> </span><span class="WHIT">				</span><span class="NAME">xDec.appendChild</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2568</span> 
<span class='line'>2569</span> </span><span class="WHIT">				</span><span class="COMM">// Adding gethandler data table.</span><span class="WHIT">
<span class='line'>2570</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">gethandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.getAttribute</span><span class="PUNC">(</span><span class="STRN">'GetHandler'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2571</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">gethandler</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2572</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2573</span> </span><span class="WHIT">					</span><span class="COMM">//	Careful, other objects have a handle to this one. If a new this.data is created, a copy is made</span><span class="WHIT">
<span class='line'>2574</span> </span><span class="WHIT">					</span><span class="COMM">//	since the old this.data is still in memory due to live handles.</span><span class="WHIT">
<span class='line'>2575</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">datasourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.getAttribute</span><span class="PUNC">(</span><span class="STRN">"DatasourceId"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2576</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">datasourceId</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">datasourceId</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2577</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2578</span> </span><span class="WHIT">						</span><span class="NAME">datasourceId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"columnDatasource_"</span><span class="PUNC">+</span><span class="NAME">i</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2579</span> </span><span class="WHIT">						</span><span class="NAME">e.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DatasourceId"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">datasourceId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2580</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2581</span> 
<span class='line'>2582</span> </span><span class="WHIT">				</span><span class="WHIT">
<span class='line'>2583</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.data.DataTable</span><span class="PUNC">(</span><span class="STRN">'local'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getPagingMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.PAGINGMODE_LIVESCROLLING</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isAutoKeyEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2584</span> </span><span class="WHIT">					</span><span class="NAME">dt.initialize</span><span class="PUNC">(</span><span class="NAME">datasourceId</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">gethandler</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2585</span> </span><span class="WHIT">					</span><span class="NAME">dt.async</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2586</span> 
<span class='line'>2587</span> </span><span class="WHIT">					</span><span class="NAME">this.data.add</span><span class="PUNC">(</span><span class="NAME">dt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2588</span> 
<span class='line'>2589</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2590</span> </span><span class="WHIT">					</span><span class="NAME">params</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2591</span> 
<span class='line'>2592</span> </span><span class="WHIT">					</span><span class="COMM">// Do differnent things depending on the type of editor we are getting data for ...</span><span class="WHIT">
<span class='line'>2593</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sEditor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">e.getAttribute</span><span class="PUNC">(</span><span class="STRN">"editor"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2594</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">firstRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2595</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">lastRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2596</span> </span><span class="WHIT">					</span><span class="COMM">// If this i a lookup we just want 1 record - or even none - just for the schema information </span><span class="WHIT">
<span class='line'>2597</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e.getAttribute</span><span class="PUNC">(</span><span class="STRN">"editor"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"LOOKUP"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2598</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2599</span> </span><span class="WHIT">						</span><span class="COMM">// Get the first row of the data just to do the field mapping.</span><span class="WHIT">
<span class='line'>2600</span> </span><span class="WHIT">						</span><span class="NAME">firstRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2601</span> </span><span class="WHIT">						</span><span class="NAME">lastRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2602</span> </span><span class="WHIT">						</span><span class="NAME">dt.async</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2603</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2604</span> 
<span class='line'>2605</span> </span><span class="WHIT">					</span><span class="COMM">// TODO: This is currently synchronous since we need the fieldMap information to render the column.</span><span class="WHIT">
<span class='line'>2606</span> </span><span class="WHIT">					</span><span class="NAME">dt.get</span><span class="PUNC">(</span><span class="NAME">firstRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">lastRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.editorDataReady</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">e</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2607</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2608</span> </span><span class="WHIT">						</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="STRN">'Datasource for '</span><span class="PUNC">+</span><span class="NAME">e.getAttribute</span><span class="PUNC">(</span><span class="STRN">'ColumnName'</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">EBA_WARN</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2609</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2610</span> </span><span class="COMM">//					this.editorDataReady(e)</span><span class="WHIT">
<span class='line'>2611</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2612</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2613</span> 
<span class='line'>2614</span> </span><span class="COMM">//			TODO: We should be doing something with measure ...</span><span class="WHIT">
<span class='line'>2615</span> </span><span class="WHIT">			</span><span class="NAME">this.measureColumns</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2616</span> 
<span class='line'>2617</span> </span><span class="WHIT">			</span><span class="NAME">this.setColumnCount</span><span class="PUNC">(</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2618</span> 
<span class='line'>2619</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2620</span> 
<span class='line'>2621</span> </span><span class="WHIT">		</span><span class="COMM">// This is where old-style datasources will be found</span><span class="WHIT">
<span class='line'>2622</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldEditorDatasources</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2623</span> 
<span class='line'>2624</span> </span><span class="WHIT">		</span><span class="NAME">oldEditorDatasources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columns.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"/"</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">"grid/"</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">"datasources"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2625</span> 
<span class='line'>2626</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oldEditorDatasources</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2627</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2628</span> </span><span class="WHIT">			</span><span class="NAME">this.Declaration.datasources</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.createXmlDoc</span><span class="PUNC">(</span><span class="NAME">oldEditorDatasources.xml</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2629</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2630</span> 
<span class='line'>2631</span> </span><span class="WHIT">	</span><span class="COMM">// We use '//' in our xpath because the old columns will be enclosed in an ntb:grid </span><span class="WHIT">
<span class='line'>2632</span> </span><span class="WHIT">	</span><span class="COMM">// object, but our new columns will be in an ntb:columns object.</span><span class="WHIT">
<span class='line'>2633</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2634</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2635</span> </span><span class="COMM">/**
<span class='line'>2636</span>  * Updates objects that are affected by changes to column structure.
<span class='line'>2637</span>  * @private
<span class='line'>2638</span>  */</span><span class="WHIT">
<span class='line'>2639</span> </span><span class="NAME">ntb_gridp.defineColumnsFinalize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2640</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2641</span> </span><span class="WHIT">	</span><span class="NAME">this.setColumnsDefined</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2642</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.connected</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2643</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.frameRendered</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2644</span> </span><span class="WHIT">			</span><span class="NAME">this.makeXSL</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//renderColumns depends on makeXSL</span><span class="WHIT">
<span class='line'>2645</span> </span><span class="WHIT">			</span><span class="NAME">this.generateColumnCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2646</span> </span><span class="WHIT">			</span><span class="NAME">this.renderHeaders</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2647</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2648</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2649</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2650</span> 
<span class='line'>2651</span> </span><span class="COMM">/**
<span class='line'>2652</span>  * Parses a datasource from a column that could be defined either
<span class='line'>2653</span>  * from a Datasource attribute or a Datasource child declaration node.
<span class='line'>2654</span>  * This could also be extended to check for the DatasourceId property
<span class='line'>2655</span>  * or the getHandler property that are both defined elsewhere for the moment.
<span class='line'>2656</span>  * @private
<span class='line'>2657</span>  */</span><span class="WHIT">
<span class='line'>2658</span> </span><span class="NAME">ntb_gridp.defineColumnDatasource</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xColumnModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2659</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2660</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xColumnModel.getAttribute</span><span class="PUNC">(</span><span class="STRN">'Datasource'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2661</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2662</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2663</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2664</span> </span><span class="WHIT">		</span><span class="COMM">// a datasource has been specified</span><span class="WHIT">
<span class='line'>2665</span> </span><span class="WHIT">		</span><span class="KEYW">try</span><span class="WHIT">
<span class='line'>2666</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2667</span> </span><span class="WHIT">			</span><span class="NAME">ds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">val</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2668</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2669</span> </span><span class="WHIT">		</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2670</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2671</span> </span><span class="WHIT">			</span><span class="COMM">// The datasource could not be parsed as a JavaScript array ... now what.</span><span class="WHIT">
<span class='line'>2672</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">aNameValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">val.split</span><span class="PUNC">(</span><span class="STRN">','</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2673</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">aNameValue.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2674</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2675</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">aNameValue.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2676</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2677</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">aNameValue</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2678</span> </span><span class="WHIT">					</span><span class="NAME">ds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="NAME">text</span><span class="PUNC">:</span><span class="NAME">item.split</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">,</span><span class="NAME">display</span><span class="PUNC">:</span><span class="NAME">item.split</span><span class="PUNC">(</span><span class="STRN">':'</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2679</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2680</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2681</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT">
<span class='line'>2682</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2683</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">ds</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"object"</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">ds.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2684</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2685</span> </span><span class="WHIT">			</span><span class="COMM">// it could be a JavaScript array datasource</span><span class="WHIT">
<span class='line'>2686</span> </span><span class="WHIT">			</span><span class="COMM">// in this case loop through the array and create a datasource</span><span class="WHIT">
<span class='line'>2687</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oDataTable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.data.DataTable</span><span class="PUNC">(</span><span class="STRN">'unbound'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getPagingMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.PAGINGMODE_LIVESCROLLING</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="PUNC">{</span><span class="NAME">GridId</span><span class="PUNC">:</span><span class="NAME">this.getID</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isAutoKeyEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2688</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'columnDatasource'</span><span class="PUNC">+</span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2689</span> </span><span class="WHIT">			</span><span class="NAME">oDataTable.initialize</span><span class="PUNC">(</span><span class="NAME">sTableId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2690</span> </span><span class="WHIT">			</span><span class="NAME">xColumnModel.setAttribute</span><span class="PUNC">(</span><span class="STRN">'DatasourceId'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sTableId</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2691</span> 
<span class='line'>2692</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sFields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2693</span> </span><span class="WHIT">			</span><span class="COMM">// first look at one item in the array and get the fields list out of it</span><span class="WHIT">
<span class='line'>2694</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2695</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2696</span> </span><span class="WHIT">				</span><span class="NAME">sFields</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">'|'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2697</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2698</span> </span><span class="WHIT">			</span><span class="NAME">sFields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sFields.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sFields.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2699</span> 
<span class='line'>2700</span> </span><span class="WHIT">			</span><span class="COMM">// now init the datatable with our list of fields.</span><span class="WHIT">
<span class='line'>2701</span> </span><span class="WHIT">			</span><span class="NAME">oDataTable.initializeColumns</span><span class="PUNC">(</span><span class="NAME">sFields</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2702</span> 
<span class='line'>2703</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">ds.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2704</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2705</span> </span><span class="WHIT">				</span><span class="COMM">// create a record in the datatable</span><span class="WHIT">
<span class='line'>2706</span> </span><span class="WHIT">				</span><span class="NAME">oDataTable.createRecord</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2707</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2708</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2709</span> </span><span class="WHIT">					</span><span class="NAME">oDataTable.updateRecord</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">ds</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2710</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2711</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2712</span> </span><span class="WHIT">			</span><span class="NAME">this.data.add</span><span class="PUNC">(</span><span class="NAME">oDataTable</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2713</span> 
<span class='line'>2714</span> </span><span class="WHIT">			</span><span class="NAME">this.editorDataReady</span><span class="PUNC">(</span><span class="NAME">xColumnModel</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2715</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2716</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2717</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2718</span> 
<span class='line'>2719</span> </span><span class="COMM">/**
<span class='line'>2720</span>  * @private
<span class='line'>2721</span>  */</span><span class="WHIT">
<span class='line'>2722</span> </span><span class="COMM">/*
<span class='line'>2723</span> ntb_gridp.defineColumnEditor = function(xColumnModel, xColumnDeclaration)
<span class='line'>2724</span> {
<span class='line'>2725</span> 	var len = xColumnDeclaration.childNodes.length; 
<span class='line'>2726</span> 	if (len > 0)
<span class='line'>2727</span> 	{
<span class='line'>2728</span> 		var xEditorNode = xColumnDeclaration.selectSingleNode("ntb:texteditor|ntb:numbereditor|ntb:textareaeditor|ntb:imageeditor|ntb:linkeditor|ntb:dateeditor|ntb:lookupeditor|ntb:listboxeditor|ntb:checkboxeditor|ntb:passwordeditor");
<span class='line'>2729</span> 		if (xEditorNode != null)
<span class='line'>2730</span> 		{
<span class='line'>2731</span> 			var sEditor = 'EBATextEditor';
<span class='line'>2732</span> 			var sNodeName = xEditorNode.nodeName;
<span class='line'>2733</span> 
<span class='line'>2734</span> 			if (sNodeName.indexOf("numbereditor") != -1) {
<span class='line'>2735</span> 				sEditor = 'EBANumberEditor';
<span class='line'>2736</span> 			} else if (sNodeName.indexOf("textareaeditor") != -1) {
<span class='line'>2737</span> 				sEditor = 'EBATextareaEditor';
<span class='line'>2738</span> 			} else if (sNodeName.indexOf("imageeditor") != -1) {
<span class='line'>2739</span> 				sEditor = 'EBAImageEditor';
<span class='line'>2740</span> 			} else if (sNodeName.indexOf("linkeditor") != -1) {
<span class='line'>2741</span> 				sEditor = 'EBALinkEditor';
<span class='line'>2742</span> 			} else if (sNodeName.indexOf("dateeditor") != -1) {
<span class='line'>2743</span> 				sEditor = 'EBADateEditor';
<span class='line'>2744</span> 			} else if (sNodeName.indexOf("lookupeditor") != -1) { 
<span class='line'>2745</span> 				sEditor = 'EBALookupEditor';
<span class='line'>2746</span> 			} else if (sNodeName.indexOf("listboxeditor") != -1) {
<span class='line'>2747</span> 				sEditor = 'EBAListboxEditor';
<span class='line'>2748</span> 			} else if (sNodeName.indexOf("passwordeditor") != -1) {
<span class='line'>2749</span> 				sEditor = 'EBAPasswordEditor';
<span class='line'>2750</span> 			} else if (sNodeName.indexOf("checkboxeditor") != -1) {
<span class='line'>2751</span> 				sEditor = 'EBACheckboxEditor';
<span class='line'>2752</span> 			}
<span class='line'>2753</span> 
<span class='line'>2754</span> 			this.setModelDefaults(xColumnModel, xEditorNode, "interfaces/interface[@name='"+sEditor+"']/properties/property");
<span class='line'>2755</span> 			this.setModelDefaults(xColumnModel, xEditorNode, "interfaces/interface[@name='"+sEditor+"']/events/event");
<span class='line'>2756</span> 	
<span class='line'>2757</span> 			xColumnModel.setAttribute("type", sNodeName.substring(4,sNodeName.indexOf("editor")).toUpperCase());
<span class='line'>2758</span> 			xColumnModel.setAttribute("editor", sNodeName.substring(4,sNodeName.indexOf("editor")).toUpperCase());
<span class='line'>2759</span> 		}
<span class='line'>2760</span> 	}
<span class='line'>2761</span> 	else
<span class='line'>2762</span> 	{
<span class='line'>2763</span> 		var columnNode = xColumnDeclaration;
<span class='line'>2764</span> 		var sEditor = '';
<span class='line'>2765</span> 		var sNodeName = columnNode.nodeName;
<span class='line'>2766</span> 
<span class='line'>2767</span> 		if (sNodeName.indexOf("numbercolumn")) {
<span class='line'>2768</span> 			sEditor = 'EBANumberEditor';
<span class='line'>2769</span> 		} else if (columnNode.nodeName.indexOf("dateeditor")) {
<span class='line'>2770</span> 			sEditor = 'EBADateEditor';
<span class='line'>2771</span> 		}
<span class='line'>2772</span> 
<span class='line'>2773</span> 		this.setModelDefaults(xColumnModel, columnNode, "interfaces/interface[@name='"+sEditor+"']/properties/property");
<span class='line'>2774</span> 		this.setModelDefaults(xColumnModel, columnNode, "interfaces/interface[@name='"+sEditor+"']/events/event");
<span class='line'>2775</span> 
<span class='line'>2776</span> 		xColumnModel.setAttribute("type", sNodeName.substring(4, sNodeName.indexOf("column")).toUpperCase());
<span class='line'>2777</span> 	}
<span class='line'>2778</span> }
<span class='line'>2779</span> */</span><span class="WHIT">
<span class='line'>2780</span> 
<span class='line'>2781</span> </span><span class="COMM">/**
<span class='line'>2782</span>  * Defines the Grid columns from the information in a nitobi.data.DataTable. This can be used to infer the columns in a grid based on the columns that exist in the DataTable.
<span class='line'>2783</span>  * @private
<span class='line'>2784</span>  */</span><span class="WHIT">
<span class='line'>2785</span> </span><span class="NAME">ntb_gridp.defineColumnsFromData</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">datatable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2786</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2787</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">datatable</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2788</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2789</span> </span><span class="WHIT">		</span><span class="NAME">datatable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2790</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2791</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Explicit XPath statement</span><span class="WHIT">
<span class='line'>2792</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">structureNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">datatable.xmlDoc.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">'//'</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">'datasourcestructure'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2793</span> 
<span class='line'>2794</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">structureNode</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2795</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsCollection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2796</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2797</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">structureNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">'FieldNames'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2798</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">fields.length</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2799</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsCollection</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2800</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2801</span> 
<span class='line'>2802</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">structureNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">'defaults'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2803</span> 
<span class='line'>2804</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsFromString</span><span class="PUNC">(</span><span class="NAME">fields</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2805</span> 
<span class='line'>2806</span> </span><span class="WHIT">	</span><span class="COMM">// Overlay type and width aspects (good place to infer editors)</span><span class="WHIT">
<span class='line'>2807</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">colDefs.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2808</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2809</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">defaults</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">defaults.length</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2810</span> </span><span class="WHIT">			</span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">"initial"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">defaults</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">||</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2811</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2812</span> </span><span class="WHIT">		</span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">setAttribute</span><span class="PUNC">(</span><span class="STRN">"width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">100</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2813</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2814</span> </span><span class="WHIT">	</span><span class="NAME">this.inferredColumns</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2815</span> 
<span class='line'>2816</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2817</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2818</span> 
<span class='line'>2819</span> </span><span class="COMM">/**
<span class='line'>2820</span>  * Defines the Grid columns from a bar ("|") separated list of columns. The string value for each column is used for the label as well as the xdatafld binding property.
<span class='line'>2821</span>  * @private
<span class='line'>2822</span>  */</span><span class="WHIT">
<span class='line'>2823</span> </span><span class="NAME">ntb_gridp.defineColumnsFromString</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2824</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2825</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsFromArray</span><span class="PUNC">(</span><span class="NAME">columns.split</span><span class="PUNC">(</span><span class="STRN">"|"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2826</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2827</span> </span><span class="COMM">/**
<span class='line'>2828</span>  * Defines the Grid columns from an array of either string values or nitobi.components.grid.Column objects. 
<span class='line'>2829</span>  * It will also accept structs with the same field names that are in the nitobi.components.grid.Column class such as name, label, width, columntype, editortype, mask, initial.
<span class='line'>2830</span>  * @private
<span class='line'>2831</span>  */</span><span class="WHIT">
<span class='line'>2832</span> </span><span class="NAME">ntb_gridp.defineColumnsFromArray</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2833</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2834</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columns.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2835</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.defineColumnsCollection</span><span class="PUNC">(</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2836</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cols</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2837</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2838</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2839</span> </span><span class="WHIT">			</span><span class="COMM">// Set the proper name of the column - this is the friendly database field name</span><span class="WHIT">
<span class='line'>2840</span> </span><span class="WHIT">			</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ColumnName"</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2841</span> </span><span class="WHIT">			</span><span class="COMM">// Set the original xdatafld attribute - this just indicates at later stages</span><span class="WHIT">
<span class='line'>2842</span> </span><span class="WHIT">			</span><span class="COMM">// that this column has already had the xdatafld value converted</span><span class="WHIT">
<span class='line'>2843</span> </span><span class="WHIT">			</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld_orig"</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2844</span> </span><span class="WHIT">			</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField_orig"</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2845</span> </span><span class="WHIT">			</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"Label"</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2846</span> </span><span class="WHIT">			</span><span class="COMM">// Now set the xdatafld value to the actual fieldMap value</span><span class="WHIT">
<span class='line'>2847</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2848</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// May have to use fieldMap</span><span class="WHIT">
<span class='line'>2849</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// May have to use fieldMap</span><span class="WHIT">
<span class='line'>2850</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2851</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld"</span><span class="PUNC">,</span><span class="STRN">"unbound"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Hack - should be able to omit - XSL requires a value here</span><span class="WHIT">
<span class='line'>2852</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField"</span><span class="PUNC">,</span><span class="STRN">"unbound"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Hack - should be able to omit - XSL requires a value here</span><span class="WHIT">
<span class='line'>2853</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2854</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2855</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'_xk'</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// ???</span><span class="WHIT">
<span class='line'>2856</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2857</span> </span><span class="WHIT">				</span><span class="COMM">// Set model values to those of the JS Array</span><span class="WHIT">
<span class='line'>2858</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ColumnName"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2859</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld_orig"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2860</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField_orig"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.name</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2861</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2862</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">name</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2863</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"Width"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.width</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2864</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"Label"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.label</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2865</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"Initial"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.initial</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2866</span> </span><span class="WHIT">				</span><span class="NAME">col.setAttribute</span><span class="PUNC">(</span><span class="STRN">"Mask"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col.mask</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2867</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2868</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2869</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2870</span> </span><span class="WHIT">	</span><span class="NAME">this.setColumnCount</span><span class="PUNC">(</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2871</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>2872</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2873</span> 
<span class='line'>2874</span> </span><span class="COMM">/**
<span class='line'>2875</span>  * Binds the columns in the Grid to columns in the connected DataTable. This involves mapping the xdatafld property of each column to the corresponding
<span class='line'>2876</span>  * XPath query in the DataTable for the column with that name.
<span class='line'>2877</span>  * @private
<span class='line'>2878</span>  */</span><span class="WHIT">
<span class='line'>2879</span> </span><span class="NAME">ntb_gridp.defineColumnBindings</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2880</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2881</span> </span><span class="WHIT">	</span><span class="COMM">//	If the columns are defined in the declaration we need to loop through and set</span><span class="WHIT">
<span class='line'>2882</span> </span><span class="WHIT">	</span><span class="COMM">//	the mappings from friendly column names like "ProductName" to @a etc.</span><span class="WHIT">
<span class='line'>2883</span> </span><span class="WHIT">	</span><span class="COMM">//	This can only be done once the data is ready</span><span class="WHIT">
<span class='line'>2884</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.rowXslProc.stylesheet</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2885</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2886</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cols.length</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2887</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2888</span> </span><span class="WHIT">		</span><span class="COMM">//	Keep track of the actual database column name</span><span class="WHIT">
<span class='line'>2889</span> </span><span class="WHIT">		</span><span class="NAME">this.defineColumnBinding</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2890</span> </span><span class="WHIT">		</span><span class="NAME">e.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xi"</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2891</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2892</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.grid.rowXslProc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.createXslProcessor</span><span class="PUNC">(</span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2893</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2894</span> </span><span class="COMM">/**
<span class='line'>2895</span>  * Method to set any special values on column definition for data binding
<span class='line'>2896</span>  * @private
<span class='line'>2897</span>  */</span><span class="WHIT">
<span class='line'>2898</span> </span><span class="NAME">ntb_gridp.defineColumnBinding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2899</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2900</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fieldMap</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2901</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2902</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2903</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2904</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2905</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sFieldNameOrig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld_orig"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2906</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sFieldNameOrig</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">sFieldNameOrig</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2907</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2908</span> </span><span class="WHIT">		</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld_orig"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2909</span> </span><span class="WHIT">		</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField_orig"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2910</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2911</span> </span><span class="WHIT">		</span><span class="COMM">// Now get the original field name and set the column to that once more.</span><span class="WHIT">
<span class='line'>2912</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: Not sure that I need this statement ...</span><span class="WHIT">
<span class='line'>2913</span> </span><span class="WHIT">		</span><span class="NAME">sFieldName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld_orig"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2914</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2915</span> 
<span class='line'>2916</span> </span><span class="WHIT">	</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ColumnName"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sFieldName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2917</span> 
<span class='line'>2918</span> </span><span class="WHIT">	</span><span class="COMM">// Using the FieldName we now lookup the actual xpath from the fieldmap.</span><span class="WHIT">
<span class='line'>2919</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mappedName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">sFieldName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2920</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">mappedName</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2921</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2922</span> </span><span class="WHIT">		</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mappedName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2923</span> </span><span class="WHIT">		</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DataField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mappedName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2924</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2925</span> 
<span class='line'>2926</span> </span><span class="WHIT">	</span><span class="NAME">this.formatBinding</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'CssStyle'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2927</span> </span><span class="WHIT">	</span><span class="NAME">this.formatBinding</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'ClassName'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2928</span> </span><span class="WHIT">	</span><span class="NAME">this.formatBinding</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'Value'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2929</span> 
<span class='line'>2930</span> </span><span class="COMM">//	else</span><span class="WHIT">
<span class='line'>2931</span> </span><span class="COMM">//	{</span><span class="WHIT">
<span class='line'>2932</span> </span><span class="COMM">//		element.setAttribute("xdatafld", 'unbound'); // hack here - it should never be unbound ...</span><span class="WHIT">
<span class='line'>2933</span> </span><span class="COMM">//	}</span><span class="WHIT">
<span class='line'>2934</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2935</span> 
<span class='line'>2936</span> </span><span class="COMM">/**
<span class='line'>2937</span>  * @private
<span class='line'>2938</span>  */</span><span class="WHIT">
<span class='line'>2939</span> </span><span class="NAME">ntb_gridp.formatBinding</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">element</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xslt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2940</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2941</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="NAME">attName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2942</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attValueOrig</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="NAME">attName</span><span class="PUNC">+</span><span class="STRN">"_orig"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2943</span> 
<span class='line'>2944</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2945</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2946</span> 
<span class='line'>2947</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">attValueOrig</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">attValueOrig</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2948</span> </span><span class="WHIT">		</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="NAME">attName</span><span class="PUNC">+</span><span class="STRN">"_orig"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2949</span> 
<span class='line'>2950</span> </span><span class="WHIT">	</span><span class="NAME">attValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">element.getAttribute</span><span class="PUNC">(</span><span class="NAME">attName</span><span class="PUNC">+</span><span class="STRN">"_orig"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2951</span> 
<span class='line'>2952</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">re</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'\\{.[^\}]*}'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'gi'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2953</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">exprMatches</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attValue.match</span><span class="PUNC">(</span><span class="NAME">re</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2954</span> 
<span class='line'>2955</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">exprMatches</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2956</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2957</span> 
<span class='line'>2958</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">exprMatches.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2959</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2960</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origExpr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">exprMatches</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2961</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newExpr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origExpr</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2962</span> 
<span class='line'>2963</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldRegex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">RegExp</span><span class="PUNC">(</span><span class="STRN">'\\$.*?[^0-9a-zA-Z\_]'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'gi'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2964</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldMatches</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newExpr.match</span><span class="PUNC">(</span><span class="NAME">fieldRegex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2965</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">fieldMatches.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>2966</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2967</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldMatch</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fieldMatches</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2968</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fieldExpr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fieldMatch.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fieldMatch.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2969</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fieldExpr.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2970</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">realField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.fieldMap</span><span class="PUNC">[</span><span class="NAME">dataField</span><span class="PUNC">]</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2971</span> </span><span class="COMM">//			if (realField != null) {</span><span class="WHIT">
<span class='line'>2972</span> </span><span class="WHIT">				</span><span class="NAME">newExpr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newExpr.replace</span><span class="PUNC">(</span><span class="NAME">fieldExpr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">realField.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2973</span> </span><span class="COMM">//			} else</span><span class="WHIT">
<span class='line'>2974</span> </span><span class="COMM">//				newExpr = newExpr.replace(fieldExpr, "");</span><span class="WHIT">
<span class='line'>2975</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2976</span> </span><span class="WHIT">		</span><span class="NAME">newExpr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newExpr.substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NAME">newExpr.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2977</span> </span><span class="WHIT">		</span><span class="COMM">//	newExpr = '&lt;xsl:value-of select="'+newExpr.substring(1,newExpr.length-1)+'"/&gt;';</span><span class="WHIT">
<span class='line'>2978</span> </span><span class="WHIT">		</span><span class="NAME">attValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attValue.replace</span><span class="PUNC">(</span><span class="NAME">origExpr</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newExpr</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/\{\}/g</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2979</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2980</span> </span><span class="WHIT">	</span><span class="NAME">element.setAttribute</span><span class="PUNC">(</span><span class="NAME">attName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">attValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2981</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>2982</span> 
<span class='line'>2983</span> 
<span class='line'>2984</span> </span><span class="COMM">/**
<span class='line'>2985</span>  * Defines the default columns based on the number of columns as specified by the cols argument.
<span class='line'>2986</span>  * @private
<span class='line'>2987</span>  * @param {Number} cols The number of columns that are going to be defined.
<span class='line'>2988</span>  */</span><span class="WHIT">
<span class='line'>2989</span> </span><span class="NAME">ntb_gridp.defineColumnsCollection</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>2990</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2991</span> </span><span class="WHIT">	</span><span class="COMM">// Get the existing columns collection</span><span class="WHIT">
<span class='line'>2992</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2993</span> 
<span class='line'>2994</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xDec.childNodes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2995</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultColumnDef</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"/state/Defaults/nitobi.grid.Column"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2996</span> </span><span class="WHIT">	</span><span class="COMM">// All columns are unbound by default (i.e. no xdatafld)</span><span class="WHIT">
<span class='line'>2997</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">cols</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>2998</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">e</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">defaultColumnDef.cloneNode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>2999</span> </span><span class="WHIT">		</span><span class="NAME">xDec.appendChild</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3000</span> </span><span class="WHIT">		</span><span class="NAME">e.setAttribute</span><span class="PUNC">(</span><span class="STRN">"xi"</span><span class="PUNC">,</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3001</span> </span><span class="WHIT">	</span><span class="COMM">//		e.setAttribute("xdatafld","@" +(i>25?String.fromCharCode(Math.floor(i/26)+97):"")+(String.fromCharCode(i%26+97)));</span><span class="WHIT">
<span class='line'>3002</span> </span><span class="WHIT">		</span><span class="NAME">e.setAttribute</span><span class="PUNC">(</span><span class="STRN">"title"</span><span class="PUNC">,</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">></span><span class="NUMB">25</span><span class="PUNC">?</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">/</span><span class="NUMB">26</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">65</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">%</span><span class="NUMB">26</span><span class="PUNC">+</span><span class="NUMB">65</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3003</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3004</span> </span><span class="WHIT">	</span><span class="NAME">this.setColumnCount</span><span class="PUNC">(</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3005</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xDec.selectNodes</span><span class="PUNC">(</span><span class="STRN">"*"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3006</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3007</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3008</span> 
<span class='line'>3009</span> </span><span class="COMM">/**
<span class='line'>3010</span>  * Removes all the column definitions from the Grid.
<span class='line'>3011</span>  * @private
<span class='line'>3012</span>  */</span><span class="WHIT">
<span class='line'>3013</span> </span><span class="NAME">ntb_gridp.resetColumns</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3014</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3015</span> </span><span class="WHIT">	</span><span class="COMM">// Delete existing cols</span><span class="WHIT">
<span class='line'>3016</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeClearColumns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3017</span> </span><span class="WHIT">	</span><span class="NAME">this.inferredColumns</span><span class="PUNC">=</span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3018</span> </span><span class="WHIT">	</span><span class="NAME">this.columnsDefined</span><span class="PUNC">=</span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3019</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Existing</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3020</span> 
<span class='line'>3021</span> </span><span class="WHIT">	</span><span class="COMM">//Create columns based upon #of columns</span><span class="WHIT">
<span class='line'>3022</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xDec</span><span class="PUNC">=</span><span class="NAME">this.model.createElement</span><span class="PUNC">(</span><span class="STRN">"nitobi.grid.Columns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3023</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Existing</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3024</span> </span><span class="WHIT">		</span><span class="NAME">this.model.documentElement.appendChild</span><span class="PUNC">(</span><span class="NAME">xDec</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3025</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3026</span> </span><span class="WHIT">		</span><span class="NAME">this.model.documentElement.replaceChild</span><span class="PUNC">(</span><span class="NAME">xDec</span><span class="PUNC">,</span><span class="NAME">Existing</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3027</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3028</span> </span><span class="WHIT">	</span><span class="NAME">this.setColumnCount</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3029</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterClearColumns"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3030</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3031</span> 
<span class='line'>3032</span> </span><span class="COMM">/**
<span class='line'>3033</span>  * If there are columns defined, renders the header of each column in the Grid.
<span class='line'>3034</span>  * @private
<span class='line'>3035</span>  */</span><span class="WHIT">
<span class='line'>3036</span> </span><span class="NAME">ntb_gridp.renderHeaders</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3037</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3038</span> </span><span class="WHIT">	</span><span class="COMM">// If there are no column definitions then dont even try and render the columns...</span><span class="WHIT">
<span class='line'>3039</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3040</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3041</span> </span><span class="WHIT">		</span><span class="COMM">// Clear the header</span><span class="WHIT">
<span class='line'>3042</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.clearSurfaces</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3043</span> 
<span class='line'>3044</span> </span><span class="WHIT">		</span><span class="COMM">// Top Left Corner</span><span class="WHIT">
<span class='line'>3045</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3046</span> </span><span class="WHIT">		</span><span class="NAME">endRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getfreezetop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3047</span> 
<span class='line'>3048</span> </span><span class="WHIT">		</span><span class="COMM">// Top Left</span><span class="WHIT">
<span class='line'>3049</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.view.topleft</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3050</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: DONT NEED TO SET ELEMENT.INNERHTML = ""</span><span class="WHIT">
<span class='line'>3051</span> </span><span class="WHIT">		</span><span class="COMM">//tl.surface.element.innerHTML="";</span><span class="WHIT">
<span class='line'>3052</span> </span><span class="WHIT">		</span><span class="NAME">tl.top</span><span class="PUNC">=</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3053</span> </span><span class="WHIT">		</span><span class="NAME">tl.left</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3054</span> </span><span class="WHIT">		</span><span class="NAME">tl.renderGap</span><span class="PUNC">(</span><span class="NAME">startRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">'*'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3055</span> 
<span class='line'>3056</span> </span><span class="WHIT">		</span><span class="COMM">// Top Center</span><span class="WHIT">
<span class='line'>3057</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">tc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Scroller.view.topcenter</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3058</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: DONT NEED TO SET ELEMENT.INNERHTML = ""</span><span class="WHIT">
<span class='line'>3059</span> </span><span class="WHIT">		</span><span class="COMM">//tc.surface.element.innerHTML="";</span><span class="WHIT">
<span class='line'>3060</span> </span><span class="WHIT">		</span><span class="NAME">tc.top</span><span class="PUNC">=</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3061</span> </span><span class="WHIT">		</span><span class="NAME">tc.left</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3062</span> </span><span class="WHIT">		</span><span class="NAME">tc.renderGap</span><span class="PUNC">(</span><span class="NAME">startRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3063</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3064</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3065</span> 
<span class='line'>3066</span> </span><span class="COMM">/**
<span class='line'>3067</span>  * @private
<span class='line'>3068</span>  */</span><span class="WHIT">
<span class='line'>3069</span> </span><span class="NAME">ntb_gridp.initializeSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3070</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3071</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Selection</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isDragFillEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3072</span> </span><span class="WHIT">	</span><span class="NAME">sel.setRowHeight</span><span class="PUNC">(</span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3073</span> </span><span class="WHIT">	</span><span class="NAME">sel.onAfterExpand.subscribe</span><span class="PUNC">(</span><span class="NAME">this.afterExpandSelection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3074</span> </span><span class="WHIT">	</span><span class="NAME">sel.onBeforeExpand.subscribe</span><span class="PUNC">(</span><span class="NAME">this.beforeExpandSelection</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3075</span> </span><span class="WHIT">	</span><span class="NAME">sel.onMouseUp.subscribe</span><span class="PUNC">(</span><span class="NAME">this.handleSelectionMouseUp</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3076</span> </span><span class="WHIT">	</span><span class="COMM">// this.Selection is for backwards compat</span><span class="WHIT">
<span class='line'>3077</span> </span><span class="WHIT">	</span><span class="NAME">this.selection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Selection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3078</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3079</span> 
<span class='line'>3080</span> </span><span class="COMM">/**
<span class='line'>3081</span>  * @private
<span class='line'>3082</span>  */</span><span class="WHIT">
<span class='line'>3083</span> </span><span class="NAME">ntb_gridp.beforeExpandSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3084</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3085</span> </span><span class="WHIT">	</span><span class="NAME">this.setExpanding</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3086</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeDragFill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3087</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3088</span> 
<span class='line'>3089</span> </span><span class="COMM">/**
<span class='line'>3090</span>  * @private
<span class='line'>3091</span>  */</span><span class="WHIT">
<span class='line'>3092</span> </span><span class="NAME">ntb_gridp.afterExpandSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3093</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3094</span> </span><span class="WHIT">	</span><span class="COMM">// Get the selection start and end size ...</span><span class="WHIT">
<span class='line'>3095</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3096</span> 
<span class='line'>3097</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.getCoords</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3098</span> 
<span class='line'>3099</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectionTopRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.top.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3100</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectionBottomRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.bottom.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3101</span> 
<span class='line'>3102</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectionLeftColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.top.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3103</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectionRightColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.bottom.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3104</span> 
<span class='line'>3105</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getTableForSelection</span><span class="PUNC">(</span><span class="PUNC">{</span><span class="NAME">top</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">sel.expandStartLeftColumn</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">sel.expandStartTopRow</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="NAME">bottom</span><span class="PUNC">:</span><span class="PUNC">{</span><span class="NAME">x</span><span class="PUNC">:</span><span class="NAME">sel.expandStartRightColumn</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">:</span><span class="NAME">sel.expandStartBottomRow</span><span class="PUNC">}</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3106</span> 
<span class='line'>3107</span> </span><span class="WHIT">	</span><span class="COMM">// Take the data in the start size and repeat it as many times as it can to generate some paste data</span><span class="WHIT">
<span class='line'>3108</span> </span><span class="WHIT">	</span><span class="COMM">// When we have selected up paste the start row we copy the data backwards up ..</span><span class="WHIT">
<span class='line'>3109</span> 
<span class='line'>3110</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pasteClipBoard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getClipboard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3111</span> 
<span class='line'>3112</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.expandingVertical</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3113</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.expandStartBottomRow</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selectionBottomRow</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">selectionTopRow</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">sel.expandStartTopRow</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3114</span> </span><span class="WHIT">			</span><span class="COMM">// This is the case that we are reducing the size of the selection so clear any now unselected cells</span><span class="WHIT">
<span class='line'>3115</span> </span><span class="WHIT">			</span><span class="COMM">// Loop through columns that were initially selected and the rows that are now unselected and clear the values</span><span class="WHIT">
<span class='line'>3116</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">sel.expandStartLeftColumn</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">sel.expandStartRightColumn</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3117</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3118</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">selectionBottomRow</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">sel.expandStartBottomRow</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3119</span> </span><span class="WHIT">					</span><span class="NAME">this.getCellObject</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValue</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3120</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3121</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3122</span> </span><span class="WHIT">			</span><span class="COMM">// Vertical expansion case ... just repeat rows</span><span class="WHIT">
<span class='line'>3123</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandDown</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.expandStartBottomRow</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">selectionBottomRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3124</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandUp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.expandStartTopRow</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selectionTopRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3125</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expandDown</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">expandUp</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3126</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3127</span> </span><span class="WHIT">				</span><span class="COMM">// Strip off the final newline character</span><span class="WHIT">
<span class='line'>3128</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">origData.lastIndexOf</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">origData.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3129</span> </span><span class="WHIT">					</span><span class="NAME">origData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origData.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">origData.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3130</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3131</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sel.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">sel.expandStartHeight</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3132</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">rep</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3133</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origData</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.MOZ</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nitobi.browser.SAFARI</span><span class="PUNC">?</span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3134</span> </span><span class="WHIT">				</span><span class="NAME">origDataArr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origData.split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3135</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mod</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">sel.expandStartHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3136</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3137</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3138</span> 
<span class='line'>3139</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expandDown</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3140</span> </span><span class="WHIT">					</span><span class="COMM">// Remove the extra data from the mod value to the end</span><span class="WHIT">
<span class='line'>3141</span> </span><span class="WHIT">					</span><span class="NAME">origDataArr.splice</span><span class="PUNC">(</span><span class="NAME">mod</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">origDataArr.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mod</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3142</span> </span><span class="WHIT">					</span><span class="COMM">// Concat the original + repeated data with the mod'ed data</span><span class="WHIT">
<span class='line'>3143</span> </span><span class="WHIT">					</span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">origDataArr.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">origDataArr.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">?</span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3144</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3145</span> </span><span class="WHIT">					</span><span class="COMM">// Remove the extra data from the mod value to the end</span><span class="WHIT">
<span class='line'>3146</span> </span><span class="WHIT">					</span><span class="NAME">origDataArr.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">origDataArr.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mod</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3147</span> </span><span class="WHIT">					</span><span class="COMM">// Concat the original + repeated data with the mod'ed data</span><span class="WHIT">
<span class='line'>3148</span> </span><span class="WHIT">					</span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origDataArr.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">origDataArr.length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">?</span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3149</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3150</span> 
<span class='line'>3151</span> </span><span class="COMM">// This is for the case when we are contracting the selection</span><span class="WHIT">
<span class='line'>3152</span> </span><span class="COMM">//				} else {</span><span class="WHIT">
<span class='line'>3153</span> </span><span class="COMM">//					origDataArr = origDataArr.splice(0, mod);</span><span class="WHIT">
<span class='line'>3154</span> </span><span class="COMM">//					val = origDataArr.join("\n") + (origDataArr.length > 0?"\n":"") + data;</span><span class="WHIT">
<span class='line'>3155</span> </span><span class="COMM">//				}</span><span class="WHIT">
<span class='line'>3156</span> </span><span class="WHIT">				</span><span class="NAME">pasteClipBoard.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">val</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3157</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3158</span> </span><span class="WHIT">				</span><span class="NAME">this.pasteDataReady</span><span class="PUNC">(</span><span class="NAME">pasteClipBoard</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3159</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3160</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3161</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3162</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.expandStartRightColumn</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selectionRightColumn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">selectionLeftColumn</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">sel.expandStartLeftColumn</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3163</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3164</span> </span><span class="WHIT">			</span><span class="COMM">// This is the case that we are reducing the size of the selection so clear any now unselected cells</span><span class="WHIT">
<span class='line'>3165</span> </span><span class="WHIT">			</span><span class="COMM">// Loop through rows that were initially selected and the columns that are now unselected and clear the values</span><span class="WHIT">
<span class='line'>3166</span> </span><span class="WHIT">			</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">selectionLeftColumn</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">sel.expandStartRightColumn</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3167</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3168</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NAME">sel.expandStartTopRow</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">sel.expandStartBottomRow</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3169</span> </span><span class="WHIT">					</span><span class="NAME">this.getCellObject</span><span class="PUNC">(</span><span class="NAME">j</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">setValue</span><span class="PUNC">(</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3170</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3171</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3172</span> </span><span class="WHIT">			</span><span class="COMM">// Horizontal expansion case ...</span><span class="WHIT">
<span class='line'>3173</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandRight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.expandStartRightColumn</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">selectionRightColumn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3174</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expandLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">sel.expandStartLeftColumn</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">selectionLeftColumn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3175</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">expand</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expandRight</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">expandLeft</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3176</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3177</span> 
<span class='line'>3178</span> </span><span class="WHIT">				</span><span class="COMM">// Get the number of cells that are being expanded that are a fraction of a repeat block</span><span class="WHIT">
<span class='line'>3179</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">mod</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sel.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">%</span><span class="WHIT"> </span><span class="NAME">sel.expandStartWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3180</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3181</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newline</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.MOZ</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">nitobi.browser.SAFARI</span><span class="PUNC">?</span><span class="STRN">"\n"</span><span class="PUNC">:</span><span class="STRN">"\r\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3182</span> </span><span class="WHIT">				</span><span class="COMM">// Strip off the final newline character</span><span class="WHIT">
<span class='line'>3183</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">origData.lastIndexOf</span><span class="PUNC">(</span><span class="NAME">newline</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">origData.length</span><span class="PUNC">-</span><span class="NAME">newline.length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3184</span> </span><span class="WHIT">					</span><span class="NAME">origData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origData.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">origData.length</span><span class="PUNC">-</span><span class="NAME">newline.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3185</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3186</span> </span><span class="WHIT">				</span><span class="COMM">// Get rid of any \r characters</span><span class="WHIT">
<span class='line'>3187</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origDataArr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origData.replace</span><span class="PUNC">(</span><span class="REGX">/\r/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3188</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="NAME">origDataArr.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3189</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rep</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">Math.floor</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">sel.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">expand</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NAME">sel.expandStartWidth</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3190</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3191</span> </span><span class="WHIT">				</span><span class="COMM">// Iterate over each row in the original data and build the output</span><span class="WHIT">
<span class='line'>3192</span> </span><span class="WHIT">				</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">origDataArr.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3193</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3194</span> </span><span class="WHIT">					</span><span class="COMM">// Now append on any data beyond the end from the mod</span><span class="WHIT">
<span class='line'>3195</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origDataLineArr</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origDataArr</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3196</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3197</span> </span><span class="WHIT">					</span><span class="COMM">// Iterate over the number of times the full selection is repeated</span><span class="WHIT">
<span class='line'>3198</span> </span><span class="WHIT">					</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">&lt;</span><span class="NAME">rep</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3199</span> </span><span class="WHIT">						</span><span class="COMM">// The output data for a row is just the already generated data plus the the original data for that row again.</span><span class="WHIT">
<span class='line'>3200</span> </span><span class="WHIT">						</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">?</span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">:</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">origDataLineArr</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3201</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3202</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3203</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">mod</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3204</span> </span><span class="WHIT">						</span><span class="COMM">// If we are expanding right</span><span class="WHIT">
<span class='line'>3205</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">expandRight</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3206</span> </span><span class="WHIT">							</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">origDataLineArr.splice</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">mod</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3207</span> </span><span class="WHIT">							</span><span class="COMM">// TODO: need to do something special here depending on Left or Right xpand</span><span class="WHIT">
<span class='line'>3208</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3209</span> </span><span class="WHIT">							</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">origDataLineArr.splice</span><span class="PUNC">(</span><span class="NAME">mod</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">origDataLineArr.length</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">mod</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">concat</span><span class="PUNC">(</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3210</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3211</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3212</span> </span><span class="WHIT">					</span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">join</span><span class="PUNC">(</span><span class="STRN">"\t"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3213</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3214</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3215</span> </span><span class="WHIT">				</span><span class="NAME">pasteClipBoard.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.join</span><span class="PUNC">(</span><span class="STRN">"\n"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"\n"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3216</span> </span><span class="WHIT">				</span><span class="NAME">this.pasteDataReady</span><span class="PUNC">(</span><span class="NAME">pasteClipBoard</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3217</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3218</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3219</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3220</span> </span><span class="WHIT">	</span><span class="NAME">this.setExpanding</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3221</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterDragFill"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3222</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: support dragging to a smaller area ...</span><span class="WHIT">
<span class='line'>3223</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3224</span> 
<span class='line'>3225</span> </span><span class="COMM">/**
<span class='line'>3226</span>  * Calculates the height of the rows in the Grid. If the start and end 
<span class='line'>3227</span>  * arguments are defined then it will calculate the height of those rows only.
<span class='line'>3228</span>  * @param {Number} start The zero based start row index.
<span class='line'>3229</span>  * @param {Number} end The end row index.
<span class='line'>3230</span>  * @type Number
<span class='line'>3231</span>  * @private
<span class='line'>3232</span>  */</span><span class="WHIT">
<span class='line'>3233</span> </span><span class="NAME">ntb_gridp.calculateHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3234</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3235</span> </span><span class="WHIT">	</span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">start</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3236</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">numRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDisplayedRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3237</span> </span><span class="WHIT">	</span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">end</span><span class="PUNC">:</span><span class="NAME">numRows</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3238</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">*</span><span class="WHIT"> </span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3239</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3240</span> 
<span class='line'>3241</span> </span><span class="COMM">/**
<span class='line'>3242</span>  * Calculates the width of the columns in the Grid. If the start and end 
<span class='line'>3243</span>  * arguments are defined then it will calculate the width of those columns only.
<span class='line'>3244</span>  * @param {Number} start The zero based start column index.
<span class='line'>3245</span>  * @param {Number} end The end column index.
<span class='line'>3246</span>  * @type Number
<span class='line'>3247</span>  * @private
<span class='line'>3248</span>  */</span><span class="WHIT">
<span class='line'>3249</span> </span><span class="NAME">ntb_gridp.calculateWidth</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">start</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">end</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3250</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3251</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3252</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">colDefs.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3253</span> </span><span class="WHIT">	</span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">start</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3254</span> </span><span class="WHIT">	</span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">end</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">Math.min</span><span class="PUNC">(</span><span class="NAME">end</span><span class="PUNC">,</span><span class="NAME">cols</span><span class="PUNC">)</span><span class="PUNC">:</span><span class="NAME">cols</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3255</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">wT</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3256</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">start</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">end</span><span class="PUNC">;</span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3257</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"Visible"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"1"</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"visible"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"1"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3258</span> </span><span class="WHIT">			</span><span class="NAME">wT</span><span class="PUNC">+</span><span class="PUNC">=</span><span class="NAME">Number</span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"Width"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3259</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3260</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3261</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">wT</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3262</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3263</span> 
<span class='line'>3264</span> </span><span class="COMM">/**
<span class='line'>3265</span>  * Resizes grid to size of container div
<span class='line'>3266</span>  */</span><span class="WHIT">
<span class='line'>3267</span> </span><span class="NAME">ntb_gridp.maximize</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3268</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3269</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: this should probably be parentNode rather than offsetParent?</span><span class="WHIT">
<span class='line'>3270</span> </span><span class="WHIT"> 	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3271</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">off_p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.element.offsetParent</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3272</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3273</span> </span><span class="WHIT">	</span><span class="NAME">x</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">off_p.clientWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3274</span> </span><span class="WHIT">	</span><span class="NAME">y</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">off_p.clientHeight</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3275</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3276</span> </span><span class="WHIT">	</span><span class="NAME">this.resize</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3277</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3278</span> 
<span class='line'>3279</span> </span><span class="COMM">//	Now that we have created the datasource we need to set the ValueField and DisplayFields from the old declaration ... or inline datasource maybe ...</span><span class="WHIT">
<span class='line'>3280</span> </span><span class="COMM">/**
<span class='line'>3281</span>  * Connects column editors to datasources. The datsources can be local (specified with a DatasourceId or JSON array) or remote (specified with a GetHandler).
<span class='line'>3282</span>  * @param {XMLElement} column XML column node from declaration / state.
<span class='line'>3283</span>  * @private
<span class='line'>3284</span>  */</span><span class="WHIT">
<span class='line'>3285</span> </span><span class="NAME">ntb_gridp.editorDataReady</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">column</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3286</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3287</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: all of these sorts of things should be done through an EBA API that checks if the attribute exists first etc.</span><span class="WHIT">
<span class='line'>3288</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayFields</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.getAttribute</span><span class="PUNC">(</span><span class="STRN">'DisplayFields'</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">split</span><span class="PUNC">(</span><span class="STRN">'|'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3289</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.getAttribute</span><span class="PUNC">(</span><span class="STRN">"ValueField"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3290</span> 
<span class='line'>3291</span> </span><span class="WHIT">	</span><span class="COMM">//	Get the datasource for the column we are concerned with.</span><span class="WHIT">
<span class='line'>3292</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataTable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.data.getTable</span><span class="PUNC">(</span><span class="NAME">column.getAttribute</span><span class="PUNC">(</span><span class="STRN">'DatasourceId'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3293</span> 
<span class='line'>3294</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.getAttribute</span><span class="PUNC">(</span><span class="STRN">"Initial"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3295</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">initial</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3296</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3297</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">editorType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column.getAttribute</span><span class="PUNC">(</span><span class="STRN">"type"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3298</span> </span><span class="WHIT">		</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">editorType</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3299</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3300</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"checkbox"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3301</span> </span><span class="WHIT">			</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"listbox"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>3302</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3303</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">valueFieldAtt</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTable.fieldMap</span><span class="PUNC">[</span><span class="NAME">valueField</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3304</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTable.getDataXmlDoc</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3305</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3306</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3307</span> </span><span class="WHIT">					</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"//"</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"e[@"</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">valueFieldAtt</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"='"</span><span class="PUNC">+</span><span class="NAME">initial</span><span class="PUNC">+</span><span class="STRN">"']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3308</span> </span><span class="WHIT">					</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">val</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3309</span> </span><span class="WHIT">					</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3310</span> </span><span class="WHIT">						</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">firstRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"//"</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"e"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3311</span> </span><span class="WHIT">						</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">firstRow</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3312</span> </span><span class="WHIT">						</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3313</span> </span><span class="WHIT">							</span><span class="NAME">initial</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">firstRow.getAttribute</span><span class="PUNC">(</span><span class="NAME">valueFieldAtt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3314</span> </span><span class="WHIT">						</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3315</span> </span><span class="WHIT">					</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3316</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3317</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3318</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3319</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3320</span> </span><span class="WHIT">		</span><span class="NAME">column.setAttribute</span><span class="PUNC">(</span><span class="STRN">"Initial"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">initial</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3321</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>3322</span> 
<span class='line'>3323</span> </span><span class="COMM">//	ntbAssert((displayFields.length != 1 && displayFields[0] != ''), 'There is no display field defined for a column of type lookup or listbox');</span><span class="WHIT">
<span class='line'>3324</span> 
<span class='line'>3325</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">displayFields.length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">displayFields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3326</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3327</span> </span><span class="WHIT">		</span><span class="COMM">//	This just gets the first item in the fieldMap hash if the displayFields have not been defined</span><span class="WHIT">
<span class='line'>3328</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">dataTable.fieldMap</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3329</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3330</span> </span><span class="WHIT">			</span><span class="NAME">displayFields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTable.fieldMap</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3331</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3332</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3333</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3334</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3335</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3336</span> </span><span class="WHIT">		</span><span class="COMM">//	Need to loop through the display fields to convert them to eba type attribute values</span><span class="WHIT">
<span class='line'>3337</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">displayFields.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3338</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3339</span> </span><span class="WHIT">			</span><span class="NAME">displayFields</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTable.fieldMap</span><span class="PUNC">[</span><span class="NAME">displayFields</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3340</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3341</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3342</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">displayFieldsString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">displayFields.join</span><span class="PUNC">(</span><span class="STRN">'|'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3343</span> 
<span class='line'>3344</span> </span><span class="COMM">//	ntbAssert((valueField != null && valueField != ''), 'There is no value field defined for a column of type lookup or listbox');</span><span class="WHIT">
<span class='line'>3345</span> 
<span class='line'>3346</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3347</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3348</span> </span><span class="WHIT">		</span><span class="COMM">//	Since there is no sign of the valueField then just set it the same as the displayField</span><span class="WHIT">
<span class='line'>3349</span> </span><span class="WHIT">		</span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">displayFields</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3350</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3351</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3352</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3353</span> </span><span class="WHIT">		</span><span class="NAME">valueField</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTable.fieldMap</span><span class="PUNC">[</span><span class="NAME">valueField</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">substring</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3354</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3355</span> 
<span class='line'>3356</span> </span><span class="WHIT">	</span><span class="NAME">column.setAttribute</span><span class="PUNC">(</span><span class="STRN">"DisplayFields"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">displayFieldsString</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3357</span> </span><span class="WHIT">	</span><span class="NAME">column.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ValueField"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">valueField</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3358</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3359</span> </span><span class="COMM">/*
<span class='line'>3360</span> ntb_gridp.calcForumlas = function(cell)
<span class='line'>3361</span> {
<span class='line'>3362</span> 	//	Now we need to re-calculate all the formulas for this row ...
<span class='line'>3363</span> 	var cols = this.columns;
<span class='line'>3364</span> 	var len = cols.length;
<span class='line'>3365</span> 
<span class='line'>3366</span> 	//	Loop through each column and see if it is of type formula ... if so we need to re-calc it
<span class='line'>3367</span> 	for (var i=0; i&lt;len; i++)
<span class='line'>3368</span> 	{
<span class='line'>3369</span> 		if (cols[i].type == "FORMULA")
<span class='line'>3370</span> 		{
<span class='line'>3371</span> 			//	re-calculate the formula ...
<span class='line'>3372</span> 			var f = cols[i].xdatafld;
<span class='line'>3373</span> 			var re = /$\{(.*?)\}/gi;
<span class='line'>3374</span> 			var reBG = f.match(re);
<span class='line'>3375</span> 			if (reBG != null)
<span class='line'>3376</span> 			{
<span class='line'>3377</span> 				var BGL = reBG.length;
<span class='line'>3378</span> 				for (var j=0; j&lt;BGL; j++)
<span class='line'>3379</span> 				{
<span class='line'>3380</span> 					var curfld = reBG[j].replace(re,"$1");
<span class='line'>3381</span> 					var stp = 'this.GetXMLDataField("'+curfld+'", '+curRow+')';
<span class='line'>3382</span> 					f = f.replace(reBG[j],stp);
<span class='line'>3383</span> 				}
<span class='line'>3384</span> 
<span class='line'>3385</span> 				var newValue = eval(f)*1;
<span class='line'>3386</span> 				var val=0;
<span class='line'>3387</span> 
<span class='line'>3388</span> 				if (_getBoolean(cols[i].showSummary))
<span class='line'>3389</span> 				{
<span class='line'>3390</span> 					var msk = cols[i].mask || '###,##0.00';
<span class='line'>3391</span> 					var sumCell = document.getElementById(i + '_Column_Sum' + this.element.uniqueID);
<span class='line'>3392</span> 
<span class='line'>3393</span> 					//	Get the old cell value
<span class='line'>3394</span> 					var cellPrevValue = this.getCellValue(curRow, i);
<span class='line'>3395</span> 					//	Get the old summary value
<span class='line'>3396</span> 					var colPrevSummary = maskedToNumber(sumCell.innerText, this.decimalSeparator);
<span class='line'>3397</span> 
<span class='line'>3398</span> 					val = formatNumber(colPrevSummary - cellPrevValue + newValue, msk, this.decimalSeparator, this.groupingSeparator);
<span class='line'>3399</span> 					if (val=="false") continue;
<span class='line'>3400</span> 					//	Set the new summary value
<span class='line'>3401</span> 					sumCell.innerHTML = val;
<span class='line'>3402</span> 				}
<span class='line'>3403</span> 
<span class='line'>3404</span> 				val = formatNumber(newValue, msk, this.decimalSeparator, this.groupingSeparator);
<span class='line'>3405</span> 
<span class='line'>3406</span> 				//	Set this flag so that setCell will not attempt to call calcFormulas again and create a loop ...
<span class='line'>3407</span> 				cell.calculate = false;
<span class='line'>3408</span> 				cell.setValue(val);
<span class='line'>3409</span> 				cell.calculate = false;
<span class='line'>3410</span> 			}
<span class='line'>3411</span> 		}
<span class='line'>3412</span> 	}
<span class='line'>3413</span> }
<span class='line'>3414</span> 
<span class='line'>3415</span> 
<span class='line'>3416</span> /// &lt;function name="calcSummary" access="private">
<span class='line'>3417</span> /// &lt;summary>Calculates the summary values for any FORMULA and NUMBER columns.&lt;/summary>
<span class='line'>3418</span> /// &lt;/function>
<span class='line'>3419</span> function _gridlist.prototype.calcSummary()
<span class='line'>3420</span> {
<span class='line'>3421</span> 	var uniqueID = this.element.uniqueID;
<span class='line'>3422</span> 	var cols = this.columns;
<span class='line'>3423</span> 	var clen = cols.length;
<span class='line'>3424</span> 
<span class='line'>3425</span> 	var iRows = this.rowCount();
<span class='line'>3426</span> 
<span class='line'>3427</span> 	var oRows = document.getElementById("rows"+uniqueID);
<span class='line'>3428</span> 	var oFreezeRows = document.getElementById("freezerows"+uniqueID);
<span class='line'>3429</span> 
<span class='line'>3430</span> 	//	This is for summary rows on formula columns that cannot be calculated in the xsl
<span class='line'>3431</span> 	for (var m=0; m&lt;clen; m++)
<span class='line'>3432</span> 	{
<span class='line'>3433</span> 		if (cols[m].type == "FORMULA" || cols[m].type == "NUMBER")
<span class='line'>3434</span> 		{
<span class='line'>3435</span> 			//	bSummary tells if we are showing the summary for THIS column or not
<span class='line'>3436</span> 			var bSummary = _getBoolean(cols[m].showSummary);
<span class='line'>3437</span> 			var curfld = cols[m].xdatafld;
<span class='line'>3438</span> 			var sum = 0;
<span class='line'>3439</span> 			var oCell = null;
<span class='line'>3440</span> 
<span class='line'>3441</span> 			for (var i=0; i&lt;iRows; i++)
<span class='line'>3442</span> 			{
<span class='line'>3443</span> 				var xVal = this.getCellValue(i,m);
<span class='line'>3444</span> 
<span class='line'>3445</span> 				//	First we need to do a data update for the formula columns so that the values will be in the xml
<span class='line'>3446</span> 				if (cols[m].type == "FORMULA")
<span class='line'>3447</span> 				{
<span class='line'>3448</span> 					var xslfld = this.fieldmap[curfld]+"";
<span class='line'>3449</span> 					if (xVal != null && !gEsc) 
<span class='line'>3450</span> 					{
<span class='line'>3451</span> 						var xk = this.getKey(i);
<span class='line'>3452</span> 						xNode = this.oXML.documentElement.selectSingleNode("*[@xk = '"+xk+"']");
<span class='line'>3453</span> 						if (xNode != null) {
<span class='line'>3454</span> 							xVal = maskedToNumber(xVal, this.decimalSeparator)+"";
<span class='line'>3455</span> 							xNode.setAttribute(xslfld.substr(1),xVal);
<span class='line'>3456</span> 						}
<span class='line'>3457</span> 					}
<span class='line'>3458</span> 				}
<span class='line'>3459</span> 
<span class='line'>3460</span> 				//	Then we sum the values if we are in a summary column
<span class='line'>3461</span> 				if (bSummary)
<span class='line'>3462</span> 					sum += xVal*1;
<span class='line'>3463</span> 			}
<span class='line'>3464</span> 
<span class='line'>3465</span> 			//	Also need to set the summary cell for this column as the sum value ...
<span class='line'>3466</span> 			if (bSummary)
<span class='line'>3467</span> 			{
<span class='line'>3468</span> 				var msk = cols[m].mask || '###,##0.00';
<span class='line'>3469</span> 				var val = formatNumber(sum, msk, this.decimalSeparator, this.groupingSeparator);
<span class='line'>3470</span> 
<span class='line'>3471</span> 				if (val=="false") return;
<span class='line'>3472</span> 
<span class='line'>3473</span> 				//	Get a handle to the summary cell for the current column
<span class='line'>3474</span> 				var sumCell = document.getElementById(m + '_Column_Sum' + uniqueID);
<span class='line'>3475</span> 				sumCell.innerHTML = val;
<span class='line'>3476</span> 			}
<span class='line'>3477</span> 		}
<span class='line'>3478</span> 	}
<span class='line'>3479</span> }
<span class='line'>3480</span> */</span><span class="WHIT">
<span class='line'>3481</span> 
<span class='line'>3482</span> </span><span class="COMM">/**
<span class='line'>3483</span>  * Handles clicks on the header by the user.
<span class='line'>3484</span>  * @param {Number} nColumn The header number clicked on.
<span class='line'>3485</span>  * @private
<span class='line'>3486</span>  */</span><span class="WHIT">
<span class='line'>3487</span> </span><span class="NAME">ntb_gridp.headerClicked</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nColumn</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3488</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3489</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">nColumn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3490</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerClickEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnHeaderClickEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3491</span> 
<span class='line'>3492</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: here is not actually a headerclick even on the Grid itself ...</span><span class="WHIT">
<span class='line'>3493</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HeaderClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">headerClickEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">column.getOnHeaderClickEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">headerClickEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3494</span> 
<span class='line'>3495</span> </span><span class="WHIT">	</span><span class="NAME">this.sort</span><span class="PUNC">(</span><span class="NAME">nColumn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3496</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3497</span> 
<span class='line'>3498</span> </span><span class="COMM">/**
<span class='line'>3499</span>  * Adds a filter to apply to the Grid data. A filter consits of a field, comparator, and value that can be used
<span class='line'>3500</span>  * to reduce the set of data rendered in the Grid. By default there are no filters applied.
<span class='line'>3501</span>  * @private
<span class='line'>3502</span>  */</span><span class="WHIT">
<span class='line'>3503</span> </span><span class="NAME">ntb_gridp.addFilter</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3504</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3505</span> </span><span class="WHIT">	</span><span class="NAME">this.dataTable.addFilter</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3506</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3507</span> </span><span class="COMM">/**
<span class='line'>3508</span>  * Clears exisitng filters on the grid data.
<span class='line'>3509</span>  * @private
<span class='line'>3510</span>  */</span><span class="WHIT">
<span class='line'>3511</span> </span><span class="NAME">ntb_gridp.clearFilter</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3512</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3513</span> </span><span class="WHIT">	</span><span class="NAME">this.dataTable.clearFilter</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3514</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3515</span> 
<span class='line'>3516</span> </span><span class="COMM">/**
<span class='line'>3517</span>  * Sets the sort style on the sorted column or clears the currently sorted column style.
<span class='line'>3518</span>  * @private
<span class='line'>3519</span>  */</span><span class="WHIT">
<span class='line'>3520</span> </span><span class="NAME">ntb_gridp.setSortStyle</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">sortDir</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">unset</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3521</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3522</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3523</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">unset</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3524</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3525</span> </span><span class="WHIT">		</span><span class="NAME">this.sortColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3526</span> </span><span class="WHIT">		</span><span class="NAME">this.sortColumnCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3527</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.setSort</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3528</span> </span><span class="WHIT">		</span><span class="NAME">this.setColumnSortOrder</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3529</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3530</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3531</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3532</span> </span><span class="WHIT">		</span><span class="COMM">//	Set the sort direction on the header and assign the current sorted column properties of the Grid</span><span class="WHIT">
<span class='line'>3533</span> </span><span class="WHIT">		</span><span class="NAME">headerColumn.setSortDirection</span><span class="PUNC">(</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3534</span> </span><span class="WHIT">		</span><span class="NAME">this.setColumnSortOrder</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3535</span> </span><span class="WHIT">		</span><span class="NAME">this.sortColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3536</span> </span><span class="WHIT">		</span><span class="NAME">this.sortColumnCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn.getHeaderElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3537</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.setSort</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3538</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3539</span> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3540</span> 
<span class='line'>3541</span> </span><span class="COMM">/**
<span class='line'>3542</span>  * Re-sorts the grid data by the specified column.
<span class='line'>3543</span>  * By default the data is sorted in ascending order first. When sort is 
<span class='line'>3544</span>  * called on a column a second time, the data is sorted in descending 
<span class='line'>3545</span>  * order. Column sorting is alphabetical unless the data type for the 
<span class='line'>3546</span>  * column is NUMBER or DATE.
<span class='line'>3547</span>  * &lt;p>
<span class='line'>3548</span>  * &lt;b>Example&lt;/b>
<span class='line'>3549</span>  * &lt;/p>
<span class='line'>3550</span>  * &lt;div class="code">
<span class='line'>3551</span>  * &lt;pre>&lt;code class="">
<span class='line'>3552</span>  * &lt;a href="javascript:nitobi.getComponent('grid1').sort(0, 'Asc')"&gt;Sort First Column&lt;/a&gt;
<span class='line'>3553</span>  * &lt;/code>&lt;/pre>
<span class='line'>3554</span>  * &lt;/div>
<span class='line'>3555</span>  * @param {Number} sortCol The index of the column to sort on, starting at 0.
<span class='line'>3556</span>  * @param {String} sortDir The direction to sort the column by. Values are "Asc" and "Desc".
<span class='line'>3557</span>  */</span><span class="WHIT">
<span class='line'>3558</span> </span><span class="NAME">ntb_gridp.sort</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3559</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3560</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"undefined"</span><span class="PUNC">,</span><span class="STRN">"No column to sort."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3561</span> 
<span class='line'>3562</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3563</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">headerColumn</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">headerColumn.isSortEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isSortEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3564</span> 
<span class='line'>3565</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeSortEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeSortEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3566</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeSort"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">beforeSortEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">headerColumn.getOnBeforeSortEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">beforeSortEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3567</span> 
<span class='line'>3568</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sortDir</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3569</span> </span><span class="WHIT">		</span><span class="NAME">sortDir</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">headerColumn.getSortDirection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"Asc"</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"Desc"</span><span class="PUNC">:</span><span class="STRN">"Asc"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3570</span> 
<span class='line'>3571</span> </span><span class="WHIT">	</span><span class="NAME">this.setSortStyle</span><span class="PUNC">(</span><span class="NAME">sortCol</span><span class="PUNC">,</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3572</span> 
<span class='line'>3573</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn.getColumnName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3574</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn.getDataType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3575</span> 
<span class='line'>3576</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">sortLocal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSortMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'local'</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDataMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">'local'</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.getSortMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">'remote'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3577</span> </span><span class="WHIT">	</span><span class="NAME">this.datatable.sort</span><span class="PUNC">(</span><span class="NAME">colName</span><span class="PUNC">,</span><span class="NAME">sortDir</span><span class="PUNC">,</span><span class="NAME">dataType</span><span class="PUNC">,</span><span class="NAME">sortLocal</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3578</span> 
<span class='line'>3579</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sortLocal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3580</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.flush</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3581</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3582</span> 
<span class='line'>3583</span> </span><span class="WHIT">	</span><span class="NAME">this.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3584</span> 
<span class='line'>3585</span> </span><span class="WHIT">	</span><span class="COMM">// Scrollvertical actually causes a render to take place ...</span><span class="WHIT">
<span class='line'>3586</span> </span><span class="WHIT">	</span><span class="NAME">this.scrollVertical</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3587</span> 
<span class='line'>3588</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Obviously belongs in the subclass.</span><span class="WHIT">
<span class='line'>3589</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">sortLocal</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3590</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3591</span> </span><span class="WHIT">		</span><span class="NAME">this.loadDataPage</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3592</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3593</span> 
<span class='line'>3594</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Reselect Row or at least just select SOME row!</span><span class="WHIT">
<span class='line'>3595</span> 
<span class='line'>3596</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.handleAfterSort</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">headerColumn</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3597</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3598</span> 
<span class='line'>3599</span> </span><span class="COMM">/**
<span class='line'>3600</span>  * Event handler that is fired after the data in the Grid is sorted. Fires the &lt;code>AfterSort&lt;/code> event.
<span class='line'>3601</span>  * @param {nitobi.grid.Column} headerColumn The column that was sorted.
<span class='line'>3602</span>  * @private
<span class='line'>3603</span>  */</span><span class="WHIT">
<span class='line'>3604</span> </span><span class="NAME">ntb_gridp.handleAfterSort</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">headerColumn</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3605</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3606</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">afterSortEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnAfterSortEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3607</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterSort"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">afterSortEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3608</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">headerColumn.getOnAfterSortEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">afterSortEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3609</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3610</span> </span><span class="COMM">/**
<span class='line'>3611</span>  * Handles double click events on cells. Fires the &lt;code>CellDblClick&lt;/code> event
<span class='line'>3612</span>  * @param {Event} evt The Event object.
<span class='line'>3613</span>  * @private
<span class='line'>3614</span>  */</span><span class="WHIT">
<span class='line'>3615</span> </span><span class="NAME">ntb_gridp.handleDblClick</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3616</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3617</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: pass the cell that was clicked on ... </span><span class="WHIT">
<span class='line'>3618</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeCellObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3619</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3620</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dblClickEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCellDblClickEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3621</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CellDblClick"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dblClickEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">col.getOnCellDblClickEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">dblClickEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3622</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3623</span> </span><span class="COMM">/**
<span class='line'>3624</span>  * Clears the data from the connected DataTable if the DataMode is not local.
<span class='line'>3625</span>  * This is used in server side data sources (LiveScrolling and Standard paging)
<span class='line'>3626</span>  * to cause a re-GET of the data from the server. 
<span class='line'>3627</span>  * @private
<span class='line'>3628</span>  */</span><span class="WHIT">
<span class='line'>3629</span> </span><span class="NAME">ntb_gridp.clearData</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3630</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3631</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.getDataMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"local"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3632</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3633</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.flush</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3634</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3635</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3636</span> </span><span class="COMM">/**
<span class='line'>3637</span>  * Clears the sort CSS styling of the currently sorted column in the Grid.
<span class='line'>3638</span>  * @private
<span class='line'>3639</span>  */</span><span class="WHIT">
<span class='line'>3640</span> </span><span class="NAME">ntb_gridp.clearColumnHeaderSortOrder</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3641</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3642</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.sortColumn</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3643</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.sortColumn</span><span class="PUNC">;</span><span class="COMM">//this.getColumnObject(this.sortColumn);</span><span class="WHIT">
<span class='line'>3644</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn.getHeaderElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3645</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">css</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerCell.className</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3646</span> </span><span class="WHIT">		</span><span class="NAME">css</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">css.replace</span><span class="PUNC">(</span><span class="REGX">/ascending/gi</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">replace</span><span class="PUNC">(</span><span class="REGX">/descending/gi</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3647</span> </span><span class="WHIT">		</span><span class="NAME">headerCell.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">css</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3648</span> </span><span class="WHIT">		</span><span class="NAME">this.sortColumn</span><span class="PUNC">=</span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3649</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3650</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3651</span> 
<span class='line'>3652</span> </span><span class="COMM">/**
<span class='line'>3653</span>  * Sets the CSS styling of the column at colIndex in the direction specified by sortDir.
<span class='line'>3654</span>  * @param {Number} colIndex
<span class='line'>3655</span>  * @param {String} sortDir
<span class='line'>3656</span>  * @private
<span class='line'>3657</span>  */</span><span class="WHIT">
<span class='line'>3658</span> </span><span class="NAME">ntb_gridp.setColumnSortOrder</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">colIndex</span><span class="PUNC">,</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3659</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3660</span> </span><span class="WHIT">	</span><span class="NAME">this.clearColumnHeaderSortOrder</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3661</span> 
<span class='line'>3662</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: This does not need to be called in the case of sorting on the server</span><span class="WHIT">
<span class='line'>3663</span> </span><span class="WHIT">	</span><span class="COMM">//	since the entire grid is refiltered and the sort column stuff gets rendered in the XSLT</span><span class="WHIT">
<span class='line'>3664</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">colIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3665</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">headerCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn.getHeaderElement</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3666</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">C</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3667</span> 
<span class='line'>3668</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">css</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerCell.className</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3669</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sortDir</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3670</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3671</span> </span><span class="WHIT">		</span><span class="COMM">// If sortDir is nothing then just clear out the class</span><span class="WHIT">
<span class='line'>3672</span> </span><span class="WHIT">		</span><span class="COMM">//C.removeClass(headerCell, ["ntb-ascending", "ntb-descending"], true);</span><span class="WHIT">
<span class='line'>3673</span> </span><span class="WHIT">		</span><span class="NAME">headerCell.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">css.replace</span><span class="PUNC">(</span><span class="REGX">/(ntb-column-indicator-border)(.*?)(\s|$)/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">" ntb-column-indicator-border"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3674</span> </span><span class="WHIT">		</span><span class="NAME">sortDir</span><span class="PUNC">=</span><span class="STRN">"Desc"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3675</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3676</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3677</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3678</span> </span><span class="WHIT">		</span><span class="COMM">//var clazz = (sortDir=="Desc" ? "ntb-descending" : "ntb-ascending");</span><span class="WHIT">
<span class='line'>3679</span> </span><span class="WHIT">		</span><span class="COMM">//C.addClass(headerCell, clazz, true);</span><span class="WHIT">
<span class='line'>3680</span> </span><span class="WHIT">		</span><span class="NAME">headerCell.className</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">css.replace</span><span class="PUNC">(</span><span class="REGX">/(ntb-column-indicator-border)(.*?)(\s|$)/g</span><span class="PUNC">,</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">m</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3681</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3682</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">repl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">sortDir</span><span class="PUNC">==</span><span class="STRN">"Desc"</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="STRN">"descending"</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="STRN">"ascending"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3683</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">m.indexOf</span><span class="PUNC">(</span><span class="STRN">"hover"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">m.replace</span><span class="PUNC">(</span><span class="STRN">"hover"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">repl</span><span class="PUNC">+</span><span class="STRN">"hover"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">m</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">repl</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3684</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3685</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3686</span> 
<span class='line'>3687</span> </span><span class="WHIT">	</span><span class="NAME">headerColumn.setSortDirection</span><span class="PUNC">(</span><span class="NAME">sortDir</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3688</span> 
<span class='line'>3689</span> </span><span class="WHIT">	</span><span class="NAME">this.sortColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerColumn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3690</span> </span><span class="WHIT">	</span><span class="NAME">this.sortColumnCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">headerCell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3691</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3692</span> 
<span class='line'>3693</span> </span><span class="COMM">/**
<span class='line'>3694</span>  * @private
<span class='line'>3695</span>  */</span><span class="WHIT">
<span class='line'>3696</span> </span><span class="NAME">ntb_gridp.initializeState</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3697</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3698</span> 
<span class='line'>3699</span> </span><span class="COMM">/**
<span class='line'>3700</span>  * @private
<span class='line'>3701</span>  */</span><span class="WHIT">
<span class='line'>3702</span> </span><span class="NAME">ntb_gridp.mapToHtml</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3703</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3704</span> </span><span class="WHIT">	</span><span class="COMM">// Put all DOM node reference mapping here (if possible)</span><span class="WHIT">
<span class='line'>3705</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3706</span> </span><span class="WHIT">		</span><span class="NAME">oNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.UiContainer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3707</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3708</span> </span><span class="WHIT">	</span><span class="NAME">this.Scroller.mapToHtml</span><span class="PUNC">(</span><span class="NAME">oNode</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3709</span> 
<span class='line'>3710</span> </span><span class="WHIT">	</span><span class="NAME">this.element</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"grid"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3711</span> </span><span class="WHIT">	</span><span class="NAME">this.element.jsObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3712</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3713</span> 
<span class='line'>3714</span> </span><span class="COMM">/**
<span class='line'>3715</span>  * Generates the component CSS based on the current state of the component. 
<span class='line'>3716</span>  * This can be important to do such that changes to layout properties 
<span class='line'>3717</span>  * (such as positioning and sizing) take effect.
<span class='line'>3718</span>  * &lt;p>
<span class='line'>3719</span>  * &lt;b>Example:&lt;/b>  Dynamically resize the Grid
<span class='line'>3720</span>  * &lt;/p>
<span class='line'>3721</span>  * &lt;div class="code">
<span class='line'>3722</span>  * &lt;pre>&lt;code class="">
<span class='line'>3723</span>  * &#102;unction resizeGrid(width, height)
<span class='line'>3724</span>  * {
<span class='line'>3725</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>3726</span>  * 	grid.setWidth(width);
<span class='line'>3727</span>  * 	grid.setHeight(height);
<span class='line'>3728</span>  * 	grid.generateCss();
<span class='line'>3729</span>  * }
<span class='line'>3730</span>  * &lt;/code>&lt;/pre>
<span class='line'>3731</span>  * &lt;/div>
<span class='line'>3732</span>  * @see #setWidth
<span class='line'>3733</span>  * @see #setHeight
<span class='line'>3734</span>  * @private
<span class='line'>3735</span>  */</span><span class="WHIT">
<span class='line'>3736</span> </span><span class="NAME">ntb_gridp.generateCss</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3737</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3738</span> </span><span class="WHIT">	</span><span class="NAME">this.generateFrameCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3739</span> </span><span class="COMM">//	this.generateColumnCss();</span><span class="WHIT">
<span class='line'>3740</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3741</span> 
<span class='line'>3742</span> </span><span class="COMM">/**
<span class='line'>3743</span>  * @private
<span class='line'>3744</span>  */</span><span class="WHIT">
<span class='line'>3745</span> </span><span class="NAME">ntb_gridp.generateColumnCss</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3746</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3747</span> </span><span class="WHIT">	</span><span class="NAME">this.generateCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Remove this once the real generateColumnCss code has been written</span><span class="WHIT">
<span class='line'>3748</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3749</span> 
<span class='line'>3750</span> </span><span class="COMM">/**
<span class='line'>3751</span>  * @private
<span class='line'>3752</span>  */</span><span class="WHIT">
<span class='line'>3753</span> </span><span class="NAME">ntb_gridp.generateFrameCss</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3754</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3755</span> </span><span class="WHIT">	</span><span class="COMM">// Simple caching of the Model XML so that we don't gen CSS too often</span><span class="WHIT">
<span class='line'>3756</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">oldModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.serialize</span><span class="PUNC">(</span><span class="NAME">this.model</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3757</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.oldModel</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">oldModel</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3758</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3759</span> </span><span class="WHIT">	</span><span class="NAME">this.oldModel</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.serialize</span><span class="PUNC">(</span><span class="NAME">this.model</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3760</span> 
<span class='line'>3761</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">document.compatMode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"CSS1Compat"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3762</span> </span><span class="WHIT">		</span><span class="NAME">this.frameCssXslProc.addParameter</span><span class="PUNC">(</span><span class="STRN">"IE"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"true"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3763</span> 
<span class='line'>3764</span> </span><span class="WHIT">	</span><span class="COMM">// Extended the HTMLStyleElement object to have the cssText property</span><span class="WHIT">
<span class='line'>3765</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newCss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.transformToString</span><span class="PUNC">(</span><span class="NAME">this.model</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.frameCssXslProc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3766</span> 
<span class='line'>3767</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.browser.SAFARI</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.stylesheet</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3768</span> </span><span class="WHIT">		</span><span class="NAME">this.stylesheet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css.createStyleSheet</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3769</span> 
<span class='line'>3770</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getScrollSurface</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">// Viewport. (id= gridviewport*)</span><span class="WHIT">
<span class='line'>3771</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3772</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3773</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3774</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3775</span> </span><span class="WHIT">		</span><span class="NAME">scrollTop</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ss.scrollTop</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3776</span> </span><span class="WHIT">		</span><span class="NAME">scrollLeft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ss.scrollLeft</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3777</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3778</span> 
<span class='line'>3779</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.oldFrameCss</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">newCss</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3780</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3781</span> </span><span class="WHIT">		</span><span class="NAME">this.oldFrameCss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newCss</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3782</span> 
<span class='line'>3783</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.SAFARI</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3784</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3785</span> </span><span class="WHIT">			</span><span class="NAME">this.generateFrameCssSafari</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3786</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3787</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>3788</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3789</span> </span><span class="WHIT">			</span><span class="COMM">// TODO: Figure out why it crashes here with multiple grids in IE 6</span><span class="WHIT">
<span class='line'>3790</span> </span><span class="WHIT">			</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3791</span> </span><span class="WHIT">				</span><span class="NAME">this.stylesheet.cssText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newCss</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3792</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3793</span> 
<span class='line'>3794</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3795</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3796</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.MOZ</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3797</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3798</span> </span><span class="WHIT">					</span><span class="COMM">// TODO: figure out what the problem is here...</span><span class="WHIT">
<span class='line'>3799</span> </span><span class="WHIT">					</span><span class="COMM">// When in Moz, the scrollbar moves to the top in live scrolling leaping ...</span><span class="WHIT">
<span class='line'>3800</span> </span><span class="WHIT">					</span><span class="NAME">this.scrollVerticalRelative</span><span class="PUNC">(</span><span class="NAME">scrollTop</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3801</span> </span><span class="WHIT">					</span><span class="NAME">this.scrollHorizontalRelative</span><span class="PUNC">(</span><span class="NAME">scrollLeft</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3802</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3803</span> </span><span class="WHIT">				</span><span class="NAME">ss.style.top</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0px'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3804</span> </span><span class="WHIT">				</span><span class="NAME">ss.style.left</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'0px'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3805</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3806</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3807</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3808</span> 
<span class='line'>3809</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: refactor this code.</span><span class="WHIT">
<span class='line'>3810</span> </span><span class="WHIT">	</span><span class="COMM">// grabbed from grid 3.1 to make rowhover work ...</span><span class="WHIT">
<span class='line'>3811</span> 
<span class='line'>3812</span> 
<span class='line'>3813</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3814</span> 
<span class='line'>3815</span> </span><span class="NAME">ntb_gridp.generateFrameCssSafari</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3816</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3817</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: This needs to be one way in all browsers. I think we can do the normal XSLT way in Safari.</span><span class="WHIT">
<span class='line'>3818</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ss</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.styleSheets</span><span class="PUNC">[</span><span class="NUMB">0</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3819</span> 
<span class='line'>3820</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">u</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.uid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3821</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">t</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getTheme</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3822</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3823</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3824</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">showvscroll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isVScrollbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3825</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">showhscroll</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isHScrollbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3826</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">showtoolbar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isToolbarEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3827</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">frozenColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.calculateWidth</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3828</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">unfrozenColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.calculateWidth</span><span class="PUNC">(</span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3829</span> 
<span class='line'>3830</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">totalColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">frozenColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">unfrozenColumnsWidth</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3831</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollerHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="PUNC">-</span><span class="NAME">this.getscrollbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">showhscroll</span><span class="PUNC">-</span><span class="NAME">this.getToolbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">showtoolbar</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3832</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">scrollerWidth</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">-</span><span class="NAME">this.getscrollbarWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">showvscroll</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3833</span> 
<span class='line'>3834</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">midHeight</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">scrollerHeight</span><span class="PUNC">-</span><span class="NAME">this.gettop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3835</span> 
<span class='line'>3836</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">addRule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html.Css.addRule</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3837</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">p</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"ntb-grid-"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3838</span> 
<span class='line'>3839</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.rules</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3840</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3841</span> </span><span class="WHIT">		</span><span class="NAME">this.rules</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3842</span> 
<span class='line'>3843</span> </span><span class="WHIT">		</span><span class="COMM">// Static private styles - only set them once and no need to store them for later.</span><span class="WHIT">
<span class='line'>3844</span> </span><span class="WHIT">		</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">".ntb-grid-datablock"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-datablock"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"table-layout:fixed;width:100%;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3845</span> </span><span class="WHIT">		</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">".ntb-grid-headerblock"</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-headerblock"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"table-layout:fixed;width:100%;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3846</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntbcellborder"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;text-decoration:none;margin:0px;border-right:1px solid #c0c0c0;border-bottom:1px solid #c0c0c0;white-space:nowrap;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3847</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">+</span><span class="STRN">"overlay"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"position:relative;z-index:1000;top:0px;left:0px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3848</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">p</span><span class="PUNC">+</span><span class="STRN">"scroller"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;text-align:left;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3849</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"padding:0px;margin:0px;border:1px solid #cccccc;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3850</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-scroller"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"padding:0px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3851</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-scrollcorner"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"padding:0px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3852</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-input-border"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"table-layout:fixed;overflow:hidden;position:absolute;z-index:2000;top:-2000px;left:-2000px;;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3853</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-column-resize-surface"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"filter:alpha(opacity=1);background-color:white;position:absolute;visibility:hidden;top:0;left:0;width:100;height:100;z-index:800;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3854</span> </span><span class="WHIT">		</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-column-indicator"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;white-space: nowrap;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3855</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>3856</span> </span><span class="WHIT">	</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">"#grid"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"#grid"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;text-align:left;-moz-user-select: none;-khtml-user-select: none;user-select: none;"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">?</span><span class="STRN">"position:relative;"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3857</span> </span><span class="WHIT">	</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">"#grid"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style.height</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3858</span> </span><span class="WHIT">	</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">"#grid"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3859</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".hScrollbarRange"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="NAME">totalColumnsWidth</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3860</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".vScrollbarRange"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3861</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">+</span><span class="STRN">" .ntb-cell"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;white-space:nowrap;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3862</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="PUNC">+</span><span class="NAME">t</span><span class="PUNC">+</span><span class="STRN">" .ntb-cell-border"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;white-space:nowrap;"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">?</span><span class="STRN">"height:auto;"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3863</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-headershow"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"padding:0px;"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this.isColumnIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="STRN">"display:none;"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3864</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-vscrollshow"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"padding:0px;"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">showvscroll</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"display:none;"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3865</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"#ntb-grid-hscrollshow"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"padding:0px;"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">showhscroll</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"display:none;"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3866</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-toolbarshow"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">showtoolbar</span><span class="PUNC">?</span><span class="STRN">""</span><span class="PUNC">:</span><span class="STRN">"display:none;"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3867</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-height"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="NAME">height</span><span class="PUNC">+</span><span class="STRN">"px;overflow:hidden;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3868</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-width"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="NAME">width</span><span class="PUNC">+</span><span class="STRN">"px;overflow:hidden;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3869</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-overlay"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"position:relative;z-index:1000;top:0px;left:0px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3870</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-scroller"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;text-align:left;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3871</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-scrollerheight"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">totalColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">?</span><span class="NAME">scrollerHeight</span><span class="PUNC">:</span><span class="NAME">scrollerHeight</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">this.getscrollbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3872</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-scrollerwidth"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="NAME">scrollerWidth</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3873</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-topheight"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="NAME">this.gettop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;overflow:hidden;"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">this.gettop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="NUMB">0</span><span class="PUNC">?</span><span class="STRN">"display:none;"</span><span class="PUNC">:</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3874</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-midheight"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"overflow:hidden;height:"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">totalColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">?</span><span class="NAME">midHeight</span><span class="PUNC">:</span><span class="NAME">midHeight</span><span class="PUNC">+</span><span class="NAME">this.getscrollbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3875</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-leftwidth"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="NAME">this.getleft</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;overflow:hidden;text-align:left;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3876</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-centerwidth"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">width</span><span class="PUNC">-</span><span class="NAME">this.getleft</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NAME">this.getscrollbarWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NAME">showvscroll</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3877</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-scrollbarheight"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="NAME">this.getscrollbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3878</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-scrollbarwidth"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="NAME">this.getscrollbarWidth</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3879</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-toolbarheight"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="NAME">this.getToolbarHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3880</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-surfacewidth"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"width:"</span><span class="PUNC">+</span><span class="NAME">unfrozenColumnsWidth</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3881</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-grid-surfaceheight"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:100px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3882</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-hscrollbar"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">totalColumnsWidth</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NAME">width</span><span class="PUNC">?</span><span class="STRN">"display:block;"</span><span class="PUNC">:</span><span class="STRN">"display:none;"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3883</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-row"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;margin:0px;line-height:"</span><span class="PUNC">+</span><span class="NAME">this.getRowHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3884</span> </span><span class="WHIT">	</span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-header-row"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"height:"</span><span class="PUNC">+</span><span class="NAME">this.getHeaderHeight</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px;"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3885</span> 
<span class='line'>3886</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3887</span> </span><span class="WHIT"> 	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">cols.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3888</span> </span><span class="WHIT"> 	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3889</span> </span><span class="WHIT"> 		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cols</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3890</span> </span><span class="WHIT"> 		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colRule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">".ntb-column"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3891</span> </span><span class="WHIT"> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colRule</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3892</span> </span><span class="WHIT">			</span><span class="NAME">colRule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">".ntb-column"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-column"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3893</span> </span><span class="WHIT">		</span><span class="NAME">colRule.style.width</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">col.getAttribute</span><span class="PUNC">(</span><span class="STRN">"Width"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">"px"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3894</span> 
<span class='line'>3895</span> </span><span class="WHIT"> 		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDataRule</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">".ntb-column-data"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3896</span> </span><span class="WHIT"> 		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colDataRule</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3897</span> </span><span class="WHIT">			</span><span class="NAME">this.rules</span><span class="PUNC">[</span><span class="STRN">".ntb-column-data"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">addRule</span><span class="PUNC">(</span><span class="NAME">ss</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">".ntb-column-data"</span><span class="PUNC">+</span><span class="NAME">u</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"text-align:"</span><span class="PUNC">+</span><span class="NAME">col.getAttribute</span><span class="PUNC">(</span><span class="STRN">"Align"</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="STRN">";"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3898</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3899</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3900</span> 
<span class='line'>3901</span> </span><span class="COMM">/**
<span class='line'>3902</span>  * This is used to clear the data from the component as well as other visual artifacts such as the selection boxes. This is primarily for use by component developers.
<span class='line'>3903</span>  */</span><span class="WHIT">
<span class='line'>3904</span> </span><span class="NAME">ntb_gridp.clearSurfaces</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3905</span> </span><span class="WHIT">	</span><span class="COMM">// Clearing the surface is called from insert, delete, sort, refresh.</span><span class="WHIT">
<span class='line'>3906</span> </span><span class="WHIT">	</span><span class="NAME">this.selection.clearBoxes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3907</span> </span><span class="WHIT">	</span><span class="NAME">this.Scroller.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3908</span> 
<span class='line'>3909</span> </span><span class="WHIT">	</span><span class="COMM">// Added this to ensure that the Scroller blank surface is the correct size.</span><span class="WHIT">
<span class='line'>3910</span> </span><span class="WHIT">	</span><span class="NAME">this.updateCellRanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3911</span> 
<span class='line'>3912</span> </span><span class="WHIT">	</span><span class="COMM">// When the surface is cleared we need to also clear any cached cells </span><span class="WHIT">
<span class='line'>3913</span> </span><span class="WHIT">	</span><span class="NAME">this.cachedCells</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3914</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3915</span> 
<span class='line'>3916</span> </span><span class="COMM">/**
<span class='line'>3917</span>  * Renders the Grid with no columns or data. Before the frame can be rendered the Grid must be attached to an 
<span class='line'>3918</span>  * HtmlElement through either the declaration or using the attachToParentDomElement() method. 
<span class='line'>3919</span>  * The frame must be rendered before any columns or data can be rendered.
<span class='line'>3920</span>  * @private
<span class='line'>3921</span>  */</span><span class="WHIT">
<span class='line'>3922</span> </span><span class="NAME">ntb_gridp.renderFrame</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3923</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3924</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">browser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"IE"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3925</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.MOZ</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3926</span> </span><span class="WHIT">		</span><span class="NAME">browser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"MOZ"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3927</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">nitobi.browser.SAFARI</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3928</span> </span><span class="WHIT">		</span><span class="NAME">browser</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"SAFARI"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3929</span> 
<span class='line'>3930</span> </span><span class="WHIT">	</span><span class="NAME">this.frameXslProc.addParameter</span><span class="PUNC">(</span><span class="STRN">"browser"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">browser</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3931</span> 
<span class='line'>3932</span> </span><span class="WHIT">	</span><span class="NAME">this.UiContainer.innerHTML</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.xml.transformToString</span><span class="PUNC">(</span><span class="NAME">this.model</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.frameXslProc</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3933</span> 
<span class='line'>3934</span> </span><span class="WHIT">	</span><span class="COMM">// Attach dom events like keydown, contextmenu, and selectstart</span><span class="WHIT">
<span class='line'>3935</span> </span><span class="WHIT">	</span><span class="NAME">this.attachDomEvents</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3936</span> 
<span class='line'>3937</span> </span><span class="WHIT">	</span><span class="COMM">//	this.showLoading();</span><span class="WHIT">
<span class='line'>3938</span> </span><span class="WHIT">	</span><span class="NAME">this.frameRendered</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3939</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterFrameRender"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3940</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3941</span> 
<span class='line'>3942</span> </span><span class="COMM">/**
<span class='line'>3943</span>  * Clears the cacheMap and requestCache of the middle left and middle center Viewports of the Grid.
<span class='line'>3944</span>  * @private
<span class='line'>3945</span>  */</span><span class="WHIT">
<span class='line'>3946</span> </span><span class="NAME">ntb_gridp.renderMiddle</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3947</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3948</span> </span><span class="WHIT">	</span><span class="COMM">//	The cacheMaps should be flushed here to be ready for rendering</span><span class="WHIT">
<span class='line'>3949</span> </span><span class="WHIT">	</span><span class="NAME">this.Scroller.view.midleft.flushCache</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3950</span> </span><span class="WHIT">	</span><span class="NAME">this.Scroller.view.midcenter.flushCache</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3951</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3952</span> 
<span class='line'>3953</span> </span><span class="COMM">/**
<span class='line'>3954</span>  * Refreshes the data in the Grid. Any unsaved changes to data in the Grid can be 
<span class='line'>3955</span>  * lost by refreshing the data. The OnBeforeRefreshEvent and 
<span class='line'>3956</span>  * OnAfterRefreshEvent are both fired. Clears all the data that is stored 
<span class='line'>3957</span>  * by the Grid, and gets the current page of data from the server. Any 
<span class='line'>3958</span>  * changes made by the user will be deleted. Call save first if you don't 
<span class='line'>3959</span>  * want these changes to be lost.
<span class='line'>3960</span>  */</span><span class="WHIT">
<span class='line'>3961</span> </span><span class="NAME">ntb_gridp.refresh</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3962</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3963</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//new nitobi.grid.EventArgs(this);</span><span class="WHIT">
<span class='line'>3964</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">'BeforeRefresh'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3965</span> 
<span class='line'>3966</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="STRN">'The Grid must be conntected to a DataTable to call refresh.'</span><span class="PUNC">,</span><span class="STRN">''</span><span class="PUNC">,</span><span class="NAME">EBA_THROW</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3967</span> 
<span class='line'>3968</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Not sure why clear is commented out and the other code is here?</span><span class="WHIT">
<span class='line'>3969</span> </span><span class="WHIT">	</span><span class="COMM">//this.clear();</span><span class="WHIT">
<span class='line'>3970</span> </span><span class="WHIT">	</span><span class="NAME">this.selectedRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3971</span> </span><span class="WHIT">	</span><span class="NAME">this.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3972</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="NAME">this.getDataMode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">!=</span><span class="STRN">"local"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3973</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.clearData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3974</span> 
<span class='line'>3975</span> </span><span class="WHIT">	</span><span class="NAME">this.syncWithData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3976</span> 
<span class='line'>3977</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.handleAfterRefresh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3978</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3979</span> 
<span class='line'>3980</span> </span><span class="COMM">/**
<span class='line'>3981</span>  * Event handler that is fired after a refresh of the data in the Grid is 
<span class='line'>3982</span>  * complete. Fires the &lt;code>AfterRefresh&lt;/code> event
<span class='line'>3983</span>  * @private
<span class='line'>3984</span>  */</span><span class="WHIT">
<span class='line'>3985</span> </span><span class="NAME">ntb_gridp.handleAfterRefresh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3986</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3987</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="COMM">//new nitobi.grid.EventArgs(this);</span><span class="WHIT">
<span class='line'>3988</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterRefresh"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3989</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>3990</span> 
<span class='line'>3991</span> </span><span class="COMM">/**
<span class='line'>3992</span>  * Clears all data and the surfaces.
<span class='line'>3993</span>  * @private
<span class='line'>3994</span>  */</span><span class="WHIT">
<span class='line'>3995</span> </span><span class="NAME">ntb_gridp.clear</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>3996</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>3997</span> </span><span class="WHIT">	</span><span class="NAME">this.selectedRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3998</span> </span><span class="WHIT">	</span><span class="NAME">this.clearData</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>3999</span> </span><span class="WHIT">	</span><span class="NAME">this.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4000</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4001</span> 
<span class='line'>4002</span> </span><span class="COMM">/**
<span class='line'>4003</span>  * Event handler for the context menu event.
<span class='line'>4004</span>  * @param {Event} evt The Event object.
<span class='line'>4005</span>  * @param {HTMLElement} obj The HTML element that the context menu event 
<span class='line'>4006</span>  * occured on.
<span class='line'>4007</span>  * @private
<span class='line'>4008</span>  */</span><span class="WHIT">
<span class='line'>4009</span> </span><span class="NAME">ntb_gridp.handleContextMenu</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4010</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4011</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">contextMenuFunc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getOnContextMenuEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4012</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">contextMenuFunc</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4013</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4014</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4015</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"ContextMenu"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4016</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4017</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4018</span> </span><span class="WHIT">			</span><span class="NAME">evt.cancelBubble</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4019</span> </span><span class="WHIT">			</span><span class="NAME">evt.returnValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4020</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4021</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4022</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4023</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4024</span> 
<span class='line'>4025</span> </span><span class="COMM">/**
<span class='line'>4026</span>  * Event handler for the key press event.
<span class='line'>4027</span>  * @para {Event} evt The Event object.
<span class='line'>4028</span>  * @private
<span class='line'>4029</span>  */</span><span class="WHIT">
<span class='line'>4030</span> </span><span class="NAME">ntb_gridp.handleKeyPress</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4031</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4032</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4033</span> 
<span class='line'>4034</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: should be able to use activeCellObject.</span><span class="WHIT">
<span class='line'>4035</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4036</span> 
<span class='line'>4037</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"KeyPress"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4038</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">col.getOnKeyPressEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4039</span> 
<span class='line'>4040</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.html.cancelEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4041</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4042</span> </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4043</span> 
<span class='line'>4044</span> </span><span class="COMM">/**
<span class='line'>4045</span>  * Event handler for the key up event.
<span class='line'>4046</span>  * @para {Event} evt The Event object.
<span class='line'>4047</span>  * @private
<span class='line'>4048</span>  */</span><span class="WHIT">
<span class='line'>4049</span> </span><span class="NAME">ntb_gridp.handleKeyUp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4050</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4051</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4052</span> 
<span class='line'>4053</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: should be able to use activeCellObject.</span><span class="WHIT">
<span class='line'>4054</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4055</span> 
<span class='line'>4056</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"KeyUp"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4057</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">col.getOnKeyUpEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4058</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4059</span> 
<span class='line'>4060</span> </span><span class="COMM">/**
<span class='line'>4061</span>  * Event handler for the key down event.
<span class='line'>4062</span>  * @param {Event} evt The Event object.
<span class='line'>4063</span>  * @param {HTMLElement} obj The HTML element that the context menu event 
<span class='line'>4064</span>  * occured on.
<span class='line'>4065</span>  * @private
<span class='line'>4066</span>  */</span><span class="WHIT">
<span class='line'>4067</span> </span><span class="NAME">ntb_gridp.handleKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4068</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4069</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4070</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4071</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evtArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4072</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"KeyDown"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evtArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">col.getOnKeyDownEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evtArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4073</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4074</span> 
<span class='line'>4075</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.keyCode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4076</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: errors can occur if we press keys while selecting ...</span><span class="WHIT">
<span class='line'>4077</span> 
<span class='line'>4078</span> </span><span class="WHIT">	</span><span class="COMM">// evt.metaKey tests if the apple key is selected</span><span class="WHIT">
<span class='line'>4079</span> </span><span class="WHIT">	</span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">k</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt.shiftKey</span><span class="PUNC">?</span><span class="NUMB">256</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">evt.ctrlKey</span><span class="PUNC">?</span><span class="NUMB">512</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="PUNC">(</span><span class="NAME">evt.metaKey</span><span class="PUNC">?</span><span class="NUMB">1024</span><span class="PUNC">:</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4080</span> 
<span class='line'>4081</span> </span><span class="WHIT">	</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">k</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4082</span> </span><span class="WHIT">		</span><span class="COMM">//just crtl pressed</span><span class="WHIT">
<span class='line'>4083</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">529</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4084</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4085</span> </span><span class="WHIT">		</span><span class="COMM">//end</span><span class="WHIT">
<span class='line'>4086</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">35</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4087</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4088</span> </span><span class="WHIT">		</span><span class="COMM">//home</span><span class="WHIT">
<span class='line'>4089</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">36</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4090</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4091</span> 
<span class='line'>4092</span> </span><span class="WHIT">		</span><span class="COMM">//ctrl+end</span><span class="WHIT">
<span class='line'>4093</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">547</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4094</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4095</span> </span><span class="WHIT">		</span><span class="COMM">//ctrl+home</span><span class="WHIT">
<span class='line'>4096</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">548</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4097</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4098</span> 
<span class='line'>4099</span> 
<span class='line'>4100</span> </span><span class="WHIT">		</span><span class="COMM">//	page down</span><span class="WHIT">
<span class='line'>4101</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">34</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4102</span> </span><span class="WHIT">			</span><span class="NAME">this.page</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4103</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4104</span> </span><span class="WHIT">		</span><span class="COMM">//	page up</span><span class="WHIT">
<span class='line'>4105</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">33</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4106</span> </span><span class="WHIT">			</span><span class="NAME">this.page</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4107</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4108</span> 
<span class='line'>4109</span> </span><span class="WHIT">		</span><span class="COMM">//insert</span><span class="WHIT">
<span class='line'>4110</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">45</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4111</span> </span><span class="WHIT">			</span><span class="NAME">this.insertAfterCurrentRow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4112</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4113</span> </span><span class="WHIT">		</span><span class="COMM">//delete</span><span class="WHIT">
<span class='line'>4114</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">46</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4115</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getSelectedRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">this.deleteSelectedRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4116</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="NAME">this.deleteCurrentRow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4117</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4118</span> 
<span class='line'>4119</span> </span><span class="WHIT">		</span><span class="COMM">//	select home</span><span class="WHIT">
<span class='line'>4120</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">292</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4121</span> </span><span class="WHIT">			</span><span class="NAME">this.selectHome</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4122</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4123</span> 
<span class='line'>4124</span> </span><span class="WHIT">		</span><span class="COMM">//	select page down</span><span class="WHIT">
<span class='line'>4125</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">290</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4126</span> </span><span class="WHIT">			</span><span class="NAME">this.pageSelect</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4127</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4128</span> </span><span class="WHIT">		</span><span class="COMM">//	select page up</span><span class="WHIT">
<span class='line'>4129</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">289</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4130</span> </span><span class="WHIT">			</span><span class="NAME">this.pageSelect</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4131</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4132</span> 
<span class='line'>4133</span> 
<span class='line'>4134</span> </span><span class="WHIT">		</span><span class="COMM">//	select down </span><span class="WHIT">
<span class='line'>4135</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">296</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4136</span> </span><span class="WHIT">			</span><span class="NAME">this.reselect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4137</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4138</span> </span><span class="WHIT">		</span><span class="COMM">//	select up</span><span class="WHIT">
<span class='line'>4139</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">294</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4140</span> </span><span class="WHIT">			</span><span class="NAME">this.reselect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4141</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4142</span> </span><span class="WHIT">		</span><span class="COMM">//	select left</span><span class="WHIT">
<span class='line'>4143</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">293</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4144</span> </span><span class="WHIT">			</span><span class="NAME">this.reselect</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4145</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4146</span> </span><span class="WHIT">		</span><span class="COMM">// select right</span><span class="WHIT">
<span class='line'>4147</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">295</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4148</span> </span><span class="WHIT">			</span><span class="NAME">this.reselect</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4149</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4150</span> </span><span class="WHIT">		</span><span class="COMM">//select all</span><span class="WHIT">
<span class='line'>4151</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">577</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4152</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4153</span> 
<span class='line'>4154</span> </span><span class="WHIT">		</span><span class="COMM">//copy</span><span class="WHIT">
<span class='line'>4155</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">579</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4156</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">557</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4157</span> </span><span class="WHIT">			</span><span class="NAME">this.copy</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4158</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4159</span> </span><span class="WHIT">		</span><span class="COMM">// copy for mac</span><span class="WHIT">
<span class='line'>4160</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1091</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4161</span> </span><span class="WHIT">			</span><span class="NAME">this.copy</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4162</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4163</span> </span><span class="WHIT">		</span><span class="COMM">//cut</span><span class="WHIT">
<span class='line'>4164</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">600</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4165</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">302</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4166</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4167</span> </span><span class="WHIT">		</span><span class="COMM">//paste</span><span class="WHIT">
<span class='line'>4168</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">598</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4169</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">301</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4170</span> </span><span class="WHIT">			</span><span class="NAME">this.paste</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4171</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4172</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4173</span> </span><span class="WHIT">		</span><span class="COMM">// paste for mac</span><span class="WHIT">
<span class='line'>4174</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">1110</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4175</span> </span><span class="WHIT">			</span><span class="NAME">this.paste</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4176</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4177</span> </span><span class="WHIT">		</span><span class="COMM">// **** FROM BLOCK NAV **** //</span><span class="WHIT">
<span class='line'>4178</span> </span><span class="WHIT">		</span><span class="COMM">//end</span><span class="WHIT">
<span class='line'>4179</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">35</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4180</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4181</span> </span><span class="WHIT">		</span><span class="COMM">//home</span><span class="WHIT">
<span class='line'>4182</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">36</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4183</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4184</span> 
<span class='line'>4185</span> </span><span class="WHIT">		</span><span class="COMM">//ctrl+end</span><span class="WHIT">
<span class='line'>4186</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">547</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4187</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4188</span> </span><span class="WHIT">		</span><span class="COMM">//ctrl+home</span><span class="WHIT">
<span class='line'>4189</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">548</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4190</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4191</span> 
<span class='line'>4192</span> </span><span class="WHIT">		</span><span class="COMM">//down </span><span class="WHIT">
<span class='line'>4193</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">13</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4194</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">et</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getEnterTab</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4195</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4196</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4197</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">et</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4198</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4199</span> </span><span class="WHIT">				</span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4200</span> </span><span class="WHIT">				</span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4201</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4202</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">et</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"right"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4203</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4204</span> </span><span class="WHIT">				</span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4205</span> </span><span class="WHIT">				</span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4206</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4207</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">et</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"down"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4208</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4209</span> </span><span class="WHIT">				</span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4210</span> </span><span class="WHIT">				</span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4211</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4212</span> </span><span class="WHIT">			</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">et</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"up"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4213</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4214</span> </span><span class="WHIT">				</span><span class="NAME">horiz</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4215</span> </span><span class="WHIT">				</span><span class="NAME">vert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4216</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4217</span> </span><span class="WHIT">			</span><span class="NAME">this.move</span><span class="PUNC">(</span><span class="NAME">horiz</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">vert</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4218</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4219</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">40</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4220</span> </span><span class="WHIT">			</span><span class="NAME">this.move</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4221</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4222</span> </span><span class="WHIT">		</span><span class="COMM">//up</span><span class="WHIT">
<span class='line'>4223</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">269</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4224</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">38</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4225</span> </span><span class="WHIT">			</span><span class="NAME">this.move</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4226</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4227</span> </span><span class="WHIT">		</span><span class="COMM">//left</span><span class="WHIT">
<span class='line'>4228</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">265</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4229</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">37</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4230</span> </span><span class="WHIT">			</span><span class="NAME">this.move</span><span class="PUNC">(</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4231</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4232</span> </span><span class="WHIT">		</span><span class="COMM">//right</span><span class="WHIT">
<span class='line'>4233</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">9</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4234</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">39</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4235</span> </span><span class="WHIT">			</span><span class="NAME">this.move</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4236</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4237</span> </span><span class="WHIT">		</span><span class="COMM">//select all</span><span class="WHIT">
<span class='line'>4238</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">577</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4239</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4240</span> </span><span class="WHIT">		</span><span class="COMM">// save</span><span class="WHIT">
<span class='line'>4241</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">595</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4242</span> </span><span class="WHIT">			</span><span class="NAME">this.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4243</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4244</span> </span><span class="WHIT">		</span><span class="COMM">// refresh</span><span class="WHIT">
<span class='line'>4245</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">594</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4246</span> </span><span class="WHIT">			</span><span class="NAME">this.refresh</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4247</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4248</span> </span><span class="WHIT">		</span><span class="COMM">// new row</span><span class="WHIT">
<span class='line'>4249</span> </span><span class="WHIT">		</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="NUMB">590</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4250</span> </span><span class="WHIT">			</span><span class="NAME">this.insertAfterCurrentRow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4251</span> </span><span class="WHIT">			</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4252</span> </span><span class="WHIT">		</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4253</span> </span><span class="WHIT">			</span><span class="NAME">this.edit</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4254</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4255</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4256</span> 
<span class='line'>4257</span> </span><span class="COMM">/**
<span class='line'>4258</span>  * Re-sizes the selection box by the relative values in the x and y arguments. This method is generally used for shift+down type of behaviour.
<span class='line'>4259</span>  * @param {Number} x Relative x offset to increase the selection box size by.
<span class='line'>4260</span>  * @param {Number} y Relative y offset to increase the selection box size by.
<span class='line'>4261</span>  * @private
<span class='line'>4262</span>  */</span><span class="WHIT">
<span class='line'>4263</span> </span><span class="NAME">ntb_gridp.reselect</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">x</span><span class="PUNC">,</span><span class="NAME">y</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4264</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4265</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">S</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4266</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">S.endCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4267</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">S.endCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">x</span><span class="WHIT">
<span class='line'>4268</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.columnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">row</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4269</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4270</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newEndCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getCellElement</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4271</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">newEndCell</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4272</span> </span><span class="WHIT">		</span><span class="NAME">S.changeEndCellWithDomNode</span><span class="PUNC">(</span><span class="NAME">newEndCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4273</span> </span><span class="WHIT">		</span><span class="NAME">S.alignBoxes</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4274</span> </span><span class="WHIT">		</span><span class="NAME">this.ensureCellInView</span><span class="PUNC">(</span><span class="NAME">newEndCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4275</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4276</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4277</span> 
<span class='line'>4278</span> </span><span class="COMM">/**
<span class='line'>4279</span>  * @private
<span class='line'>4280</span>  */</span><span class="WHIT">
<span class='line'>4281</span> </span><span class="NAME">ntb_gridp.pageSelect</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4282</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4283</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: This is only for live scrolling grid ... refactor pls. it is called from handlekey</span><span class="WHIT">
<span class='line'>4284</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4285</span> 
<span class='line'>4286</span> </span><span class="COMM">/**
<span class='line'>4287</span>  * Selects from the current active cell up to the first row.
<span class='line'>4288</span>  */</span><span class="WHIT">
<span class='line'>4289</span> </span><span class="NAME">ntb_gridp.selectHome</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4290</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4291</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">S</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4292</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">row</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">S.endCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4293</span> </span><span class="WHIT">	</span><span class="NAME">this.reselect</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NAME">row</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4294</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4295</span> 
<span class='line'>4296</span> </span><span class="COMM">/**
<span class='line'>4297</span>  * Causes the currently activated cell to go into edit mode. OnBeforeCellEditEvent is fired.
<span class='line'>4298</span>  * &lt;p>
<span class='line'>4299</span>  * &lt;b>Example&lt;/b>
<span class='line'>4300</span>  * &lt;/p>
<span class='line'>4301</span>  * &lt;div class="code">
<span class='line'>4302</span>  * &lt;pre>&lt;code>
<span class='line'>4303</span>  * &#102;unction editCell(row, col)
<span class='line'>4304</span>  * {
<span class='line'>4305</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>4306</span>  * 	grid.setPosition(row, col);
<span class='line'>4307</span>  * 	grid.edit();
<span class='line'>4308</span>  * }
<span class='line'>4309</span>  * &lt;/code>&lt;/pre>
<span class='line'>4310</span>  * &lt;/div>
<span class='line'>4311</span>  * @param {Event} e The Event object when the edit is caused by a user gesture.
<span class='line'>4312</span>  * @see Event
<span class='line'>4313</span>  * @see #OnBeforeCellEditEvent
<span class='line'>4314</span>  * @see #setPosition
<span class='line'>4315</span>  */</span><span class="WHIT">
<span class='line'>4316</span> </span><span class="NAME">ntb_gridp.edit</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4317</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4318</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4319</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4320</span> 
<span class='line'>4321</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: should be able to use activeCellObject.</span><span class="WHIT">
<span class='line'>4322</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeCellObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4323</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeColumnObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4324</span> 
<span class='line'>4325</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">beforeEditEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeCellEditEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4326</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeCellEdit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">beforeEditEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">col.getOnBeforeCellEditEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">beforeEditEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4327</span> 
<span class='line'>4328</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4329</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">shift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4330</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ctrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4331</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4332</span> </span><span class="WHIT">		</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.keyCode</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4333</span> </span><span class="WHIT">		</span><span class="NAME">shift</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.shiftKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4334</span> </span><span class="WHIT">		</span><span class="NAME">ctrl</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt.ctrlKey</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4335</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4336</span> 
<span class='line'>4337</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initialChar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4338</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">keyCodeOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4339</span> 
<span class='line'>4340</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Generalize this so people can easily hook into keycodes...  </span><span class="WHIT">
<span class='line'>4341</span> </span><span class="WHIT">	</span><span class="COMM">//[A - Z] shift or [0-9] no shift</span><span class="WHIT">
<span class='line'>4342</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">shift</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">64</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">91</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">shift</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">47</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">58</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4343</span> </span><span class="WHIT">		</span><span class="NAME">keyCodeOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4344</span> 
<span class='line'>4345</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">shift</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4346</span> </span><span class="WHIT">		</span><span class="COMM">// [A-Z] no shift</span><span class="WHIT">
<span class='line'>4347</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">64</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">91</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4348</span> </span><span class="WHIT">			</span><span class="NAME">keyCodeOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4349</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">95</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">106</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4350</span> </span><span class="WHIT">			</span><span class="NAME">keyCodeOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">48</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4351</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">189</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">109</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4352</span> </span><span class="WHIT">			</span><span class="NAME">initialChar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"-"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4353</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">></span><span class="WHIT"> </span><span class="NUMB">186</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">188</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4354</span> </span><span class="WHIT">			</span><span class="NAME">keyCodeOffset</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">126</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4355</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4356</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="COMM">// TODO: currently we dont support any special characters ... </span><span class="WHIT">
<span class='line'>4357</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4358</span> 
<span class='line'>4359</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">keyCodeOffset</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4360</span> </span><span class="WHIT">		</span><span class="NAME">initialChar</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">String.fromCharCode</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">keyCodeOffset</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4361</span> 
<span class='line'>4362</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">ctrl</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4363</span> </span><span class="WHIT">		</span><span class="COMM">/*what does it matter if there is an initialChar? */</span><span class="WHIT">
<span class='line'>4364</span> </span><span class="WHIT">		</span><span class="PUNC">(</span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">initialChar</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4365</span> </span><span class="WHIT">		</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">113</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="COMM">// F2</span><span class="WHIT">
<span class='line'>4366</span> </span><span class="WHIT">		</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">||</span><span class="WHIT"> </span><span class="COMM">// double click (IE)</span><span class="WHIT">
<span class='line'>4367</span> </span><span class="WHIT">		</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="COMM">// double click (Moz) - this should really be 0, but something funny's hapening with Moz</span><span class="WHIT">
<span class='line'>4368</span> </span><span class="WHIT">		</span><span class="PUNC">(</span><span class="NAME">keyVal</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">32</span><span class="PUNC">)</span><span class="COMM">// space</span><span class="WHIT">
<span class='line'>4369</span> </span><span class="WHIT">		</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4370</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4371</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">col.isEditable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4372</span> </span><span class="WHIT">			</span><span class="NAME">this.cellEditor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.form.ControlFactory.instance.getEditor</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4373</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.cellEditor</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4374</span> </span><span class="WHIT">			</span><span class="NAME">this.cellEditor.setEditCompleteHandler</span><span class="PUNC">(</span><span class="NAME">this.editComplete</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4375</span> </span><span class="WHIT">			</span><span class="NAME">this.cellEditor.attachToParent</span><span class="PUNC">(</span><span class="NAME">this.getToolsContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4376</span> </span><span class="WHIT">			</span><span class="NAME">this.cellEditor.bind</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">initialChar</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4377</span> </span><span class="WHIT">			</span><span class="NAME">this.cellEditor.mimic</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4378</span> </span><span class="WHIT">			</span><span class="NAME">this.setEditMode</span><span class="PUNC">(</span><span class="KEYW">true</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4379</span> </span><span class="WHIT">			</span><span class="COMM">// This is to prevent double characters from showing up in IE</span><span class="WHIT">
<span class='line'>4380</span> </span><span class="WHIT">			</span><span class="NAME">nitobi.html.cancelEvent</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4381</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4382</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4383</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4384</span> </span><span class="WHIT">		</span><span class="COMM">// do not set active cell for other keys such as tab</span><span class="WHIT">
<span class='line'>4385</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4386</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4387</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4388</span> 
<span class='line'>4389</span> </span><span class="COMM">/**
<span class='line'>4390</span>  * Fires after the user has completed editing a cell by pressing enter or ESC. Before the data is updated OnCellValidateEvent is fired which can cause
<span class='line'>4391</span>  * the edit to be discarded if the handler returns false.
<span class='line'>4392</span>  * @private
<span class='line'>4393</span>  * @param {nitobi.components.grid.EditCompleteEventArgs} editCompleteEventArgs
<span class='line'>4394</span>  * @see #OnCellValidateEvent
<span class='line'>4395</span>  */</span><span class="WHIT">
<span class='line'>4396</span> </span><span class="NAME">ntb_gridp.editComplete</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">editCompleteEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4397</span> </span><span class="WHIT">	</span><span class="COMM">//	update the value in the grid</span><span class="WHIT">
<span class='line'>4398</span> </span><span class="WHIT">	</span><span class="COMM">//	update the value in the datasource </span><span class="WHIT">
<span class='line'>4399</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">=</span><span class="NAME">editCompleteEventArgs.cell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4400</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.getColumnObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4401</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">editCompleteEventArgs.databaseValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4402</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">newDisplay</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">editCompleteEventArgs.displayValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4403</span> 
<span class='line'>4404</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">validateEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCellValidateEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell.getValue</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4405</span> 
<span class='line'>4406</span> </span><span class="WHIT">	</span><span class="COMM">// CellValidate can be on a column and a grid level ...</span><span class="WHIT">
<span class='line'>4407</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"CellValidate"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">validateEventArgs</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">column.getOnCellValidateEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">validateEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4408</span> </span><span class="WHIT">	</span><span class="COMM">//!cell.getColumnObject().fire("CellValidate", validateEventArgs))</span><span class="WHIT">
<span class='line'>4409</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4410</span> 
<span class='line'>4411</span> </span><span class="WHIT">	</span><span class="NAME">cell.setValue</span><span class="PUNC">(</span><span class="NAME">newValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">newDisplay</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4412</span> 
<span class='line'>4413</span> </span><span class="COMM">//	cell.DomNode.style.backgroundColor='#FFFF00';</span><span class="WHIT">
<span class='line'>4414</span> </span><span class="COMM">//	this.subscribe('AfterSave', function() {nitobi.effects.blueFade(cell.DomNode, 0)});</span><span class="WHIT">
<span class='line'>4415</span> 
<span class='line'>4416</span> </span><span class="WHIT">	</span><span class="COMM">//TODO: we need to define some converters such that metadata properties can be</span><span class="WHIT">
<span class='line'>4417</span> </span><span class="WHIT">	</span><span class="COMM">//changed based on conditions ... such as if val &lt; 0 bgcolor = red</span><span class="WHIT">
<span class='line'>4418</span> </span><span class="WHIT">	</span><span class="COMM">//similarly if val.substr(0,1) == "=" make it a formula editor for next time or the other way around</span><span class="WHIT">
<span class='line'>4419</span> </span><span class="WHIT">	</span><span class="NAME">editCompleteEventArgs.editor.hide</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4420</span> </span><span class="WHIT">	</span><span class="NAME">this.setEditMode</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4421</span> 
<span class='line'>4422</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: This will not be fired if the validate does not return true - is this correct???</span><span class="WHIT">
<span class='line'>4423</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">afterEditEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnAfterCellEditEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4424</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterCellEdit"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">afterEditEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4425</span> </span><span class="WHIT">	</span><span class="NAME">nitobi.event.evaluate</span><span class="PUNC">(</span><span class="NAME">column.getOnAfterCellEditEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">afterEditEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4426</span> 
<span class='line'>4427</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: Remove this and fix editing tab key press stuff</span><span class="WHIT">
<span class='line'>4428</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4429</span> </span><span class="WHIT">		</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4430</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4431</span> </span><span class="WHIT">	</span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4432</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4433</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4434</span> </span><span class="COMM">/**
<span class='line'>4435</span>  * This is a macro function for anywhere that autosave is used. Insert, delete and edit all should use this.
<span class='line'>4436</span>  * @private
<span class='line'>4437</span>  */</span><span class="WHIT">
<span class='line'>4438</span> </span><span class="NAME">ntb_gridp.autoSave</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4439</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4440</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isAutoSaveEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4441</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4442</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.save</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4443</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4444</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4445</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4446</span> 
<span class='line'>4447</span> </span><span class="COMM">/**
<span class='line'>4448</span>  * Activates the cell at the supplied row / column coordinates.
<span class='line'>4449</span>  * &lt;p>
<span class='line'>4450</span>  * &lt;b>Example&lt;/b>
<span class='line'>4451</span>  * &lt;/p>
<span class='line'>4452</span>  * &lt;div class="code">
<span class='line'>4453</span>  * &lt;pre>&lt;code class="">
<span class='line'>4454</span>  * &#102;unction editCell(row, col)
<span class='line'>4455</span>  * {
<span class='line'>4456</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>4457</span>  * 	grid.selectCellByCoords(row, col);
<span class='line'>4458</span>  * 	grid.edit();
<span class='line'>4459</span>  * }
<span class='line'>4460</span>  * &lt;/code>&lt;/pre>
<span class='line'>4461</span>  * &lt;/div>
<span class='line'>4462</span>  * @param {Number} row The row number of the cell to activate.
<span class='line'>4463</span>  * @param {Number} column The column number of the cell to activate.
<span class='line'>4464</span>  */</span><span class="WHIT">
<span class='line'>4465</span> </span><span class="NAME">ntb_gridp.selectCellByCoords</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">column</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4466</span> </span><span class="WHIT">	</span><span class="NAME">this.setPosition</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4467</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4468</span> 
<span class='line'>4469</span> </span><span class="COMM">/**
<span class='line'>4470</span>  * Activates the cell at the row / column coordinates. This method is used 
<span class='line'>4471</span>  * by {@link #selectCellByCoords}.
<span class='line'>4472</span>  * @param {Number} row The row number of the cell to activate.
<span class='line'>4473</span>  * @param {Number} column The column number of the cell to activate.
<span class='line'>4474</span>  */</span><span class="WHIT">
<span class='line'>4475</span> </span><span class="NAME">ntb_gridp.setPosition</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">column</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4476</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4477</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4478</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4479</span> </span><span class="WHIT">		</span><span class="NAME">this.setActiveCell</span><span class="PUNC">(</span><span class="NAME">this.getCellElement</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4480</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4481</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4482</span> 
<span class='line'>4483</span> </span><span class="COMM">/**
<span class='line'>4484</span>  * Sends a save request to the server with any data from the Grid that 
<span class='line'>4485</span>  * has been changed.  If there are no changes to the local data there 
<span class='line'>4486</span>  * will be no data sent to the server.  The &lt;code>OnBeforeSaveEvent&lt;/code> 
<span class='line'>4487</span>  * is fired prior to the data being sent to the server and the 
<span class='line'>4488</span>  * &lt;code>OnAfterSaveEvent&lt;/code> is fired after the save has completed.
<span class='line'>4489</span>  * &lt;p>
<span class='line'>4490</span>  * Calling this method is the same as clicking the save button in the
<span class='line'>4491</span>  * Grid's toolbar.
<span class='line'>4492</span>  * &lt;/p>
<span class='line'>4493</span>  * &lt;p>
<span class='line'>4494</span>  * &lt;b>Example&lt;/b>
<span class='line'>4495</span>  * &lt;/p>
<span class='line'>4496</span>  * &lt;div class="code">
<span class='line'>4497</span>  * &lt;pre>&lt;code class="">
<span class='line'>4498</span>  * &#102;unction customSave(param1, value1)
<span class='line'>4499</span>  * {
<span class='line'>4500</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>4501</span>  * 	var datatable = grid.getDataSource();
<span class='line'>4502</span>  * 	datatable.setSaveHandlerParameter(param1, value1);
<span class='line'>4503</span>  * 	grid.save();
<span class='line'>4504</span>  * }
<span class='line'>4505</span>  * &lt;/code>&lt;/pre>
<span class='line'>4506</span>  * &lt;/div>
<span class='line'>4507</span>  * @see nitobi.data.DataTable#setSaveHandlerParameter
<span class='line'>4508</span>  * @see #getDataSource
<span class='line'>4509</span>  */</span><span class="WHIT">
<span class='line'>4510</span> </span><span class="NAME">ntb_gridp.save</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4511</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4512</span> </span><span class="WHIT">	</span><span class="COMM">// Debated on whether to put his in the table.save. Decided that save </span><span class="WHIT">
<span class='line'>4513</span> </span><span class="WHIT">	</span><span class="COMM">// really must mean SAVE, and that this save will only save if required. JG</span><span class="WHIT">
<span class='line'>4514</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.datatable.log.selectNodes</span><span class="PUNC">(</span><span class="STRN">"//"</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">"data/*"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4515</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4516</span> 
<span class='line'>4517</span> </span><span class="WHIT">	</span><span class="COMM">// the updategram is retained but save operation is postponed.</span><span class="WHIT">
<span class='line'>4518</span> </span><span class="WHIT">	</span><span class="COMM">// This will means the client and server are now split brain</span><span class="WHIT">
<span class='line'>4519</span> 
<span class='line'>4520</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: It is best if a get from the server is done to ensure the</span><span class="WHIT">
<span class='line'>4521</span> </span><span class="WHIT">	</span><span class="COMM">// client grid is up to date</span><span class="WHIT">
<span class='line'>4522</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeSave"</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4523</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4524</span> 
<span class='line'>4525</span> </span><span class="COMM">// TODO: reimplement showloading.</span><span class="WHIT">
<span class='line'>4526</span> </span><span class="COMM">//	this.showLoading();</span><span class="WHIT">
<span class='line'>4527</span> 
<span class='line'>4528</span> </span><span class="WHIT">	</span><span class="NAME">this.datatable.save</span><span class="PUNC">(</span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.saveCompleteHandler</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getOnBeforeSaveEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4529</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4530</span> 
<span class='line'>4531</span> </span><span class="COMM">/**
<span class='line'>4532</span>  * Called when the save request to the server is completed.
<span class='line'>4533</span>  * The &lt;code>OnAfterSaveEvent&lt;/code> is fired here.
<span class='line'>4534</span>  * @param {nitobi.data.OnSaveCompleteEventArgs} eventArgs
<span class='line'>4535</span>  * @private
<span class='line'>4536</span>  */</span><span class="WHIT">
<span class='line'>4537</span> </span><span class="NAME">ntb_gridp.saveCompleteHandler</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4538</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4539</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.getDataSource</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getHandlerError</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4540</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4541</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HandlerError"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4542</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4543</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterSave"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4544</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4545</span> 
<span class='line'>4546</span> </span><span class="COMM">/**
<span class='line'>4547</span>  * Sets the focus of the web page to the component. OnFocusEvent is fired.
<span class='line'>4548</span>  * @see nitobi.grid.Grid#OnFocusEvent
<span class='line'>4549</span>  */</span><span class="WHIT">
<span class='line'>4550</span> </span><span class="NAME">ntb_gridp.focus</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4551</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4552</span> </span><span class="WHIT">	</span><span class="COMM">//	This refocuses the grid after an edit takes place</span><span class="WHIT">
<span class='line'>4553</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4554</span> </span><span class="WHIT">		</span><span class="COMM">//nitobi.html.getFirstChild(this.UiContainer).focus();</span><span class="WHIT">
<span class='line'>4555</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: need to handle focus and bluring better so that grid.onfocus does not get fired so often</span><span class="WHIT">
<span class='line'>4556</span> </span><span class="WHIT">		</span><span class="NAME">this.keyNav.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4557</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">'Focus'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4558</span> </span><span class="WHIT">		</span><span class="COMM">// Not sure why but this borks Safari</span><span class="WHIT">
<span class='line'>4559</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.browser.SAFARI</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4560</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4561</span> </span><span class="WHIT">			</span><span class="NAME">nitobi.html.cancelEvent</span><span class="PUNC">(</span><span class="NAME">nitobi.html.Event</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4562</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4563</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4564</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4565</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4566</span> </span><span class="WHIT">		</span><span class="COMM">// Only wrapping this in a try-catch because of the firefox bug for focus()</span><span class="WHIT">
<span class='line'>4567</span> </span><span class="WHIT">		</span><span class="COMM">// https://bugzilla.mozilla.org/show_bug.cgi?id=236791</span><span class="WHIT">
<span class='line'>4568</span> </span><span class="WHIT">		</span><span class="COMM">// (Wrapping it seems to do nothing)</span><span class="WHIT">
<span class='line'>4569</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4570</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4571</span> 
<span class='line'>4572</span> </span><span class="COMM">/**
<span class='line'>4573</span>  * Blurs the Grid removing any selection or row highlights.
<span class='line'>4574</span>  * @see nitobi.grid.Grid#OnBlurEvent
<span class='line'>4575</span>  */</span><span class="WHIT">
<span class='line'>4576</span> </span><span class="NAME">ntb_gridp.blur</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4577</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4578</span> </span><span class="WHIT">	</span><span class="COMM">//	This clears the grid selection and row highlights</span><span class="WHIT">
<span class='line'>4579</span> 
<span class='line'>4580</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: call something like blurActiveRow as well so that the row blur events are called </span><span class="WHIT">
<span class='line'>4581</span> </span><span class="WHIT">	</span><span class="COMM">// and that should also clear the active rows</span><span class="WHIT">
<span class='line'>4582</span> 
<span class='line'>4583</span> </span><span class="WHIT">	</span><span class="COMM">// Clear the row highlights</span><span class="WHIT">
<span class='line'>4584</span> </span><span class="WHIT">	</span><span class="NAME">this.clearActiveRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4585</span> </span><span class="WHIT">	</span><span class="COMM">// Clear the selection</span><span class="WHIT">
<span class='line'>4586</span> </span><span class="WHIT">	</span><span class="NAME">this.selection.clear</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4587</span> </span><span class="WHIT">	</span><span class="COMM">// Blur the active cell</span><span class="WHIT">
<span class='line'>4588</span> </span><span class="WHIT">	</span><span class="NAME">this.blurActiveCell</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4589</span> </span><span class="WHIT">	</span><span class="COMM">// Set the activeCell to null</span><span class="WHIT">
<span class='line'>4590</span> </span><span class="WHIT">	</span><span class="NAME">this.activateCell</span><span class="PUNC">(</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4591</span> 
<span class='line'>4592</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">'Blur'</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4593</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4594</span> 
<span class='line'>4595</span> </span><span class="COMM">/**
<span class='line'>4596</span>  * @deprecated
<span class='line'>4597</span>  * @private
<span class='line'>4598</span>  */</span><span class="WHIT">
<span class='line'>4599</span> </span><span class="NAME">ntb_gridp.getRendererForColumn</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4600</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4601</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NAME">columnCount</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4602</span> </span><span class="WHIT">		</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnCount</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4603</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">frozeneft</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4604</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">frozenLeft</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4605</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.MidLeftRenderer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4606</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4607</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.MidCenterRenderer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4608</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4609</span> 
<span class='line'>4610</span> </span><span class="COMM">/**
<span class='line'>4611</span>  * @private
<span class='line'>4612</span>  */</span><span class="WHIT">
<span class='line'>4613</span> </span><span class="NAME">ntb_gridp.getColumnOuterTemplate</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4614</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getRendererForColumn</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">xmlTemplate.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"//*[@match='ntb:e']/div/div["</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">+</span><span class="STRN">"]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4615</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4616</span> 
<span class='line'>4617</span> </span><span class="COMM">/**
<span class='line'>4618</span>  * @private
<span class='line'>4619</span>  */</span><span class="WHIT">
<span class='line'>4620</span> </span><span class="NAME">ntb_gridp.getColumnInnerTemplate</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4621</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getColumnOuterXslTemplate</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"*[2]"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4622</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4623</span> 
<span class='line'>4624</span> </span><span class="COMM">/**
<span class='line'>4625</span>  * Pre-generates the XSL templates for rendering data in the Grid. This is required when changes to the data structure in the 
<span class='line'>4626</span>  * DataTable are made and is called from the bind() method if required.
<span class='line'>4627</span>  * @private
<span class='line'>4628</span>  */</span><span class="WHIT">
<span class='line'>4629</span> </span><span class="NAME">ntb_gridp.makeXSL</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4630</span> 
<span class='line'>4631</span> </span><span class="WHIT">	</span><span class="COMM">//	makeXSL impacts the number of columns that are generated for the rowXsl ...</span><span class="WHIT">
<span class='line'>4632</span> 
<span class='line'>4633</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4634</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4635</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rh</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.isRowHighlightEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4636</span> 
<span class='line'>4637</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">'_default'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4638</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.datatable</span><span class="PUNC">!=</span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4639</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4640</span> </span><span class="WHIT">		</span><span class="NAME">dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable.id</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4641</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4642</span> 
<span class='line'>4643</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: tighten this up.</span><span class="WHIT">
<span class='line'>4644</span> 
<span class='line'>4645</span> </span><span class="WHIT">	</span><span class="COMM">// Top Left Corner</span><span class="WHIT">
<span class='line'>4646</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4647</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4648</span> 
<span class='line'>4649</span> </span><span class="WHIT">	</span><span class="COMM">// Take anything that is in the column definitions and encode the & character and double encode any</span><span class="WHIT">
<span class='line'>4650</span> </span><span class="WHIT">	</span><span class="COMM">// not sure what those # signs are for but probably something in nitobi.xml.parseHtml</span><span class="WHIT">
<span class='line'>4651</span> </span><span class="COMM">//	var sXml = nitobi.xml.serialize(this.model.selectSingleNode('state/nitobi.grid.Columns')).replace(/\#\&lt\;\#/g,"#&lt;#").replace(/\#\&gt\;\#/g,"#>#").replace(/\#\&eq\;\#/g,"#=#").replace(/\#\&quot\;\#/g,"#\"#").replace(/\&/g,"&amp;").replace(/\#&lt;\#/g,"&lt;").replace(/\#>\#/g,"&gt;").replace(/\#=\#/g,"&eq;").replace(/\#\"\#/g,"&quot;");</span><span class="WHIT">
<span class='line'>4652</span> 
<span class='line'>4653</span> </span><span class="WHIT">	</span><span class="COMM">// Need to make sure that we don't accidentally have double escaped XSLT statemtents ...</span><span class="WHIT">
<span class='line'>4654</span> </span><span class="COMM">//	sXml = sXml.replace(/(\&amp;lt;xsl\:)(.*?)(\/&amp;gt;)/g, function() {return "&lt;xsl:"+arguments[2].replace(/\&amp;/g, "&")+"/&gt;";});</span><span class="WHIT">
<span class='line'>4655</span> 
<span class='line'>4656</span> </span><span class="COMM">//	if (this.oldColDefs != sXml)</span><span class="WHIT">
<span class='line'>4657</span> </span><span class="COMM">//	{</span><span class="WHIT">
<span class='line'>4658</span> </span><span class="COMM">//		this.oldColDefs = sXml;</span><span class="WHIT">
<span class='line'>4659</span> 
<span class='line'>4660</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colDefs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">'state/nitobi.grid.Columns'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4661</span> </span><span class="WHIT">		</span><span class="NAME">this.TopLeftRenderer.generateXslTemplate</span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startColumn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">columns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isColumnIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isRowIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">rh</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isToolTipsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4662</span> </span><span class="WHIT">		</span><span class="NAME">this.TopLeftRenderer.dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTableId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4663</span> 
<span class='line'>4664</span> </span><span class="WHIT">		</span><span class="COMM">// Top Center</span><span class="WHIT">
<span class='line'>4665</span> </span><span class="WHIT">		</span><span class="NAME">startColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4666</span> </span><span class="WHIT">		</span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cs</span><span class="PUNC">-</span><span class="NAME">fL</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4667</span> </span><span class="WHIT">		</span><span class="NAME">this.TopCenterRenderer.generateXslTemplate</span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startColumn</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isColumnIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">this.isRowIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">rh</span><span class="PUNC">,</span><span class="NAME">this.isToolTipsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4668</span> </span><span class="WHIT">		</span><span class="NAME">this.TopCenterRenderer.dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTableId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4669</span> 
<span class='line'>4670</span> </span><span class="WHIT">		</span><span class="COMM">// Left</span><span class="WHIT">
<span class='line'>4671</span> </span><span class="WHIT">		</span><span class="NAME">this.MidLeftRenderer.generateXslTemplate</span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.isRowIndicatorsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">rh</span><span class="PUNC">,</span><span class="NAME">this.isToolTipsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="STRN">"left"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4672</span> </span><span class="WHIT">		</span><span class="NAME">this.MidLeftRenderer.dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTableId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4673</span> 
<span class='line'>4674</span> </span><span class="WHIT">		</span><span class="COMM">// Center</span><span class="WHIT">
<span class='line'>4675</span> </span><span class="WHIT">		</span><span class="NAME">this.MidCenterRenderer.generateXslTemplate</span><span class="PUNC">(</span><span class="NAME">colDefs</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">fL</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cs</span><span class="PUNC">-</span><span class="NAME">fL</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">rh</span><span class="PUNC">,</span><span class="NAME">this.isToolTipsEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4676</span> </span><span class="WHIT">		</span><span class="NAME">this.MidCenterRenderer.dataTableId</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">dataTableId</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4677</span> </span><span class="COMM">//	}</span><span class="WHIT">
<span class='line'>4678</span> 
<span class='line'>4679</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterMakeXsl"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4680</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4681</span> 
<span class='line'>4682</span> </span><span class="COMM">/**
<span class='line'>4683</span>  * Renders the data in the Grid. This differs from &lt;code>refresh()&lt;/code> 
<span class='line'>4684</span>  * in that refresh will re-retrieve the data from the server as well as 
<span class='line'>4685</span>  * re-render the data.
<span class='line'>4686</span>  */</span><span class="WHIT">
<span class='line'>4687</span> </span><span class="NAME">ntb_gridp.render</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4688</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4689</span> </span><span class="WHIT">	</span><span class="COMM">// This will clear the surfaces and remove any selections ... this might have to be done</span><span class="WHIT">
<span class='line'>4690</span> </span><span class="WHIT">	</span><span class="NAME">this.generateCss</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4691</span> </span><span class="WHIT">	</span><span class="NAME">this.updateCellRanges</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4692</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4693</span> 
<span class='line'>4694</span> </span><span class="COMM">/**
<span class='line'>4695</span>  * @ignore
<span class='line'>4696</span>  */</span><span class="WHIT">
<span class='line'>4697</span> </span><span class="NAME">ntb_gridp.refilter</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ntb_gridp.render</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4698</span> 
<span class='line'>4699</span> </span><span class="COMM">/**
<span class='line'>4700</span>  * Returns an XmlElementList containing the definitions of the columns in the Grid. The column definitions are the XML serialization of the nitobi.components.grid.Column objects.
<span class='line'>4701</span>  * @private
<span class='line'>4702</span>  * @type XMLNodeList
<span class='line'>4703</span>  */</span><span class="WHIT">
<span class='line'>4704</span> </span><span class="NAME">ntb_gridp.getColumnDefinitions</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4705</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4706</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.model.selectNodes</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns/*"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4707</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4708</span> 
<span class='line'>4709</span> </span><span class="COMM">/**
<span class='line'>4710</span>  * Returns an XmlElementList containing the definitions of the columns in the Grid that are visible. The column definitions are the XML serialization of the nitobi.components.grid.Column objects.
<span class='line'>4711</span>  * @private
<span class='line'>4712</span>  * @type XMLNodeList
<span class='line'>4713</span>  */</span><span class="WHIT">
<span class='line'>4714</span> </span><span class="NAME">ntb_gridp.getVisibleColumnDefinitions</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4715</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4716</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.model.selectNodes</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns/*[@Visible='1']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4717</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4718</span> 
<span class='line'>4719</span> </span><span class="COMM">/**
<span class='line'>4720</span>  * Initializes the Model from the values in the API XML.
<span class='line'>4721</span>  * @private
<span class='line'>4722</span>  */</span><span class="WHIT">
<span class='line'>4723</span> </span><span class="NAME">ntb_gridp.initializeModelFromDeclaration</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4724</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4725</span> </span><span class="WHIT">	</span><span class="COMM">// Iterate over the attributes on the declaration and call each attributes setter</span><span class="WHIT">
<span class='line'>4726</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.Declaration.grid.documentElement.attributes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4727</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attributes.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4728</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;</span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4729</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">attribute</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">attributes</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4730</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.properties</span><span class="PUNC">[</span><span class="NAME">attribute.nodeName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4731</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">property</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4732</span> </span><span class="WHIT">			</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="STRN">"set"</span><span class="PUNC">+</span><span class="NAME">property.n</span><span class="PUNC">]</span><span class="PUNC">(</span><span class="NAME">attribute.nodeValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4733</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4734</span> 
<span class='line'>4735</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: these are being re-set cause they are overwritten from the delcaration to model copy ...</span><span class="WHIT">
<span class='line'>4736</span> </span><span class="WHIT">	</span><span class="NAME">this.model.documentElement.setAttribute</span><span class="PUNC">(</span><span class="STRN">"ID"</span><span class="PUNC">,</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4737</span> </span><span class="WHIT">	</span><span class="NAME">this.model.documentElement.setAttribute</span><span class="PUNC">(</span><span class="STRN">"uniqueID"</span><span class="PUNC">,</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4738</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4739</span> 
<span class='line'>4740</span> </span><span class="COMM">/**
<span class='line'>4741</span>  * Sets the default values for a column declaration in the model.
<span class='line'>4742</span>  * @private
<span class='line'>4743</span>  */</span><span class="WHIT">
<span class='line'>4744</span> </span><span class="NAME">ntb_gridp.setModelValues</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xModelNode</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xDeclarationNode</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4745</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4746</span> </span><span class="WHIT">	</span><span class="COMM">// For the declaration node iterate over the attributes and try to find corresponding </span><span class="WHIT">
<span class='line'>4747</span> </span><span class="WHIT">	</span><span class="COMM">// attributes in the xColumnProps hash for the column, the specific column type, and the editor.</span><span class="WHIT">
<span class='line'>4748</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnDataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xModelNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">"DataType"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4749</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnEditorType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xModelNode.getAttribute</span><span class="PUNC">(</span><span class="STRN">"type"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4750</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4751</span> </span><span class="WHIT">	</span><span class="COMM">// First do the column and specific column type</span><span class="WHIT">
<span class='line'>4752</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnProperties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xDeclarationNode.attributes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4753</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">columnProperties.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4754</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4755</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnProperties</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4756</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property.nodeName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4757</span> </span><span class="WHIT">		</span><span class="COMM">// Match the declaration attribute name on the JS hash of lowercase attribute names to property metadata.</span><span class="WHIT">
<span class='line'>4758</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyMeta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xColumnProperties</span><span class="PUNC">[</span><span class="NAME">columnDataType</span><span class="PUNC">+</span><span class="STRN">"column"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">propertyName</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">this.xColumnProperties</span><span class="PUNC">[</span><span class="STRN">"column"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">propertyName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4759</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property.nodeValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4760</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">propertyMeta.t</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"b"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4761</span> </span><span class="WHIT">			</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.boolToStr</span><span class="PUNC">(</span><span class="NAME">nitobi.lang.toBool</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4762</span> </span><span class="WHIT">		</span><span class="NAME">xModelNode.setAttribute</span><span class="PUNC">(</span><span class="NAME">propertyMeta.n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4763</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4764</span> 
<span class='line'>4765</span> </span><span class="WHIT">	</span><span class="COMM">// Now do the editor</span><span class="WHIT">
<span class='line'>4766</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">editorNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">xDeclarationNode.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"./ntb:"</span><span class="PUNC">+</span><span class="NAME">columnEditorType</span><span class="PUNC">+</span><span class="STRN">"editor"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4767</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">editorNode</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4768</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4769</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">editorProperties</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">editorNode.attributes</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4770</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">editorProperties.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">j</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4771</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4772</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">property</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">editorProperties</span><span class="PUNC">[</span><span class="NAME">j</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4773</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property.nodeName.toLowerCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4774</span> </span><span class="WHIT">		</span><span class="COMM">// Match the declaration attribute name on the JS hash of lowercase attribute names to property metadata.</span><span class="WHIT">
<span class='line'>4775</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">propertyMeta</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.xColumnProperties</span><span class="PUNC">[</span><span class="NAME">columnEditorType</span><span class="PUNC">+</span><span class="STRN">"editor"</span><span class="PUNC">]</span><span class="PUNC">[</span><span class="NAME">propertyName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4776</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">property.nodeValue</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4777</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">propertyMeta.t</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"b"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4778</span> </span><span class="WHIT">			</span><span class="NAME">value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.boolToStr</span><span class="PUNC">(</span><span class="NAME">nitobi.lang.toBool</span><span class="PUNC">(</span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4779</span> </span><span class="WHIT">		</span><span class="NAME">xModelNode.setAttribute</span><span class="PUNC">(</span><span class="NAME">propertyMeta.n</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4780</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4781</span> 
<span class='line'>4782</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4783</span> 
<span class='line'>4784</span> </span><span class="COMM">/**
<span class='line'>4785</span>  * Creates a new Key for a record in the Grid. This is the default Key generation.
<span class='line'>4786</span>  * @private
<span class='line'>4787</span>  * @type String
<span class='line'>4788</span>  */</span><span class="WHIT">
<span class='line'>4789</span> </span><span class="NAME">ntb_gridp.getNewRecordKey</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4790</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4791</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">today</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4792</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4793</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xNode</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4794</span> </span><span class="WHIT">	</span><span class="COMM">// Keep trying to select a key until one is unique.</span><span class="WHIT">
<span class='line'>4795</span> </span><span class="WHIT">	</span><span class="KEYW">do</span><span class="WHIT">
<span class='line'>4796</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4797</span> </span><span class="WHIT">		</span><span class="NAME">today</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4798</span> </span><span class="WHIT">		</span><span class="NAME">key</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">today.getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="STRN">"."</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">Math.round</span><span class="PUNC">(</span><span class="NAME">Math.random</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">*</span><span class="NUMB">99</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4799</span> </span><span class="WHIT">		</span><span class="COMM">//TODO: This should be fixed ...</span><span class="WHIT">
<span class='line'>4800</span> </span><span class="WHIT">		</span><span class="NAME">xNode</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable.xmlDoc.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">'//'</span><span class="PUNC">+</span><span class="NAME">nitobi.xml.nsPrefix</span><span class="PUNC">+</span><span class="STRN">'e[@xk = \''</span><span class="PUNC">+</span><span class="NAME">key</span><span class="PUNC">+</span><span class="STRN">'\']'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4801</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">while</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">xNode</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4802</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4803</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4804</span> 
<span class='line'>4805</span> </span><span class="COMM">/**
<span class='line'>4806</span>  * Inserts a blank row into the Grid after the row to which the active cell belongs.
<span class='line'>4807</span>  */</span><span class="WHIT">
<span class='line'>4808</span> </span><span class="NAME">ntb_gridp.insertAfterCurrentRow</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4809</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4810</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4811</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4812</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4813</span> </span><span class="WHIT">		</span><span class="NAME">this.insertRow</span><span class="PUNC">(</span><span class="NAME">rowNumber</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4814</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4815</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4816</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4817</span> </span><span class="WHIT">		</span><span class="NAME">this.insertRow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4818</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4819</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4820</span> 
<span class='line'>4821</span> </span><span class="COMM">/**
<span class='line'>4822</span>  * Adds a new row of data to the grid.
<span class='line'>4823</span>  * &lt;P>Rows can also be inserted by the user by pressing the 
<span class='line'>4824</span>  * Insert key or by clicking on the toolbar icon.
<span class='line'>4825</span>  * &lt;/P>
<span class='line'>4826</span>  * &lt;P>When rows are 
<span class='line'>4827</span>  * added to the grid, a new XML row node is added to the XML datasource.
<span class='line'>4828</span>  * In addition, a new node is added to the XML updategram which 
<span class='line'>4829</span>  * will be transmitted back to the server when the data is saved.
<span class='line'>4830</span>  * &lt;/P>
<span class='line'>4831</span>  * @param {Number} rowIndex A row will be inserted after the row at this index
<span class='line'>4832</span>  */</span><span class="WHIT">
<span class='line'>4833</span> </span><span class="NAME">ntb_gridp.insertRow</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rowIndex</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4834</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4835</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">this.getDisplayedRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4836</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4837</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowIndex</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4838</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4839</span> </span><span class="WHIT">		</span><span class="NAME">xi</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="PUNC">(</span><span class="NAME">rowIndex</span><span class="PUNC">==</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">rowIndex</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4840</span> </span><span class="WHIT">		</span><span class="NAME">xi</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4841</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4842</span> 
<span class='line'>4843</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeRowInsertEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.getRowObject</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4844</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isRowInsertEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeRowInsert"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4845</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4846</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4847</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4848</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: wrap this call to the model.</span><span class="WHIT">
<span class='line'>4849</span> </span><span class="WHIT">	</span><span class="COMM">// Add initial values to the default row before sending it to the datasource.</span><span class="WHIT">
<span class='line'>4850</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">defaultRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.datatable.getTemplateNode</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4851</span> 
<span class='line'>4852</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.columnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4853</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4854</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4855</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">initialValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnObject.getInitial</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4856</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">initialValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">initialValue</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4857</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4858</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnObject.getDataType</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4859</span> </span><span class="WHIT">			</span><span class="COMM">// TODO: This is a temp fix for moz. DataType isn;t set correctly for some reason.</span><span class="WHIT">
<span class='line'>4860</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4861</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4862</span> </span><span class="WHIT">				</span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">"text"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4863</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4864</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataType</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4865</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4866</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"text"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4867</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4868</span> </span><span class="WHIT">					</span><span class="NAME">initialValue</span><span class="PUNC">=</span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4869</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4870</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4871</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4872</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4873</span> </span><span class="WHIT">					</span><span class="NAME">initialValue</span><span class="PUNC">=</span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4874</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4875</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4876</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"date"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>4877</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4878</span> </span><span class="WHIT">					</span><span class="NAME">initialValue</span><span class="PUNC">=</span><span class="STRN">"1900-01-01"</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4879</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4880</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4881</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4882</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4883</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">att</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">columnObject.getxdatafld</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4884</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">att</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">att</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4885</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4886</span> </span><span class="WHIT">			</span><span class="NAME">defaultRow.setAttribute</span><span class="PUNC">(</span><span class="NAME">att</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">initialValue</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4887</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4888</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4889</span> </span><span class="WHIT">	</span><span class="NAME">this.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4890</span> 
<span class='line'>4891</span> </span><span class="WHIT">	</span><span class="NAME">this.datatable.createRecord</span><span class="PUNC">(</span><span class="NAME">defaultRow</span><span class="PUNC">,</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4892</span> 
<span class='line'>4893</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: should this be setRowCount instead?</span><span class="WHIT">
<span class='line'>4894</span> </span><span class="COMM">//	rows++;</span><span class="WHIT">
<span class='line'>4895</span> </span><span class="COMM">//	this.setDisplayedRowCount(rows);</span><span class="WHIT">
<span class='line'>4896</span> 
<span class='line'>4897</span> </span><span class="WHIT">	</span><span class="COMM">//QUESTION: When a row is added what happens if the grid is sorted??? the item should be inserted at the cursor and that is it.</span><span class="WHIT">
<span class='line'>4898</span> </span><span class="WHIT">	</span><span class="COMM">//TODO: refilter should not be called ... we need to do this ajax styles</span><span class="WHIT">
<span class='line'>4899</span> 
<span class='line'>4900</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.handleAfterRowInsert</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">xi</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4901</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4902</span> 
<span class='line'>4903</span> </span><span class="COMM">/**
<span class='line'>4904</span>  * Event handler that is fired when after a row is inserted into the Grid and (if autosave is enabled) the data is saved to the server. 
<span class='line'>4905</span>  * Fires the &lt;code>AfterRowInsert&lt;/code> event
<span class='line'>4906</span>  * @param {Number} xi The index of the inserted row.
<span class='line'>4907</span>  * @private
<span class='line'>4908</span>  */</span><span class="WHIT">
<span class='line'>4909</span> </span><span class="NAME">ntb_gridp.handleAfterRowInsert</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4910</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4911</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterRowInsert"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnAfterRowInsertEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.getRowObject</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4912</span> </span><span class="WHIT">	</span><span class="NAME">this.setActiveCell</span><span class="PUNC">(</span><span class="NAME">this.getCellElement</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4913</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4914</span> </span><span class="COMM">/**
<span class='line'>4915</span>  * Deletes the row to which the currently active cell belongs.
<span class='line'>4916</span>  * @see #deleteRow
<span class='line'>4917</span>  */</span><span class="WHIT">
<span class='line'>4918</span> </span><span class="NAME">ntb_gridp.deleteCurrentRow</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4919</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4920</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4921</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4922</span> </span><span class="WHIT">		</span><span class="NAME">this.deleteRow</span><span class="PUNC">(</span><span class="NAME">nitobi.grid.Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4923</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4924</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>4925</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4926</span> </span><span class="WHIT">		</span><span class="NAME">alert</span><span class="PUNC">(</span><span class="STRN">"First select a record to delete."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4927</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4928</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4929</span> </span><span class="COMM">/**
<span class='line'>4930</span>  * Deletes the currently selected rows
<span class='line'>4931</span>  * @see nitobi.grid.Grid#deleteRow
<span class='line'>4932</span>  */</span><span class="WHIT">
<span class='line'>4933</span> </span><span class="NAME">ntb_gridp.deleteSelectedRows</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4934</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4935</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeRowDeleteEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.getSelectedRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4936</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isRowDeleteEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeRowDelete"</span><span class="PUNC">,</span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4937</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4938</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4939</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4940</span> 
<span class='line'>4941</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selectedRows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelectedRows</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4942</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4943</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">xiList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4944</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">row</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">selectedRows</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4945</span> </span><span class="WHIT">		</span><span class="NAME">xiList.push</span><span class="PUNC">(</span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">selectedRows</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">'xi'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4946</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4947</span> </span><span class="WHIT">	</span><span class="NAME">xiList.sort</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">a</span><span class="PUNC">,</span><span class="NAME">b</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">a</span><span class="PUNC">-</span><span class="NAME">b</span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4948</span> </span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>4949</span> </span><span class="WHIT">	</span><span class="NAME">this.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4950</span> 
<span class='line'>4951</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDisplayedRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4952</span> 
<span class='line'>4953</span> </span><span class="WHIT">	</span><span class="COMM">// deleteRecord can throw an exception, which stops grid being repopulated (after this.clearSurfaces())</span><span class="WHIT">
<span class='line'>4954</span> </span><span class="WHIT">	</span><span class="COMM">// now exception is caught, and grid display is restored</span><span class="WHIT">
<span class='line'>4955</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>4956</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.deleteRecordsArray</span><span class="PUNC">(</span><span class="NAME">xiList</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4957</span> 
<span class='line'>4958</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: should this be set here since it will be updated by the RowCountChanged event from the DataTable.</span><span class="WHIT">
<span class='line'>4959</span> </span><span class="WHIT">		</span><span class="COMM">// Should we be calling setRowCount???</span><span class="WHIT">
<span class='line'>4960</span> </span><span class="WHIT">		</span><span class="COMM">// rows--;</span><span class="WHIT">
<span class='line'>4961</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4962</span> </span><span class="WHIT">			</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4963</span> 
<span class='line'>4964</span> </span><span class="WHIT">		</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.handleAfterRowDelete</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">xiList</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4965</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4966</span> </span><span class="WHIT">		</span><span class="NAME">this.dataBind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4967</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4968</span> 
<span class='line'>4969</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>4970</span> </span><span class="COMM">/**
<span class='line'>4971</span>  * Deletes the row containing the cell referenced by the activeCell property.
<span class='line'>4972</span>  * &lt;P>When rows are deleted from the grid, the corresponding XML record 
<span class='line'>4973</span>  * node is also deleted from the bound DataTable.&lt;/P>&lt;P>An XML updategram is 
<span class='line'>4974</span>  * created by the DataTable when a row is deleted. This updategram is sent to the 
<span class='line'>4975</span>  * server when the save() method is called to instruct the server to delete the 
<span class='line'>4976</span>  * corresponding record from the database.&lt;/P>&lt;P>Rows may also be deleted by pressing 
<span class='line'>4977</span>  * the Delete key or by clicking on the toolbar Delete icon.&lt;/P>
<span class='line'>4978</span>  * &lt;p>
<span class='line'>4979</span>  * &lt;b>Example&lt;/b>
<span class='line'>4980</span>  * &lt;/p>
<span class='line'>4981</span>  * &lt;div class="code">
<span class='line'>4982</span>  * &lt;pre>&lt;code class="javascript">
<span class='line'>4983</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>4984</span>  * grid.deleteRow(3);	// deletes the 4th row
<span class='line'>4985</span>  * &lt;/code>&lt;/pre>
<span class='line'>4986</span>  * &lt;/div>
<span class='line'>4987</span>  * @param {Number} index Index of the row to delete, indexed from 0.
<span class='line'>4988</span>  * @see #deleteAfterCurrentRow
<span class='line'>4989</span>  * @see #OnBeforeDeleteEvent
<span class='line'>4990</span>  * @see #OnAfterDeleteEvent
<span class='line'>4991</span>  */</span><span class="WHIT">
<span class='line'>4992</span> </span><span class="NAME">ntb_gridp.deleteRow</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>4993</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>4994</span> </span><span class="WHIT">	</span><span class="COMM">// do something for when onbeforedelete is not defined</span><span class="WHIT">
<span class='line'>4995</span> </span><span class="WHIT">	</span><span class="COMM">//HACK fix this somehow</span><span class="WHIT">
<span class='line'>4996</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">>=</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"Must specify a row to delete."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4997</span> 
<span class='line'>4998</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeRowDeleteEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.getRowObject</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>4999</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isRowDeleteEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeRowDelete"</span><span class="PUNC">,</span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5000</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5001</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5002</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5003</span> 
<span class='line'>5004</span> </span><span class="WHIT">	</span><span class="NAME">this.clearSurfaces</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5005</span> 
<span class='line'>5006</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDisplayedRowCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5007</span> 
<span class='line'>5008</span> </span><span class="WHIT">	</span><span class="COMM">// deleteRecord can throw an exception, which stops grid being repopulated (after this.clearSurfaces())</span><span class="WHIT">
<span class='line'>5009</span> </span><span class="WHIT">	</span><span class="COMM">// now exception is caught, and grid display is restored</span><span class="WHIT">
<span class='line'>5010</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5011</span> </span><span class="WHIT">		</span><span class="NAME">this.datatable.deleteRecord</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5012</span> 
<span class='line'>5013</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: should this be set here since it will be updated by the RowCountChanged event from the DataTable.</span><span class="WHIT">
<span class='line'>5014</span> </span><span class="WHIT">		</span><span class="COMM">// Should we be calling setRowCount???</span><span class="WHIT">
<span class='line'>5015</span> </span><span class="WHIT">		</span><span class="NAME">rows</span><span class="PUNC">--</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5016</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rows</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5017</span> </span><span class="WHIT">			</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5018</span> </span><span class="WHIT">	</span><span class="COMM">//	this.setDisplayedRowCount(rows);</span><span class="WHIT">
<span class='line'>5019</span> 
<span class='line'>5020</span> </span><span class="WHIT">		</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.handleAfterRowDelete</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5021</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5022</span> </span><span class="WHIT">		</span><span class="NAME">this.dataBind</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5023</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5024</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5025</span> 
<span class='line'>5026</span> </span><span class="COMM">/**
<span class='line'>5027</span>  * Event handler that is fired when after a row is deleted from the Grid and (if autosave is enabled) the data is deleted on the server.
<span class='line'>5028</span>  * Fires the &lt;code>AfterRowDelete&lt;/code> event
<span class='line'>5029</span>  * @param {Number} xi The index of the deleted row.
<span class='line'>5030</span>  * @private
<span class='line'>5031</span>  */</span><span class="WHIT">
<span class='line'>5032</span> </span><span class="NAME">ntb_gridp.handleAfterRowDelete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5033</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5034</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterRowDelete"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnBeforeRowDeleteEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">this.getRowObject</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5035</span> </span><span class="WHIT">	</span><span class="NAME">this.setActiveCell</span><span class="PUNC">(</span><span class="NAME">this.getCellElement</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5036</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5037</span> 
<span class='line'>5038</span> </span><span class="COMM">/**
<span class='line'>5039</span>  * @private
<span class='line'>5040</span>  */</span><span class="WHIT">
<span class='line'>5041</span> </span><span class="NAME">ntb_gridp.page</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dir</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5042</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5043</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5044</span> 
<span class='line'>5045</span> </span><span class="COMM">/**
<span class='line'>5046</span>  * Moves the active cell by the relative amounts specified by the 
<span class='line'>5047</span>  * horizontal and vertical arguments.
<span class='line'>5048</span>  * &lt;p>
<span class='line'>5049</span>  * &lt;b>Example&lt;/b>
<span class='line'>5050</span>  * &lt;/p>
<span class='line'>5051</span>  * &lt;div class="code">
<span class='line'>5052</span>  * &lt;pre>&lt;code class="">
<span class='line'>5053</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>5054</span>  * grid.setPosition(0,0);
<span class='line'>5055</span>  * grid.move(1,3);  // Now the cell at row 1 and column 3 is selected
<span class='line'>5056</span>  * &lt;/code>&lt;/pre>
<span class='line'>5057</span>  * &lt;/div>
<span class='line'>5058</span>  * @param {Number} h The number of cells to move the active cell by in the horizontal direction.
<span class='line'>5059</span>  * @param {Number} v The number of cells to move the active cell by in the vertical direction.
<span class='line'>5060</span>  */</span><span class="WHIT">
<span class='line'>5061</span> </span><span class="NAME">ntb_gridp.move</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">,</span><span class="NAME">v</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5062</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5063</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5064</span> </span><span class="WHIT">		</span><span class="COMM">// Get reference to cellObject</span><span class="WHIT">
<span class='line'>5065</span> </span><span class="WHIT">		</span><span class="COMM">// Going Right or Down .... (Easy)</span><span class="WHIT">
<span class='line'>5066</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">hs</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5067</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">vs</span><span class="PUNC">=</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5068</span> 
<span class='line'>5069</span> </span><span class="WHIT">		</span><span class="NAME">h</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">h</span><span class="PUNC">*</span><span class="NAME">hs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5070</span> </span><span class="WHIT">		</span><span class="NAME">v</span><span class="PUNC">=</span><span class="PUNC">(</span><span class="NAME">v</span><span class="PUNC">*</span><span class="NAME">vs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5071</span> 
<span class='line'>5072</span> </span><span class="WHIT">		</span><span class="COMM">// Get the activeCell object</span><span class="WHIT">
<span class='line'>5073</span> </span><span class="WHIT">		</span><span class="COMM">// add the h and v to the coords.</span><span class="WHIT">
<span class='line'>5074</span> </span><span class="WHIT">		</span><span class="COMM">// select the new cell.</span><span class="WHIT">
<span class='line'>5075</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell</span><span class="WHIT">
<span class='line'>5076</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">colNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5077</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowNumber</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5078</span> </span><span class="WHIT">		</span><span class="COMM">// Select the new activeCell</span><span class="WHIT">
<span class='line'>5079</span> </span><span class="WHIT">		</span><span class="NAME">this.selectCellByCoords</span><span class="PUNC">(</span><span class="NAME">rowNumber</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">v</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">colNumber</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">h</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5080</span> 
<span class='line'>5081</span> </span><span class="WHIT">		</span><span class="COMM">// Check if we have hit the start or end of the row.</span><span class="WHIT">
<span class='line'>5082</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evtArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.CellEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5083</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colNumber</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NAME">this.getVisibleColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5084</span> </span><span class="WHIT">			</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HitRowEnd"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evtArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5085</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">colNumber</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">h</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5086</span> </span><span class="WHIT">			</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HitRowStart"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">evtArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5087</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5088</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5089</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5090</span> 
<span class='line'>5091</span> </span><span class="COMM">/**
<span class='line'>5092</span>  * @private
<span class='line'>5093</span>  * Called from the selection mouseup event handler. This gets fired when the user clicks on a grid cell and
<span class='line'>5094</span>  * the selection is moved under the mouse before the mouseup event fires - which occurs on the selection.
<span class='line'>5095</span>  */</span><span class="WHIT">
<span class='line'>5096</span> </span><span class="NAME">ntb_gridp.handleSelectionMouseUp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5097</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5098</span> </span><span class="WHIT">	</span><span class="COMM">// If the mouseup was fired during a grid cell click event then ensure the cell is in view</span><span class="WHIT">
<span class='line'>5099</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isCellClicked</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5100</span> </span><span class="WHIT">		</span><span class="NAME">this.ensureCellInView</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5101</span> </span><span class="WHIT">	</span><span class="NAME">this.setCellClicked</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5102</span> 
<span class='line'>5103</span> </span><span class="WHIT">	</span><span class="COMM">// If we are in single click mode</span><span class="WHIT">
<span class='line'>5104</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.isSingleClickEditEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5105</span> </span><span class="WHIT">		</span><span class="NAME">this.edit</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5106</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="COMM">// Safari needs this focus otherwise the selection gets the focus (and even then not really)</span><span class="WHIT">
<span class='line'>5107</span> </span><span class="WHIT">		</span><span class="NAME">this.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5108</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5109</span> 
<span class='line'>5110</span> </span><span class="COMM">/**
<span class='line'>5111</span>  * Loads the next page of data.  Only available if the Grid is in standard
<span class='line'>5112</span>  * paging mode.
<span class='line'>5113</span>  */</span><span class="WHIT">
<span class='line'>5114</span> </span><span class="NAME">ntb_gridp.loadNextDataPage</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5115</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5116</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: refactor this into the proper grid class</span><span class="WHIT">
<span class='line'>5117</span> </span><span class="WHIT">	</span><span class="COMM">//	TODO: scroll back to the top of the grid if we are in standard paging mode</span><span class="WHIT">
<span class='line'>5118</span> </span><span class="WHIT">	</span><span class="NAME">this.loadDataPage</span><span class="PUNC">(</span><span class="NAME">this.getCurrentPageIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">+</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5119</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5120</span> 
<span class='line'>5121</span> </span><span class="COMM">/**
<span class='line'>5122</span>  * Loads the previous page of data.  Only available if the Grid is in standard
<span class='line'>5123</span>  * paging mode.
<span class='line'>5124</span>  */</span><span class="WHIT">
<span class='line'>5125</span> </span><span class="NAME">ntb_gridp.loadPreviousDataPage</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5126</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5127</span> </span><span class="WHIT">	</span><span class="NAME">this.loadDataPage</span><span class="PUNC">(</span><span class="NAME">this.getCurrentPageIndex</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5128</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5129</span> 
<span class='line'>5130</span> </span><span class="COMM">/**
<span class='line'>5131</span>  * @deprecated
<span class='line'>5132</span>  * @private
<span class='line'>5133</span>  */</span><span class="WHIT">
<span class='line'>5134</span> </span><span class="NAME">ntb_gridp.GetPage</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">functionReplacedByLowercasegetPage</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5135</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5136</span> </span><span class="WHIT">	</span><span class="NAME">ebaErrorReport</span><span class="PUNC">(</span><span class="STRN">"GetPage is deprecated please use loadDataPage instead"</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">,</span><span class="NAME">EBA_DEBUG</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5137</span> </span><span class="WHIT">	</span><span class="NAME">this.loadDataPage</span><span class="PUNC">(</span><span class="NAME">functionReplacedByLowercasegetPage</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5138</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5139</span> 
<span class='line'>5140</span> </span><span class="COMM">/**
<span class='line'>5141</span>  * Loads the specified page of data from the server and displays it. 
<span class='line'>5142</span>  * Since the server request is asynchronous, this call will return 
<span class='line'>5143</span>  * immediately.  Additionally, if the page already exists in the cache, 
<span class='line'>5144</span>  * no server request will occur. To determine when the page has loaded see 
<span class='line'>5145</span>  * setOnAfterPagingEvent. 
<span class='line'>5146</span>  * &lt;p>&lt;b>N.B.&lt;/b>:  This function is only used in the standard paging mode.&lt;/p>
<span class='line'>5147</span>  * &lt;p>
<span class='line'>5148</span>  * &lt;b>Example&lt;/b>
<span class='line'>5149</span>  * &lt;/p>
<span class='line'>5150</span>  * &lt;div class="code">
<span class='line'>5151</span>  * &lt;pre>&lt;code class="">
<span class='line'>5152</span>  * &#102;unction fivePagesForward()
<span class='line'>5153</span>  * {
<span class='line'>5154</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5155</span>  * 	grid.loadDataPage(grid.getCurrentPageIndex() + 5);
<span class='line'>5156</span>  * }
<span class='line'>5157</span>  * &lt;/code>&lt;/pre>
<span class='line'>5158</span>  * &lt;/div>
<span class='line'>5159</span>  * @param {Number} pageNumber The index of the data page to load.  (Zero indexed)
<span class='line'>5160</span>  */</span><span class="WHIT">
<span class='line'>5161</span> </span><span class="NAME">ntb_gridp.loadDataPage</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newPageNumber</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5162</span> 
<span class='line'>5163</span> </span><span class="COMM">/**
<span class='line'>5164</span>  * Returns the index of the currently selected row or the row to which the active cell currently belongs.
<span class='line'>5165</span>  * @param {Boolean} rel Specifies whether to compensate for frozen columns.
<span class='line'>5166</span>  * @type Number
<span class='line'>5167</span>  */</span><span class="WHIT">
<span class='line'>5168</span> </span><span class="NAME">ntb_gridp.getSelectedRow</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5169</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5170</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nRow</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5171</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeCell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5172</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5173</span> </span><span class="WHIT">			</span><span class="NAME">nRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">AC</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5174</span> 
<span class='line'>5175</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5176</span> </span><span class="WHIT">				</span><span class="NAME">nRow</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getfreezetop</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5177</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5178</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5179</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nRow</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5180</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5181</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5182</span> </span><span class="WHIT">		</span><span class="NAME">_ntbAssert</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">err.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5183</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5184</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5185</span> 
<span class='line'>5186</span> 
<span class='line'>5187</span> </span><span class="COMM">/**
<span class='line'>5188</span>  * Fires the &lt;code>HandlerError&lt;/code> event
<span class='line'>5189</span>  * @private
<span class='line'>5190</span>  */</span><span class="WHIT">
<span class='line'>5191</span> </span><span class="NAME">ntb_gridp.handleHandlerError</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5192</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5193</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">error</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getDataSource</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getHandlerError</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5194</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5195</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5196</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HandlerError"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5197</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5198</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5199</span> 
<span class='line'>5200</span> </span><span class="COMM">/**
<span class='line'>5201</span>  * Returns a row object from one of the panes given its Id number.
<span class='line'>5202</span>  * &lt;p>
<span class='line'>5203</span>  * &lt;b>Example&lt;/b>
<span class='line'>5204</span>  * &lt;/p>
<span class='line'>5205</span>  * &lt;div class="code">
<span class='line'>5206</span>  * &lt;pre>&lt;code class="">
<span class='line'>5207</span>  * &#102;unction getCellViaRow(row, col)
<span class='line'>5208</span>  * {
<span class='line'>5209</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5210</span>  * 	var rowObj = grid.getRow(row);
<span class='line'>5211</span>  * 	return rowObj.getCell(col);
<span class='line'>5212</span>  * }
<span class='line'>5213</span>  * &lt;/code>&lt;/pre>
<span class='line'>5214</span>  * &lt;/div>
<span class='line'>5215</span>  * @param {Number} rowIdNum The row index.
<span class='line'>5216</span>  * @param {Number} paneNumber
<span class='line'>5217</span>  * @returns {nitobi.grid.Row}
<span class='line'>5218</span>  */</span><span class="WHIT">
<span class='line'>5219</span> </span><span class="NAME">ntb_gridp.getRowObject</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">paneNumber</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rowIdNum</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5220</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5221</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">rowIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">rowIdNum</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5222</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rowIdNum</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">paneNumber</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5223</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5224</span> </span><span class="WHIT">		</span><span class="NAME">rowIndex</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">paneNumber</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5225</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5226</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">rowIndex</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5227</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5228</span> 
<span class='line'>5229</span> </span><span class="COMM">/**
<span class='line'>5230</span>  * Returns the column index of the Column to which the active cell belongs.
<span class='line'>5231</span>  * &lt;P>Columns are numbered from left to right starting at 0. If the first n columns are frozen (locked so that they remain visible when 
<span class='line'>5232</span>  * the user scrolls left and right), the rel parameter can be set to true to obtain the absolute column index. Otherwise the getColumn method returns the column 
<span class='line'>5233</span>  * index for column within the set of unfrozen columns.&lt;/P>
<span class='line'>5234</span>  * @param {Boolean} rel Specifies whether to compensate for frozen columns.
<span class='line'>5235</span>  * @returns {Number} Column index of the active cell.
<span class='line'>5236</span>  */</span><span class="WHIT">
<span class='line'>5237</span> </span><span class="NAME">ntb_gridp.getSelectedColumn</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5238</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5239</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nCol</span><span class="PUNC">=</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5240</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeCell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5241</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">AC</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5242</span> </span><span class="WHIT">			</span><span class="NAME">nCol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">AC.getAttribute</span><span class="PUNC">(</span><span class="STRN">'col'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5243</span> 
<span class='line'>5244</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">rel</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5245</span> </span><span class="WHIT">				</span><span class="NAME">nCol</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getFrozenLeftColumnCount</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5246</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5247</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5248</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nCol</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5249</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5250</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5251</span> </span><span class="WHIT">		</span><span class="NAME">_ntbAssert</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">err.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5252</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5253</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5254</span> 
<span class='line'>5255</span> </span><span class="COMM">/**
<span class='line'>5256</span>  * Returns the Column name as defined in fieldMap
<span class='line'>5257</span>  * @type {String}
<span class='line'>5258</span>  */</span><span class="WHIT">
<span class='line'>5259</span> </span><span class="NAME">ntb_gridp.getSelectedColumnName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5260</span> </span><span class="WHIT">    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">field</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getSelectedColumnObject</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5261</span> </span><span class="WHIT">    </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">field.getColumnName</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5262</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5263</span> 
<span class='line'>5264</span> 
<span class='line'>5265</span> </span><span class="COMM">/**
<span class='line'>5266</span>  * Returns the Column object for the column that contains the currently selected cell.
<span class='line'>5267</span>  * @type nitobi.grid.Column
<span class='line'>5268</span>  */</span><span class="WHIT">
<span class='line'>5269</span> </span><span class="NAME">ntb_gridp.getSelectedColumnObject</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5270</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">this.getSelectedColumn</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5271</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5272</span> 
<span class='line'>5273</span> </span><span class="COMM">/**
<span class='line'>5274</span>  * Returns the number of columns in the Grid.
<span class='line'>5275</span>  * @type {Number}
<span class='line'>5276</span>  */</span><span class="WHIT">
<span class='line'>5277</span> </span><span class="NAME">ntb_gridp.columnCount</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5278</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5279</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5280</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataItems</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5281</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">dataItems.length</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5282</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">err</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5283</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5284</span> </span><span class="WHIT">		</span><span class="NAME">_ntbAssert</span><span class="PUNC">(</span><span class="KEYW">false</span><span class="PUNC">,</span><span class="NAME">err.message</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5285</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5286</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5287</span> 
<span class='line'>5288</span> </span><span class="COMM">/**
<span class='line'>5289</span>  * Gets the cell object at the specified coordinates.
<span class='line'>5290</span>  * &lt;p>
<span class='line'>5291</span>  * &lt;b>Example&lt;/b>
<span class='line'>5292</span>  * &lt;/p>
<span class='line'>5293</span>  * &lt;div class="code">
<span class='line'>5294</span>  * &lt;pre>&lt;code class="">
<span class='line'>5295</span>  * &#102;unction setCellValue(row, col)
<span class='line'>5296</span>  * {
<span class='line'>5297</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5298</span>  * 	var cellObj = grid.getCellObject(row, col);
<span class='line'>5299</span>  * 	cellObj.setValue("This Year's Model");
<span class='line'>5300</span>  * }
<span class='line'>5301</span>  * &lt;/code>&lt;/pre>
<span class='line'>5302</span>  * &lt;/div>
<span class='line'>5303</span>  * @param {Number} row The index of the Row to which the Cell belongs.
<span class='line'>5304</span>  * @param {Number|String} col The Column to which the Cell belongs. This value can be either the column index or the column name.
<span class='line'>5305</span>  * @type nitobi.grid.Cell
<span class='line'>5306</span>  * @see nitobi.grid.Cell#setValue
<span class='line'>5307</span>  */</span><span class="WHIT">
<span class='line'>5308</span> </span><span class="NAME">ntb_gridp.getCellObject</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5309</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5310</span> </span><span class="WHIT">	</span><span class="COMM">// col could be either string or number so we need to keep both the string and number versions in the cache ...</span><span class="WHIT">
<span class='line'>5311</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">origCol</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5312</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.cachedCells</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5313</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5314</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5315</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5316</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5317</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.model.selectSingleNode</span><span class="PUNC">(</span><span class="STRN">"state/nitobi.grid.Columns/nitobi.grid.Column[@xdatafld_orig='"</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">+</span><span class="STRN">"']"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5318</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">node</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5319</span> </span><span class="WHIT">				</span><span class="NAME">col</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parseInt</span><span class="PUNC">(</span><span class="NAME">node.getAttribute</span><span class="PUNC">(</span><span class="STRN">'xi'</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5320</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5321</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5322</span> </span><span class="WHIT">			</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5323</span> </span><span class="WHIT">		</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>5324</span> </span><span class="WHIT">			</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5325</span> </span><span class="WHIT">		</span><span class="NAME">this.cachedCells</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">col</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.cachedCells</span><span class="PUNC">[</span><span class="NAME">row</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">origCol</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5326</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5327</span> </span><span class="WHIT">		</span><span class="NAME">cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5328</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5329</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">cell</span><span class="WHIT">
<span class='line'>5330</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5331</span> 
<span class='line'>5332</span> </span><span class="COMM">/**
<span class='line'>5333</span>  * Provides a shortcut to getting the &lt;i>displayed&lt;/i> value of a Cell at the 
<span class='line'>5334</span>  * specified coordinates. Generally the cell content can also be obtained 
<span class='line'>5335</span>  * from the XML document bound to the grid, but the values may vary. 
<span class='line'>5336</span>  * For example, if a grid uses a Listbox editor for a particular cell, 
<span class='line'>5337</span>  * the XML will contain the key value where getCellText will return the 
<span class='line'>5338</span>  * actual text value displayed in the cell. One can also access the value 
<span class='line'>5339</span>  * of a Cell through the Cell object itself.
<span class='line'>5340</span>  * &lt;p>
<span class='line'>5341</span>  * &lt;b>Example&lt;/b>:  The difference between getCellText and {@link #getCellValue}
<span class='line'>5342</span>  * &lt;/p>
<span class='line'>5343</span>  * &lt;div class="code">
<span class='line'>5344</span>  * &lt;pre>&lt;code class="">
<span class='line'>5345</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>5346</span>  * var datatable = grid.getDataSource();
<span class='line'>5347</span>  * // Get the xml node that represents the first row (xi is row index)
<span class='line'>5348</span>  * var node = datatable.getDataXmlDoc().selectSingleNode("//ntb:e[&#64;xi=0]");
<span class='line'>5349</span>  * // Set the value of the first column
<span class='line'>5350</span>  * node.setAttribute("a", "New value");
<span class='line'>5351</span>  * if (grid.getCellText(0,0) != grid.getCellValue(0,0))
<span class='line'>5352</span>  * {
<span class='line'>5353</span>  * 	alert('They are not equal.  getCellValue gets the value from the xml while getCellText gets it from the rendered cell');
<span class='line'>5354</span>  * }
<span class='line'>5355</span>  * &lt;/code>&lt;/pre>
<span class='line'>5356</span>  * &lt;/div>
<span class='line'>5357</span>  * @param {Number} row The index of the Row to which the Cell belongs.
<span class='line'>5358</span>  * @param {Number} col The index of the Column to which the Cell belongs.
<span class='line'>5359</span>  * @type String
<span class='line'>5360</span>  * @see #getCellObject
<span class='line'>5361</span>  */</span><span class="WHIT">
<span class='line'>5362</span> </span><span class="NAME">ntb_gridp.getCellText</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5363</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5364</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getCellObject</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getHtml</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5365</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5366</span> </span><span class="COMM">/**
<span class='line'>5367</span>  * Provides a shortcut to geting the value of a Cell at the specified 
<span class='line'>5368</span>  * coordinates.
<span class='line'>5369</span>  * &lt;p>
<span class='line'>5370</span>  * &lt;b>Example&lt;/b>:  The difference between getCellValue and {@link #getCellText}
<span class='line'>5371</span>  * &lt;/p>
<span class='line'>5372</span>  * &lt;div class="code">
<span class='line'>5373</span>  * &lt;pre>&lt;code class="">
<span class='line'>5374</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>5375</span>  * var datatable = grid.getDataSource();
<span class='line'>5376</span>  * // Get the xml node that represents the first row (xi is row index)
<span class='line'>5377</span>  * var node = datatable.getDataXmlDoc().selectSingleNode("//ntb:e[&#64;xi=0]");
<span class='line'>5378</span>  * // Set the value of the first column
<span class='line'>5379</span>  * node.setAttribute("a", "New value");
<span class='line'>5380</span>  * if (grid.getCellText(0,0) != grid.getCellValue(0,0))
<span class='line'>5381</span>  * {
<span class='line'>5382</span>  * 	alert('They are not equal.  getCellValue gets the value from the xml while getCellText gets it from the rendered cell');
<span class='line'>5383</span>  * }
<span class='line'>5384</span>  * &lt;/code>&lt;/pre>
<span class='line'>5385</span>  * &lt;/div>
<span class='line'>5386</span>  * @param {Number} row The index of the Row to which the Cell belongs.
<span class='line'>5387</span>  * @param {Number} col The index of the Column to which the Cell belongs.
<span class='line'>5388</span>  * @see #getCellObject
<span class='line'>5389</span>  */</span><span class="WHIT">
<span class='line'>5390</span> </span><span class="NAME">ntb_gridp.getCellValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="NAME">col</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5391</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5392</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.getCellObject</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">col</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getValue</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5393</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5394</span> 
<span class='line'>5395</span> </span><span class="COMM">/**
<span class='line'>5396</span>  * &lt;P>Returns the HTMLElement of the cell in the Grid at the specified 
<span class='line'>5397</span>  * coordinates. The cell is represented in HTML as a &lt;DIV&gt; 
<span class='line'>5398</span>  * with xi, col, colAttr, and value attributes containing the cell row 
<span class='line'>5399</span>  * number, the cell column number, the column XML attribute name, and 
<span class='line'>5400</span>  * the raw cell value. The innerHTML property of the cell element will 
<span class='line'>5401</span>  * contain the displayed value for the cell.&lt;/P>
<span class='line'>5402</span>  * &lt;p>
<span class='line'>5403</span>  * &lt;b>Example&lt;/b>
<span class='line'>5404</span>  * &lt;/p>
<span class='line'>5405</span>  * &lt;div class="code">
<span class='line'>5406</span>  * &lt;pre>&lt;code class="">
<span class='line'>5407</span>  * &#102;unction scrollToCell(row, col)
<span class='line'>5408</span>  * {
<span class='line'>5409</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5410</span>  * 	var cellElement = grid.getCellElement(row, col);
<span class='line'>5411</span>  * 	grid.ensureCellInView(cellElement);
<span class='line'>5412</span>  * }
<span class='line'>5413</span>  * &lt;/code>&lt;/pre>
<span class='line'>5414</span>  * &lt;/div>
<span class='line'>5415</span>  * @param {Number} row The Row coordinate of the cell.
<span class='line'>5416</span>  * @param {Number} column The Column coordinate of the cell.
<span class='line'>5417</span>  * @type HTMLElement
<span class='line'>5418</span>  * @see #ensureCellInView
<span class='line'>5419</span>  */</span><span class="WHIT">
<span class='line'>5420</span> </span><span class="NAME">ntb_gridp.getCellElement</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">row</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5421</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5422</span> </span><span class="WHIT">	</span><span class="COMM">// TODO: this should use the getCellElement static method on the cell class</span><span class="WHIT">
<span class='line'>5423</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"cell_"</span><span class="PUNC">+</span><span class="NAME">row</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">column</span><span class="PUNC">+</span><span class="STRN">"_"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5424</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5425</span> 
<span class='line'>5426</span> </span><span class="COMM">/**
<span class='line'>5427</span>  * Returns the Row object of the currently selected row or the row to which the active cell currently belongs.
<span class='line'>5428</span>  * @param {Number} xi The index of the Row to retrieve.
<span class='line'>5429</span>  * @type nitobi.grid.Row
<span class='line'>5430</span>  */</span><span class="WHIT">
<span class='line'>5431</span> </span><span class="NAME">ntb_gridp.getSelectedRowObject</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">xi</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5432</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5433</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5434</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">this.activeCell</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5435</span> </span><span class="WHIT">	</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Row</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">r</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5436</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5437</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5438</span> 
<span class='line'>5439</span> </span><span class="COMM">/**
<span class='line'>5440</span>  * Gets the Column object for the column at the index specified. The type of Column object return could be a DateColumn, TextColumn, or NumberColumn
<span class='line'>5441</span>  * depending on the column type.
<span class='line'>5442</span>  * &lt;p>
<span class='line'>5443</span>  * &lt;b>Example&lt;/b>
<span class='line'>5444</span>  * &lt;/p>
<span class='line'>5445</span>  * &lt;div class="code">
<span class='line'>5446</span>  * &lt;pre>&lt;code class="">
<span class='line'>5447</span>  * &#102;unction sortColumnAsc(index)
<span class='line'>5448</span>  * {
<span class='line'>5449</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5450</span>  * 	var colObj = grid.getColumnObject(index);
<span class='line'>5451</span>  * 	if (colObj.isSortEnabled())
<span class='line'>5452</span>  * 	{
<span class='line'>5453</span>  * 		grid.sort(index, "Asc");
<span class='line'>5454</span>  * 	}
<span class='line'>5455</span>  * }
<span class='line'>5456</span>  * &lt;/code>&lt;/pre>
<span class='line'>5457</span>  * &lt;/div>
<span class='line'>5458</span>  * @param {Number} index The zero based index of the Column to return the object of.
<span class='line'>5459</span>  * @type nitobi.grid.Column
<span class='line'>5460</span>  */</span><span class="WHIT">
<span class='line'>5461</span> </span><span class="NAME">ntb_gridp.getColumnObject</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">index</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5462</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5463</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="STRN">"Invalid column accessed."</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5464</span> 
<span class='line'>5465</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5466</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">index</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">length</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5467</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5468</span> </span><span class="WHIT">		</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.columns</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5469</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5470</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5471</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">dataType</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">'DataType'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5472</span> </span><span class="WHIT">			</span><span class="KEYW">switch</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dataType</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5473</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5474</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"number"</span><span class="PUNC">:</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5475</span> </span><span class="WHIT">					</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.NumberColumn</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5476</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5477</span> </span><span class="WHIT">				</span><span class="KEYW">case</span><span class="WHIT"> </span><span class="STRN">"date"</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5478</span> </span><span class="WHIT">					</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.DateColumn</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5479</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5480</span> </span><span class="WHIT">				</span><span class="KEYW">default</span><span class="PUNC">:</span><span class="WHIT">
<span class='line'>5481</span> </span><span class="WHIT">					</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.TextColumn</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">index</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5482</span> </span><span class="WHIT">					</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5483</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5484</span> </span><span class="COMM">//			column = new nitobi.grid.Column(this,index);</span><span class="WHIT">
<span class='line'>5485</span> </span><span class="WHIT">			</span><span class="NAME">this.columns</span><span class="PUNC">[</span><span class="NAME">index</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5486</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5487</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5488</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">column</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">column.getModel</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5489</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5490</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5491</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5492</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>5493</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5494</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">column</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5495</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5496</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5497</span> </span><span class="COMM">/**
<span class='line'>5498</span>  * Gets the Cell object that represents the currently selected cell in the Grid.
<span class='line'>5499</span>  * &lt;p>
<span class='line'>5500</span>  * &lt;b>Example&lt;/b>
<span class='line'>5501</span>  * &lt;/p>
<span class='line'>5502</span>  * &lt;div class="code">
<span class='line'>5503</span>  * &lt;pre>&lt;code class="">
<span class='line'>5504</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>5505</span>  * grid.setPosition(0,3);
<span class='line'>5506</span>  * var cellObj1 = grid.getSelectedCellObject();
<span class='line'>5507</span>  * var cellObj2 = grid.getCellObject(0,3);
<span class='line'>5508</span>  * if (cellObj1.getDomNode() === cellObj2.getDomNode())
<span class='line'>5509</span>  * {
<span class='line'>5510</span>  * 	alert('They are the same!');
<span class='line'>5511</span>  * }
<span class='line'>5512</span>  * &lt;/code>&lt;/pre>
<span class='line'>5513</span>  * &lt;/div>
<span class='line'>5514</span>  * @type nitobi.grid.Cell
<span class='line'>5515</span>  */</span><span class="WHIT">
<span class='line'>5516</span> </span><span class="NAME">ntb_gridp.getSelectedCellObject</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5517</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeCellObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5518</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5519</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5520</span> </span><span class="WHIT">		</span><span class="COMM">// Failover to use the activeCell - this can likely be removed</span><span class="WHIT">
<span class='line'>5521</span> </span><span class="WHIT">		</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.activeCell</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="COMM">//this.Scroller.activeView.activeCell;</span><span class="WHIT">
<span class='line'>5522</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">		</span><span class="WHIT">
<span class='line'>5523</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5524</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">Cell</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Cell</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5525</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">r</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Cell.getRowNumber</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5526</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">c</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Cell.getColumnNumber</span><span class="PUNC">(</span><span class="NAME">obj</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5527</span> </span><span class="WHIT">			</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getCellObject</span><span class="PUNC">(</span><span class="NAME">r</span><span class="PUNC">,</span><span class="NAME">c</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5528</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5529</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">	</span><span class="WHIT">
<span class='line'>5530</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5531</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5532</span> 
<span class='line'>5533</span> </span><span class="COMM">/**
<span class='line'>5534</span>  * @private
<span class='line'>5535</span>  * Automatically adds a new row to the end of the Grid if the autoAdd is true, the current cell isn't empty.
<span class='line'>5536</span>  * This method is similar to the insertRow method.
<span class='line'>5537</span>  */</span><span class="WHIT">
<span class='line'>5538</span> </span><span class="NAME">ntb_gridp.autoAddRow</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5539</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5540</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.activeCell.innerText.replace</span><span class="PUNC">(</span><span class="REGX">/\s/g</span><span class="PUNC">,</span><span class="STRN">""</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="STRN">""</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">this.autoAdd</span><span class="WHIT"> </span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5541</span> </span><span class="WHIT">		</span><span class="NAME">this.deactivateCell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5542</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.active</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="STRN">"Y"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5543</span> </span><span class="WHIT">			</span><span class="NAME">this.freezeCell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5544</span> </span><span class="WHIT">		</span><span class="NAME">eval</span><span class="PUNC">(</span><span class="NAME">this.getOnRowBlurEvent</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5545</span> </span><span class="WHIT">		</span><span class="NAME">this.insertRow</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5546</span> </span><span class="WHIT">		</span><span class="NAME">this.go</span><span class="PUNC">(</span><span class="STRN">"HOME"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5547</span> 
<span class='line'>5548</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: There is no edit cell...</span><span class="WHIT">
<span class='line'>5549</span> </span><span class="WHIT">		</span><span class="NAME">this.editCell</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5550</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5551</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5552</span> 
<span class='line'>5553</span> </span><span class="COMM">/**
<span class='line'>5554</span>  * Sets the number of rows displayed in the Grid.
<span class='line'>5555</span>  * @param {Number} newVal The number of rows currently displayed in the Grid.
<span class='line'>5556</span>  * @private
<span class='line'>5557</span>  */</span><span class="WHIT">
<span class='line'>5558</span> </span><span class="NAME">ntb_gridp.setDisplayedRowCount</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">newVal</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5559</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5560</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">newVal</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"displayed row was set to nan"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5561</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.Scroller</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5562</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5563</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.view.midcenter.rows</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5564</span> </span><span class="WHIT">		</span><span class="NAME">this.Scroller.view.midleft.rows</span><span class="WHIT">	</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5565</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5566</span> </span><span class="WHIT">	</span><span class="NAME">this.displayedRowCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">newVal</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5567</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5568</span> 
<span class='line'>5569</span> </span><span class="COMM">/**
<span class='line'>5570</span>  * Returns the number of currently rows displayed in the Grid.
<span class='line'>5571</span>  * @type Number
<span class='line'>5572</span>  */</span><span class="WHIT">
<span class='line'>5573</span> </span><span class="NAME">ntb_gridp.getDisplayedRowCount</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5574</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5575</span> </span><span class="WHIT">	</span><span class="NAME">ntbAssert</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">isNaN</span><span class="PUNC">(</span><span class="NAME">this.displayedRowCount</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="STRN">"displayed row count return nan"</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5576</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.displayedRowCount</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5577</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5578</span> 
<span class='line'>5579</span> </span><span class="NAME">ntb_gridp.getToolsContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="WHIT">
<span class='line'>5580</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5581</span> </span><span class="WHIT">	</span><span class="NAME">this.toolsContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.toolsContainer</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-toolscontainer"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5582</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">this.toolsContainer</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5583</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5584</span> 
<span class='line'>5585</span> </span><span class="NAME">ntb_gridp.getHeaderContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5586</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5587</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-header"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5588</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5589</span> 
<span class='line'>5590</span> </span><span class="NAME">ntb_gridp.getDataContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5591</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5592</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-data"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5593</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5594</span> 
<span class='line'>5595</span> </span><span class="NAME">ntb_gridp.getScrollerContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5596</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5597</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"ntb-grid-scroller"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5598</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5599</span> 
<span class='line'>5600</span> </span><span class="NAME">ntb_gridp.getGridContainer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5601</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5602</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nitobi.html.getFirstChild</span><span class="PUNC">(</span><span class="NAME">this.UiContainer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5603</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5604</span> 
<span class='line'>5605</span> </span><span class="COMM">/**
<span class='line'>5606</span>  * Copies the currently selected block of cells in the Grid. Copied data will be located in the native operating system clipboard and
<span class='line'>5607</span>  * formatted as an HTML table. This data can be pasted into many common desktop applications such as Microsoft Excel or into other Grid components.
<span class='line'>5608</span>  * OnBeforeCopyEvent and OnAfterCopyEvent are fired.
<span class='line'>5609</span>  * &lt;p>
<span class='line'>5610</span>  * &lt;b>Example&lt;/b>
<span class='line'>5611</span>  * &lt;/p>
<span class='line'>5612</span>  * &lt;div class="code">
<span class='line'>5613</span>  * &lt;pre>&lt;code class="javascript">
<span class='line'>5614</span>  * &#102;unction copyBlock(startRow, startColumn, endRow, endColumn)
<span class='line'>5615</span>  * {
<span class='line'>5616</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5617</span>  * 	grid.getSelection().selectWithCoords(startRow, startColumn, endRow, endColumn);
<span class='line'>5618</span>  * 	grid.copy();
<span class='line'>5619</span>  * }
<span class='line'>5620</span>  * &lt;/code>&lt;/pre>
<span class='line'>5621</span>  * &lt;/div>
<span class='line'>5622</span>  * @see #paste
<span class='line'>5623</span>  * @see #OnBeforeCopyEvent
<span class='line'>5624</span>  * @see #OnAfterCopyEvent
<span class='line'>5625</span>  */</span><span class="WHIT">
<span class='line'>5626</span> </span><span class="NAME">ntb_gridp.copy</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5627</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5628</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selection.getCoords</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5629</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">data</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getTableForSelection</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5630</span> 
<span class='line'>5631</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">copyEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnCopyEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5632</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isCopyEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforeCopy"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">copyEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5633</span> 
<span class='line'>5634</span> </span><span class="WHIT">	</span><span class="COMM">// Removed the conditional for using the windows clipboard in IE so we</span><span class="WHIT">
<span class='line'>5635</span> </span><span class="WHIT">	</span><span class="COMM">// always just go through the same path.</span><span class="WHIT">
<span class='line'>5636</span> 
<span class='line'>5637</span> </span><span class="WHIT">	</span><span class="COMM">// Place the HTML table formatted data into the invisible textarea</span><span class="WHIT">
<span class='line'>5638</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">nitobi.browser.IE</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5639</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5640</span> </span><span class="WHIT">		</span><span class="COMM">// create text area</span><span class="WHIT">
<span class='line'>5641</span> 
<span class='line'>5642</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">copyClipBoard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getClipboard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5643</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: see if this causes a memory leak.If so then make sure the references are cleaned up</span><span class="WHIT">
<span class='line'>5644</span> </span><span class="WHIT">		</span><span class="NAME">copyClipBoard.onkeyup</span><span class="WHIT">		</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.focus</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5645</span> </span><span class="WHIT">		</span><span class="NAME">copyClipBoard.value</span><span class="WHIT"> 			</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">data</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5646</span> </span><span class="WHIT">		</span><span class="COMM">// Create a selection range on the innerText of the invisible textarea</span><span class="WHIT">
<span class='line'>5647</span> </span><span class="WHIT">		</span><span class="NAME">copyClipBoard.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5648</span> </span><span class="WHIT">		</span><span class="NAME">copyClipBoard.setSelectionRange</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">copyClipBoard.value.length</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5649</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5650</span> </span><span class="WHIT">		</span><span class="NAME">window.clipboardData.setData</span><span class="PUNC">(</span><span class="STRN">"Text"</span><span class="PUNC">,</span><span class="NAME">data</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5651</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5652</span> 
<span class='line'>5653</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterCopy"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">copyEventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5654</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5655</span> 
<span class='line'>5656</span> </span><span class="COMM">/**
<span class='line'>5657</span>  * Returns the data from the Grid as an HTML table.
<span class='line'>5658</span>  * @param {Map} coords The coordinates of the data to retrieve. Eg. {"top":{"y":5},"bottom":{"y":10}} will select all the data from rows 5 to 10.
<span class='line'>5659</span>  * @type String
<span class='line'>5660</span>  */</span><span class="WHIT">
<span class='line'>5661</span> </span><span class="NAME">ntb_gridp.getTableForSelection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">coords</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5662</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5663</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnMap</span><span class="PUNC">(</span><span class="NAME">coords.top.x</span><span class="PUNC">,</span><span class="NAME">coords.bottom.x</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5664</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">result</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.data.FormatConverter.convertEbaXmlToTsv</span><span class="PUNC">(</span><span class="NAME">this.getDataSource</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getDataXmlDoc</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="NAME">columns</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5665</span> </span><span class="WHIT">																	</span><span class="NAME">coords.top.y</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>5666</span> </span><span class="WHIT">																	</span><span class="NAME">coords.bottom.y</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5667</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> 	</span><span class="NAME">result</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5668</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5669</span> 
<span class='line'>5670</span> </span><span class="COMM">/**
<span class='line'>5671</span>  * Returns an array containing the attribute names used by column definitions in the grid.
<span class='line'>5672</span>  * @private
<span class='line'>5673</span>  * @type Array
<span class='line'>5674</span>  */</span><span class="WHIT">
<span class='line'>5675</span> </span><span class="NAME">ntb_gridp.getColumnMap</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">firstColumn</span><span class="PUNC">,</span><span class="NAME">lastColumn</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5676</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5677</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columns</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnDefinitions</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5678</span> </span><span class="WHIT">	</span><span class="NAME">firstColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">firstColumn</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NUMB">0</span><span class="PUNC">:</span><span class="NAME">firstColumn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5679</span> </span><span class="WHIT">	</span><span class="NAME">lastColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">lastColumn</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="PUNC">?</span><span class="NAME">columns.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">:</span><span class="NAME">lastColumn</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5680</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">map</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Array</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5681</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">=</span><span class="NAME">firstColumn</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">&lt;=</span><span class="NAME">lastColumn</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5682</span> </span><span class="WHIT">		</span><span class="NAME">map.push</span><span class="PUNC">(</span><span class="NAME">columns</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">getAttribute</span><span class="PUNC">(</span><span class="STRN">"xdatafld"</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">substr</span><span class="PUNC">(</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5683</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5684</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">map</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5685</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5686</span> 
<span class='line'>5687</span> </span><span class="COMM">/**
<span class='line'>5688</span>  * Attempts to paste the data that is currently in the native operating 
<span class='line'>5689</span>  * systems "clipboard" into the Grid. The data must be in tab seperated 
<span class='line'>5690</span>  * format to properly be pasted into the Grid. OnBeforePasteEvent and 
<span class='line'>5691</span>  * OnAfterPasteEvent are fired.
<span class='line'>5692</span>  * &lt;p>
<span class='line'>5693</span>  * &lt;b>Example&lt;/b>
<span class='line'>5694</span>  * &lt;/p>
<span class='line'>5695</span>  * &lt;div class="code">
<span class='line'>5696</span>  * &lt;pre>&lt;code class="">
<span class='line'>5697</span>  * &#102;unction copyBlockTo(startRow, startColumn, endRow, endColumn, destRow)
<span class='line'>5698</span>  * {
<span class='line'>5699</span>  * 	var grid = nitobi.getComponent('grid1');
<span class='line'>5700</span>  * 	grid.getSelection().selectWithCoords(startRow, startColumn, endRow, endColumn);
<span class='line'>5701</span>  * 	grid.copy();
<span class='line'>5702</span>  * 	grid.setPosition(destRow, 0);
<span class='line'>5703</span>  * 	grid.paste();
<span class='line'>5704</span>  * }
<span class='line'>5705</span>  * &lt;/code>&lt;/pre>
<span class='line'>5706</span>  * &lt;/div>
<span class='line'>5707</span>  */</span><span class="WHIT">
<span class='line'>5708</span> </span><span class="NAME">ntb_gridp.paste</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5709</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5710</span> </span><span class="WHIT">	</span><span class="COMM">// Preconditions: Paste data is on the clipboard and in TSV or HTML TABLE format</span><span class="WHIT">
<span class='line'>5711</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.isPasteEnabled</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5712</span> 
<span class='line'>5713</span> </span><span class="WHIT">	</span><span class="COMM">// create text area</span><span class="WHIT">
<span class='line'>5714</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pasteClipBoard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getClipboard</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5715</span> </span><span class="WHIT">	</span><span class="COMM">// Create a selection range on the innerText of the invisible textarea</span><span class="WHIT">
<span class='line'>5716</span> </span><span class="WHIT">	</span><span class="NAME">pasteClipBoard.onkeyup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.pasteDataReady</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">pasteClipBoard</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5717</span> </span><span class="WHIT">	</span><span class="NAME">pasteClipBoard.focus</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5718</span> 
<span class='line'>5719</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">pasteClipBoard</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5720</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5721</span> 
<span class='line'>5722</span> </span><span class="COMM">/**
<span class='line'>5723</span>  * Handles the onkeyup event in the "clipboard" and attempts to merge the pasted data into the DataTable to which the Grid is connected. 
<span class='line'>5724</span>  * If the pasted crosses over rows that are not in the DataTable then the DataTable needs to retrieve that data from the server before it can be
<span class='line'>5725</span>  * merged. The retrieval of the data is asynchronous and once complete the pasteComplete() method is called.
<span class='line'>5726</span>  * @param {Object} pasteClipBoard  The paste clibboard is actually an HTML textarea element.
<span class='line'>5727</span>  * @private
<span class='line'>5728</span>  */</span><span class="WHIT">
<span class='line'>5729</span> </span><span class="NAME">ntb_gridp.pasteDataReady</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">pasteClipBoard</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5730</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5731</span> </span><span class="WHIT">	</span><span class="NAME">pasteClipBoard.onkeyup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5732</span> 
<span class='line'>5733</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">selection</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.selection</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5734</span> 
<span class='line'>5735</span> </span><span class="WHIT">	</span><span class="COMM">// get RowIndex for the TargetTopLeftCell</span><span class="WHIT">
<span class='line'>5736</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">selection.getCoords</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5737</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.top.x</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5738</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endColumn</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startColumn</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nitobi.data.FormatConverter.getDataColumns</span><span class="PUNC">(</span><span class="NAME">pasteClipBoard.value</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5739</span> 
<span class='line'>5740</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">editable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">true</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5741</span> </span><span class="WHIT">	</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">startColumn</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;=</span><span class="WHIT"> </span><span class="NAME">endColumn</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5742</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5743</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnObject</span><span class="PUNC">(</span><span class="NAME">i</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5744</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">columnObject</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5745</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5746</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">columnObject.isEditable</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5747</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5748</span> </span><span class="WHIT">				</span><span class="NAME">editable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">false</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5749</span> </span><span class="WHIT">				</span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5750</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5751</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5752</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5753</span> 
<span class='line'>5754</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">editable</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5755</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5756</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: what is the approach to these sorts of alerts???</span><span class="WHIT">
<span class='line'>5757</span> </span><span class="WHIT">		</span><span class="COMM">// TODO: put a default class on read only columns ntb-grid-columnreadonly</span><span class="WHIT">
<span class='line'>5758</span> </span><span class="WHIT">		</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"PasteFailed"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5759</span> </span><span class="WHIT">		</span><span class="NAME">this.handleAfterPaste</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5760</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5761</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5762</span> </span><span class="WHIT">	</span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>5763</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5764</span> </span><span class="WHIT">		</span><span class="COMM">//	get the list of mapped columns for the given columns</span><span class="WHIT">
<span class='line'>5765</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">columnList</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.getColumnMap</span><span class="PUNC">(</span><span class="NAME">startColumn</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endColumn</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5766</span> 
<span class='line'>5767</span> </span><span class="WHIT">		</span><span class="COMM">//	get the pasting row coordinates</span><span class="WHIT">
<span class='line'>5768</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">startRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">coords.top.y</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5769</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">endRow</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Math.max</span><span class="PUNC">(</span><span class="NAME">startRow</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="WHIT"> </span><span class="NAME">nitobi.data.FormatConverter.getDataRows</span><span class="PUNC">(</span><span class="NAME">pasteClipBoard.value</span><span class="PUNC">)</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5770</span> 
<span class='line'>5771</span> </span><span class="WHIT">		</span><span class="NAME">this.getSelection</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">selectWithCoords</span><span class="PUNC">(</span><span class="NAME">startRow</span><span class="PUNC">,</span><span class="NAME">startColumn</span><span class="PUNC">,</span><span class="NAME">endRow</span><span class="PUNC">,</span><span class="NAME">startColumn</span><span class="PUNC">+</span><span class="NAME">columnList.length</span><span class="PUNC">-</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5772</span> 
<span class='line'>5773</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">pasteEventArgs</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.OnPasteEventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pasteClipBoard.value</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">coords</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5774</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="PUNC">!</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"BeforePaste"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pasteEventArgs</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="KEYW">return</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5775</span> 
<span class='line'>5776</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clipboardValue</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">pasteClipBoard.value</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5777</span> </span><span class="WHIT">		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">preMergedEbaXml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5778</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">clipboardValue.substr</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"&lt;"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5779</span> </span><span class="WHIT">			</span><span class="COMM">// Reasoning: if &lt; is the first character then this is likely an HTML table</span><span class="WHIT">
<span class='line'>5780</span> </span><span class="WHIT">			</span><span class="NAME">preMergedEbaXml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.data.FormatConverter.convertHtmlTableToEbaXml</span><span class="PUNC">(</span><span class="NAME">clipboardValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">columnList</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5781</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5782</span> </span><span class="WHIT">			</span><span class="COMM">// otherwise its a tab-separated value list</span><span class="WHIT">
<span class='line'>5783</span> </span><span class="WHIT">			</span><span class="NAME">preMergedEbaXml</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.data.FormatConverter.convertTsvToEbaXml</span><span class="PUNC">(</span><span class="NAME">clipboardValue</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">columnList</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5784</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5785</span> 
<span class='line'>5786</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">preMergedEbaXml.documentElement</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5787</span> </span><span class="WHIT">			</span><span class="NAME">this.datatable.mergeFromXml</span><span class="PUNC">(</span><span class="NAME">preMergedEbaXml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.pasteComplete</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">preMergedEbaXml</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">startRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pasteEventArgs</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5788</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5789</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5790</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5791</span> 
<span class='line'>5792</span> </span><span class="COMM">/**
<span class='line'>5793</span>  * Completes the paste operation after the asynchronous get on the grid data.
<span class='line'>5794</span>  * @private
<span class='line'>5795</span>  */</span><span class="WHIT">
<span class='line'>5796</span> </span><span class="NAME">ntb_gridp.pasteComplete</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">preMergedEbaXml</span><span class="PUNC">,</span><span class="NAME">startRow</span><span class="PUNC">,</span><span class="NAME">endRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">pasteEventArgs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5797</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5798</span> </span><span class="WHIT">	</span><span class="COMM">// Call Viewport.render() (or notify with event)</span><span class="WHIT">
<span class='line'>5799</span> </span><span class="WHIT">	</span><span class="NAME">this.Scroller.reRender</span><span class="PUNC">(</span><span class="NAME">startRow</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">endRow</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5800</span> 
<span class='line'>5801</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribeOnce</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.handleAfterPaste</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="NAME">pasteEventArgs</span><span class="PUNC">]</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5802</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5803</span> 
<span class='line'>5804</span> </span><span class="COMM">/**
<span class='line'>5805</span>  * Event handler that fires after data has been pasted into the Grid. 
<span class='line'>5806</span>  * Fires the &lt;code>AfterPaste&lt;/code> event
<span class='line'>5807</span>  * @param {nitobi.grid.OnPasteEventArgs} eventArgs The paste operation event 
<span class='line'>5808</span>  * arguments.
<span class='line'>5809</span>  * @private
<span class='line'>5810</span>  */</span><span class="WHIT">
<span class='line'>5811</span> </span><span class="NAME">ntb_gridp.handleAfterPaste</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5812</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5813</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"AfterPaste"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">eventArgs</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5814</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5815</span> 
<span class='line'>5816</span> </span><span class="COMM">/**
<span class='line'>5817</span>  * Creates a hidden textarea if it does not already exist. This hidden textarea is used as our "clipboard" by capturing keypress events and then 
<span class='line'>5818</span>  * assigning focus to the clipboard before the actual keydown event fires causing the clipboard information to be either pasted or copied.
<span class='line'>5819</span>  * @private
<span class='line'>5820</span>  * @type Clipboard 
<span class='line'>5821</span>  */</span><span class="WHIT">
<span class='line'>5822</span> </span><span class="NAME">ntb_gridp.getClipboard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5823</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5824</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">clipboard</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">document.getElementById</span><span class="PUNC">(</span><span class="STRN">"ntb-clipboard"</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5825</span> </span><span class="WHIT">	</span><span class="NAME">clipboard.onkeyup</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5826</span> </span><span class="WHIT">	</span><span class="NAME">clipboard.value</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="STRN">''</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5827</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">clipboard</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5828</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5829</span> 
<span class='line'>5830</span> </span><span class="COMM">/**
<span class='line'>5831</span>  * Fires the &lt;code>HtmlReady&lt;/code> event.
<span class='line'>5832</span>  * @private
<span class='line'>5833</span>  */</span><span class="WHIT">
<span class='line'>5834</span> </span><span class="NAME">ntb_gridp.handleHtmlReady</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evtArgs</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5835</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5836</span> </span><span class="WHIT">	</span><span class="NAME">this.fire</span><span class="PUNC">(</span><span class="STRN">"HtmlReady"</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">nitobi.base.EventArgs</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5837</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5838</span> 
<span class='line'>5839</span> </span><span class="COMM">// TODO: Remove the subscribe and fire methods to IObservable which the grid implements.</span><span class="WHIT">
<span class='line'>5840</span> </span><span class="COMM">/**
<span class='line'>5841</span>  * Manually fires the particular event.
<span class='line'>5842</span>  * &lt;p>
<span class='line'>5843</span>  * &lt;b>Example&lt;/b>
<span class='line'>5844</span>  * &lt;/p>
<span class='line'>5845</span>  * &lt;div class="code">
<span class='line'>5846</span>  * &lt;pre>&lt;code class="">
<span class='line'>5847</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>5848</span>  * grid.fire("CellClick"); // Note we supply "CellClick" for the OnCellClickEvent
<span class='line'>5849</span>  * &lt;/code>&lt;/pre>
<span class='line'>5850</span>  * &lt;/div>
<span class='line'>5851</span>  * @param {String} evt The identifier for the evnt such as "HtmlReady".
<span class='line'>5852</span>  * @param {Object} args Any arguments to pass to the event handlers.
<span class='line'>5853</span>  */</span><span class="WHIT">
<span class='line'>5854</span> </span><span class="NAME">ntb_gridp.fire</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5855</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nitobi.event.notify</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">,</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5856</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5857</span> 
<span class='line'>5858</span> </span><span class="COMM">/**
<span class='line'>5859</span>  * Subscribes a function to a Grid event.
<span class='line'>5860</span>  * &lt;p>
<span class='line'>5861</span>  * &lt;b>Example&lt;/b>
<span class='line'>5862</span>  * &lt;/p>
<span class='line'>5863</span>  * &lt;div class="code">
<span class='line'>5864</span>  * &lt;pre>&lt;code class="">
<span class='line'>5865</span>  * var grid = nitobi.getComponent('grid1');
<span class='line'>5866</span>  * grid.subscribe("DataReady", myFunction);
<span class='line'>5867</span>  * &lt;/code>&lt;/pre>
<span class='line'>5868</span>  * &lt;/div>
<span class='line'>5869</span>  * &lt;p>
<span class='line'>5870</span>  * Notice that the event we are subscribing to does not specify the "On" 
<span class='line'>5871</span>  * or "Event" parts of the name.
<span class='line'>5872</span>  * &lt;/p>
<span class='line'>5873</span>  * @param {String} evt A event string identifier or key for the given 
<span class='line'>5874</span>  * event. This value is the event name without the "On" and "Event" parts 
<span class='line'>5875</span>  * of the name, for example, the key for the OnDataReadyEvent is becomes 
<span class='line'>5876</span>  * "DataReady".
<span class='line'>5877</span>  * @param {Function} func A reference to the Function object that should 
<span class='line'>5878</span>  * be called when the event is fired.
<span class='line'>5879</span>  * @param {Object} context A reference to the Object that the Function 
<span class='line'>5880</span>  * should be called in the context of. When writing object oriented 
<span class='line'>5881</span>  * JavaScript the reference to the Function must also have some context 
<span class='line'>5882</span>  * in which it is to be executed.
<span class='line'>5883</span>  * @see nitobi.grid.Grid#subscribeOnce
<span class='line'>5884</span>  * @see nitobi.grid.Grid#unsubscribe
<span class='line'>5885</span>  */</span><span class="WHIT">
<span class='line'>5886</span> </span><span class="NAME">ntb_gridp.subscribe</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">func</span><span class="PUNC">,</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5887</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">this.subscribedEvents</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5888</span> </span><span class="WHIT">		</span><span class="NAME">this.subscribedEvents</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5889</span> </span><span class="WHIT">	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">)</span><span class="PUNC">==</span><span class="STRN">"undefined"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">=</span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5890</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">guid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.event.subscribe</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">,</span><span class="NAME">nitobi.lang.close</span><span class="PUNC">(</span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5891</span> </span><span class="WHIT">	</span><span class="NAME">this.subscribedEvents</span><span class="PUNC">[</span><span class="NAME">guid</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">evt</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5892</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">guid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5893</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5894</span> 
<span class='line'>5895</span> </span><span class="COMM">/**
<span class='line'>5896</span>  * Subscribe to an event only once.  That is, the handler is only fired 
<span class='line'>5897</span>  * once and then automatically unregistered.
<span class='line'>5898</span>  * &lt;p>
<span class='line'>5899</span>  * &lt;b>Example&lt;/b>:  Load the grid and subscribe to the OnHtmlReadyEvent
<span class='line'>5900</span>  * &lt;/p>
<span class='line'>5901</span>  * &lt;div class="code">
<span class='line'>5902</span>  * &lt;pre>&lt;code class="">
<span class='line'>5903</span>  * &#102;unction loadGrid()
<span class='line'>5904</span>  * {
<span class='line'>5905</span>  * 	var grid = nitobi.loadComponent('grid1');
<span class='line'>5906</span>  * 	grid.subscribeOnce("HtmlReady", handleHtmlEvent, null, new Array(grid));
<span class='line'>5907</span>  * }
<span class='line'>5908</span>  * 
<span class='line'>5909</span>  * &#102;unction handleHtmlEvent(gridObj)
<span class='line'>5910</span>  * {
<span class='line'>5911</span>  * 	gridObj.selectCellByCoords(0,0);
<span class='line'>5912</span>  * 	gridObj.edit();
<span class='line'>5913</span>  * }
<span class='line'>5914</span>  * &lt;/code>&lt;/pre>
<span class='line'>5915</span>  * &lt;/div>
<span class='line'>5916</span>  * @param {String} evt A event string identifier or key for the given event. This value is the event name without the "On" and "Event" parts of the name, for example, the key for the OnDataReadyEvent is becomes "DataReady".
<span class='line'>5917</span>  * @param {Function} func A reference to the Function object that should be called when the event is fired.
<span class='line'>5918</span>  * @param {Object} context A reference to the Object that the Function should be called in the context of. When writing object oriented JavaScript the reference to the Function must also have some context in which it is to be executed.
<span class='line'>5919</span>  * @param {Array} params Any parameters that should be passed to the handler function.
<span class='line'>5920</span>  * @see #subscribe
<span class='line'>5921</span>  */</span><span class="WHIT">
<span class='line'>5922</span> </span><span class="NAME">ntb_gridp.subscribeOnce</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">func</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">context</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5923</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5924</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">guid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5925</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5926</span> </span><span class="WHIT">	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">func1</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5927</span> </span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5928</span> </span><span class="WHIT">		</span><span class="NAME">func.apply</span><span class="PUNC">(</span><span class="NAME">context</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">params</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5929</span> </span><span class="WHIT">		</span><span class="NAME">_this.unsubscribe</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">guid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5930</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5931</span> </span><span class="WHIT">	</span><span class="NAME">guid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.subscribe</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">func1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5932</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5933</span> 
<span class='line'>5934</span> </span><span class="COMM">/**
<span class='line'>5935</span>  * Unsubscribes an event from Grid.
<span class='line'>5936</span>  * @param {String} evt The event name without the "On" prefix and "Event" suffix.
<span class='line'>5937</span>  * @param {Number} guid The unique ID of the event as returned by the subscribe method. 
<span class='line'>5938</span>  * If the event is defined through the declaration the unique ID can be accessed through the grid API such as grid.OnHtmlReadyEvent.
<span class='line'>5939</span>  */</span><span class="WHIT">
<span class='line'>5940</span> </span><span class="NAME">ntb_gridp.unsubscribe</span><span class="PUNC">=</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">,</span><span class="NAME">guid</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5941</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5942</span> </span><span class="WHIT">	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">nitobi.event.unsubscribe</span><span class="PUNC">(</span><span class="NAME">evt</span><span class="PUNC">+</span><span class="NAME">this.uid</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">guid</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5943</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5944</span> 
<span class='line'>5945</span> </span><span class="COMM">/**
<span class='line'>5946</span>  * Fired when the page is unloaded. The Grid is repsonsible for disposing of all its child objects such that 
<span class='line'>5947</span>  * there is no memory leak in Internet Explorer from circular DOM / JS references.
<span class='line'>5948</span>  * @private
<span class='line'>5949</span>  */</span><span class="WHIT">
<span class='line'>5950</span> </span><span class="NAME">ntb_gridp.dispose</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5951</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5952</span> </span><span class="WHIT">	</span><span class="KEYW">try</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5953</span> </span><span class="WHIT">		</span><span class="COMM">//	Remove the DOM node to JS object circular reference.</span><span class="WHIT">
<span class='line'>5954</span> </span><span class="WHIT">		</span><span class="NAME">this.element.jsObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5955</span> 
<span class='line'>5956</span> </span><span class="WHIT">		</span><span class="COMM">//	global xml documents</span><span class="WHIT">
<span class='line'>5957</span> </span><span class="WHIT">		</span><span class="NAME">editorXslProc</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5958</span> 
<span class='line'>5959</span> </span><span class="WHIT">		</span><span class="COMM">// Detach the DOM events</span><span class="WHIT">
<span class='line'>5960</span> </span><span class="WHIT">		 </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">H</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.html</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5961</span> </span><span class="WHIT">		</span><span class="NAME">H.detachEvents</span><span class="PUNC">(</span><span class="NAME">this.getGridContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.events</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5962</span> </span><span class="WHIT">		</span><span class="NAME">H.detachEvents</span><span class="PUNC">(</span><span class="NAME">this.getHeaderContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.headerEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5963</span> </span><span class="WHIT">		</span><span class="NAME">H.detachEvents</span><span class="PUNC">(</span><span class="NAME">this.getDataContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.cellEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5964</span> </span><span class="WHIT">		</span><span class="NAME">H.detachEvents</span><span class="PUNC">(</span><span class="NAME">this.getScrollerContainer</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.scrollerEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5965</span> </span><span class="WHIT">		</span><span class="NAME">H.detachEvents</span><span class="PUNC">(</span><span class="NAME">this.keyNav</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">this.keyEvents</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5966</span> 
<span class='line'>5967</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">this.subscribedEvents</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5968</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">evtName</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.subscribedEvents</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5969</span> </span><span class="WHIT">			</span><span class="NAME">this.unsubscribe</span><span class="PUNC">(</span><span class="NAME">evtName.substring</span><span class="PUNC">(</span><span class="NUMB">0</span><span class="PUNC">,</span><span class="NAME">evtName.length</span><span class="PUNC">-</span><span class="NAME">this.uid.length</span><span class="PUNC">)</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">item</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5970</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5971</span> 
<span class='line'>5972</span> </span><span class="WHIT">		</span><span class="NAME">this.UiContainer.parentNode.removeChild</span><span class="PUNC">(</span><span class="NAME">this.UiContainer</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5973</span> 
<span class='line'>5974</span> </span><span class="WHIT">		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">item</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5975</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5976</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">!=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5977</span> </span><span class="WHIT">			</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5978</span> </span><span class="WHIT">				</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dispose</span><span class="WHIT"> </span><span class="KEYW">instanceof</span><span class="WHIT"> </span><span class="NAME">Function</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>5979</span> </span><span class="WHIT">				</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5980</span> </span><span class="WHIT">					</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">dispose</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5981</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5982</span> </span><span class="WHIT">				</span><span class="KEYW">this</span><span class="PUNC">[</span><span class="NAME">item</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5983</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5984</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5985</span> 
<span class='line'>5986</span> </span><span class="WHIT">		</span><span class="COMM">//	Dispose of all the editors that were possibly created</span><span class="WHIT">
<span class='line'>5987</span> </span><span class="WHIT">		</span><span class="COMM">//	Use the global nitobi.form.ControlFactory.instance class</span><span class="WHIT">
<span class='line'>5988</span> </span><span class="WHIT">		</span><span class="NAME">nitobi.form.ControlFactory.instance.dispose</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5989</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">e</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>5990</span> 
<span class='line'>5991</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5992</span> </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>5993</span> 
<span class='line'>5994</span> </span><span class="COMM">// backwards compatibility.</span><span class="WHIT">
<span class='line'>5995</span> </span><span class="COMM">/**
<span class='line'>5996</span>  * @private
<span class='line'>5997</span>  */</span><span class="WHIT">
<span class='line'>5998</span> </span><span class="NAME">nitobi.Grid</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">nitobi.grid.Grid</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>5999</span> </span></pre></body></html>